<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>æ­å·è‡ªå®¶å°çŒ«å’ª-æå…ˆç”Ÿ - å® ç‰©ç¤¾åŒºå¹³å°</title>
    
    <!-- åœ°å›¾API -->
    <script type="text/javascript" src="https://webapi.amap.com/maps?v=1.4.15&key=0d3b3b8f6e6e4f7b9a6e6e6e6e6e6e6&plugin=AMap.Geolocation,AMap.PlaceSearch,AMap.Geocoder,AMap.ToolBar,AMap.Autocomplete,AMap.Driving"></script>
    
    <style>
        /* è‹¹æœé£æ ¼å…¨å±€æ ·å¼ */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            /* è‹¹æœé£æ ¼é…è‰² */
            --apple-black: #1d1d1f;
            --apple-gray-light: #f5f5f7;
            --apple-gray-medium: #86868b;
            --apple-gray-dark: #6e6e73;
            --apple-blue: #0071e3;
            --apple-blue-hover: #0051d5;
            --apple-green: #34c759;
            --apple-orange: #ff9500;
            --apple-red: #ff3b30;
            --apple-purple: #af52de;
            --apple-white: #fbfbfd;
            --apple-border: #d2d2d7;
            
            /* çŒ«å’ªä¸»é¢˜è‰²å½© */
            --cat-primary: #FF6B9D;
            --cat-secondary: #C9E4DE;
            --cat-accent: #FFA07A;
            --cat-paw: #8B7355;
            --cat-whisker: #FFB6C1;
            --cat-bg-gradient: linear-gradient(135deg, #FFF0F5 0%, #F0F8FF 50%, #FFF5EE 100%);
            --cat-card-shadow: 0 8px 24px rgba(255, 107, 157, 0.15);
            
            /* å­—ä½“ç³»ç»Ÿ */
            --font-family: "SF Pro Display", "SF Pro Text", -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            
            /* é—´è·ç³»ç»Ÿ */
            --spacing-xs: 8px;
            --spacing-sm: 16px;
            --spacing-md: 32px;
            --spacing-lg: 48px;
            --spacing-xl: 64px;
            --spacing-xxl: 96px;
            
            /* åœ†è§’ */
            --border-radius-sm: 6px;
            --border-radius-md: 12px;
            --border-radius-lg: 18px;
            
            /* é˜´å½± */
            --shadow-light: 0 4px 20px rgba(0, 0, 0, 0.05);
            --shadow-medium: 0 8px 30px rgba(0, 0, 0, 0.12);
            --shadow-heavy: 0 20px 60px rgba(0, 0, 0, 0.15);
        }

        body {
            font-family: var(--font-family);
            background: linear-gradient(135deg, #FFF8E1 0%, #FFE0B2 100%);
            color: var(--apple-black);
            line-height: 1.47059;
            font-weight: 400;
            letter-spacing: -0.022em;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            min-height: 100vh;
        }

        /* å®¹å™¨ */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 var(--spacing-sm);
        }

        /* å¯¼èˆªæ  */
        .nav {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid var(--apple-border);
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1001;
            box-shadow: var(--shadow-light);
        }

        .nav-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            height: 60px;
        }

        .nav-menu {
            display: flex;
            gap: 20px;
            align-items: center;
        }

        .nav-link {
            text-decoration: none;
            color: var(--apple-black);
            font-weight: 500;
            padding: var(--spacing-xs) var(--spacing-sm);
            border-radius: var(--border-radius-sm);
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .nav-link:hover {
            background: var(--apple-gray-light);
            color: var(--apple-blue);
        }

        .nav-link.active {
            color: var(--apple-blue);
            background: rgba(0, 113, 227, 0.1);
        }

        /* é¡µé¢å®¹å™¨ */
        .page {
            display: none;
            padding: var(--spacing-lg) var(--spacing-md);
            min-height: 100vh;
            margin-top: 60px;
            padding-bottom: 80px; /* ç»™åº•éƒ¨æŒ‰é’®ç•™ç©ºé—´ */
        }

        .page.active {
            display: block;
        }

        /* å¡ç‰‡æ ·å¼ */
        .card {
            background: white;
            border-radius: var(--border-radius-md);
            box-shadow: var(--shadow-light);
            transition: all 0.3s ease;
            cursor: pointer;
            overflow: hidden;
            position: relative;
        }

        .card::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255, 107, 157, 0.05) 0%, transparent 70%);
            pointer-events: none;
            transform: rotate(45deg);
        }

        .card:hover {
            transform: translateY(-4px);
            box-shadow: var(--cat-card-shadow);
            border-color: var(--cat-secondary);
        }

        .card h3 {
            color: var(--apple-black);
            margin-bottom: var(--spacing-xs);
        }

        /* ç½‘æ ¼å¸ƒå±€ */
        .grid {
            display: grid;
            gap: var(--spacing-md);
            margin-top: var(--spacing-md);
        }

        .grid-2 {
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        }

        .grid-3 {
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        }

        /* æŒ‰é’®æ ·å¼ */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 12px 24px;
            border: none;
            border-radius: var(--border-radius-sm);
            font-weight: 600;
            text-decoration: none;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 16px;
            min-height: 44px;
        }

        .btn-primary {
            background: var(--apple-blue);
            color: white;
        }

        .btn-primary:hover {
            background: var(--apple-blue-hover);
            transform: translateY(-1px);
        }

        .btn-secondary {
            background: var(--apple-gray-light);
            color: var(--apple-black);
        }

        .btn-secondary:hover {
            background: var(--apple-gray-medium);
            color: white;
        }

        /* è¾“å…¥æ¡†æ ·å¼ */
        .input {
            width: 100%;
            padding: 12px 16px;
            border: 1px solid var(--apple-border);
            border-radius: var(--border-radius-sm);
            font-size: 16px;
            background: white;
            transition: all 0.3s ease;
            min-height: 44px;
            user-select: text;
            -webkit-user-select: text;
            -moz-user-select: text;
            -ms-user-select: text;
            position: relative;
        }

        .input:focus {
            outline: none;
            border-color: var(--apple-blue);
            box-shadow: 0 0 0 3px rgba(0, 113, 227, 0.1);
        }

        /* å¤åˆ¶ç²˜è´´æŒ‰é’® */
        .input-paste-btn {
            position: absolute;
            right: 8px;
            top: 50%;
            transform: translateY(-50%);
            background: var(--apple-gray-light);
            border: none;
            border-radius: var(--border-radius-sm);
            padding: 6px 10px;
            font-size: 12px;
            color: var(--apple-gray-dark);
            cursor: pointer;
            transition: all 0.2s ease;
            z-index: 10;
        }

        .input-paste-btn:hover {
            background: var(--apple-blue);
            color: white;
        }

        .input-copy-btn {
            position: absolute;
            right: 50px;
            top: 50%;
            transform: translateY(-50%);
            background: var(--apple-gray-light);
            border: none;
            border-radius: var(--border-radius-sm);
            padding: 6px 10px;
            font-size: 12px;
            color: var(--apple-gray-dark);
            cursor: pointer;
            transition: all 0.2s ease;
            z-index: 10;
        }

        .input-copy-btn:hover {
            background: var(--apple-green);
            color: white;
        }

        .input-wrapper {
            position: relative;
            display: flex;
            align-items: center;
        }

        .input-wrapper .input {
            padding-right: 110px;
        }

        /* è¡¨å•ç»„ */
        .form-group {
            margin-bottom: var(--spacing-md);
        }

        .form-group label {
            display: block;
            margin-bottom: var(--spacing-xs);
            font-weight: 600;
            color: var(--apple-black);
        }

        /* æ¨¡æ€æ¡† */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: none;
            z-index: 1000;
            backdrop-filter: blur(10px);
        }

        .modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: white;
            border-radius: var(--border-radius-lg);
            max-width: 600px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: var(--shadow-heavy);
            position: relative;
        }

        .modal-close-btn {
            position: absolute;
            top: var(--spacing-sm);
            right: var(--spacing-sm);
            background: #f5f5f5;
            border: none;
            border-radius: 50%;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 18px;
            color: #666;
            transition: all 0.2s ease;
            z-index: 10;
        }

        .modal-close-btn:hover {
            background: #e5e5e5;
            color: #333;
        }

        .modal-header {
            padding: var(--spacing-md);
            border-bottom: 1px solid var(--apple-border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-body {
            padding: var(--spacing-md);
        }

        .modal-footer {
            padding: var(--spacing-md);
            border-top: 1px solid var(--apple-border);
            display: flex;
            justify-content: flex-end;
            gap: var(--spacing-sm);
        }

        /* ä¸ªäººä¸­å¿ƒèœå•é¡¹æ ·å¼ */
        .menu-item {
            display: flex;
            align-items: center;
            padding: var(--spacing-sm) var(--spacing-md);
            cursor: pointer;
            border-radius: var(--border-radius-sm);
            transition: background-color 0.2s ease;
            margin-bottom: var(--spacing-xs);
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
            position: relative;
        }

        .menu-item:hover {
            background-color: var(--apple-gray-light);
        }

        .menu-item:hover::before {
            content: '';
            position: absolute;
            inset: 0;
            background: rgba(0, 113, 227, 0.05);
            border-radius: var(--border-radius-sm);
            pointer-events: none;
        }

        .menu-item:last-child {
            margin-bottom: 0;
        }

        .menu-icon {
            font-size: 18px;
            width: 24px;
            text-align: center;
            margin-right: var(--spacing-sm);
        }

        .menu-text {
            flex: 1;
            font-size: 16px;
        }

        .menu-arrow {
            color: var(--apple-gray-medium);
            font-size: 14px;
        }

        /* Toasté€šçŸ¥ */
        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 16px 24px;
            border-radius: var(--border-radius-sm);
            color: white;
            font-weight: 600;
            z-index: 2000;
            opacity: 0;
            transform: translateY(-20px);
            transition: all 0.3s ease;
            box-shadow: var(--shadow-medium);
        }

        .toast.show {
            opacity: 1;
            transform: translateY(0);
        }

        .toast.success {
            background: var(--apple-green);
        }

        .toast.error {
            background: var(--apple-red);
        }

        .toast.info {
            background: var(--apple-blue);
        }

        /* ç®¡ç†å‘˜æŒ‰é’®æ ·å¼ */
        .admin-btn {
            background-color: var(--apple-red) !important;
            color: white !important;
        }

        .admin-btn:hover {
            background-color: #d32f2f !important;
        }

        .admin-btn span:first-child {
            margin-right: 4px;
        }

        /* ç§»åŠ¨ç«¯å¿«æ·å¯¼èˆª */
        .mobile-quick-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: white;
            border-top: 1px solid var(--apple-border);
            display: none;
            justify-content: space-around;
            padding: var(--spacing-xs) 0;
            z-index: 9999;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
        }

        .mobile-quick-nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
            padding: var(--spacing-xs);
            text-decoration: none;
            color: var(--apple-gray-medium);
            font-size: 12px;
            cursor: pointer;
            transition: color 0.3s ease;
        }

        .mobile-quick-nav-item.active {
            color: var(--apple-blue);
        }

        .mobile-quick-nav-item:hover {
            color: var(--apple-blue);
        }

        .mobile-quick-nav-item span:first-child {
            font-size: 20px;
        }

        /* å“åº”å¼ */
        @media (max-width: 768px) {
            .nav-menu {
                display: none;
            }

            .mobile-nav-toggle {
                display: block;
                background: none;
                border: none;
                font-size: 24px;
                cursor: pointer;
                color: var(--apple-black);
            }

            /* ç§»åŠ¨ç«¯æ˜¾ç¤ºå¯¼èˆª */
            .mobile-quick-nav {
                display: flex !important;
            }

            .grid-3 {
                grid-template-columns: 1fr;
            }

            .grid-2 {
                grid-template-columns: 1fr;
            }

            .category-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .container {
                padding: 0 12px;
            }

            .nav-content {
                padding: 0 var(--spacing-sm);
            }

            .modal-content {
                width: 95%;
                max-height: 90vh;
                margin: 20px auto;
            }

            /* ç§»åŠ¨ç«¯æµ®åŠ¨æŒ‰é’®è°ƒæ•´ */
            .fab {
                bottom: 85px; /* é¿å…é®æŒ¡åº•éƒ¨å¯¼èˆªï¼Œå¢åŠ é—´è· */
                right: 20px;
            }

            /* æ‰‹æœºç«¯å•†åŸåˆ†ç±»ä¼˜åŒ– */
            .shop-categories {
                margin-bottom: var(--spacing-md);
            }

            .category-section {
                margin-bottom: var(--spacing-xs);
            }

            .category-header {
                padding: var(--spacing-sm) var(--spacing-md);
            }

            .category-content {
                padding: 0 var(--spacing-md) var(--spacing-sm);
            }

            .category-info h4 {
                font-size: 16px;
            }

            .tag {
                font-size: 11px;
                padding: 3px 6px;
            }

            /* æ‰‹æœºç«¯æŒ‰é’®ä¼˜åŒ– */
            .btn {
                min-height: 44px;
                touch-action: manipulation;
                -webkit-tap-highlight-color: transparent;
            }

            .btn-small {
                min-height: 36px;
                font-size: 14px;
                padding: 6px 12px;
            }

            /* æ‰‹æœºç«¯è¡¨å•ä¼˜åŒ– */
            .input, textarea {
                min-height: 44px;
                font-size: 16px; /* é˜²æ­¢iOSç¼©æ”¾ */
                touch-action: manipulation;
            }

            .form-group {
                margin-bottom: var(--spacing-md);
            }

            /* æ‰‹æœºç«¯å›¾ç‰‡æŸ¥çœ‹å™¨ä¼˜åŒ– */
            .image-viewer-content {
                margin: 10px;
                max-width: calc(100vw - 20px);
                max-height: 90vh;
            }

            .image-viewer-footer {
                flex-direction: column;
                gap: var(--spacing-sm);
            }

            .image-viewer-footer button {
                width: 100%;
            }

            /* æ‰‹æœºç«¯å¡ç‰‡ä¼˜åŒ– */
            .card {
                margin-bottom: var(--spacing-sm);
                border-radius: var(--border-radius-lg);
            }

            .card:hover {
                transform: translateY(-2px);
            }

            /* æ‰‹æœºç«¯å¤´åƒé€‰æ‹©ä¼˜åŒ– */
            .avatar-option {
                width: 45px;
                height: 45px;
                font-size: 20px;
            }
        }

        /* è¶…å°å±å¹•ä¼˜åŒ– */
        @media (max-width: 480px) {
            .container {
                padding: var(--spacing-sm);
            }

            .nav-content {
                font-size: 16px;
            }

            .nav-content span:first-child {
                font-size: 20px;
            }

            .category-info .category-icon {
                font-size: 18px;
            }

            .category-info h4 {
                font-size: 14px;
            }

            .tag {
                font-size: 10px;
                padding: 2px 5px;
            }

            .modal-header h3 {
                font-size: 18px;
            }

            .user-info div:first-child {
                width: 45px;
                height: 45px;
                font-size: 18px;
            }
        }

        /* å³ä¸‹è§’æµ®åŠ¨æŒ‰é’® - ç»Ÿä¸€å®šä¹‰ */
        .fab {
            position: fixed;
            bottom: 80px; /* é¿å…é®æŒ¡åº•éƒ¨å¯¼èˆª */
            right: 20px;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: var(--apple-blue);
            color: white;
            border: none;
            font-size: 20px;
            cursor: pointer;
            box-shadow: var(--shadow-heavy);
            z-index: 997; /* ç¡®ä¿ä¸ä¼šè¦†ç›–å¯¼èˆª */
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .fab:hover {
            background: var(--apple-blue-hover);
            transform: scale(1.1);
        }

        /* æ¡Œé¢ç«¯éšè—ç§»åŠ¨ç«¯å¯¼èˆª */
        @media (min-width: 769px) {
            .mobile-quick-nav {
                display: none !important;
            }
        }

        .mobile-nav-toggle {
            display: none;
        }

        /* ç§»åŠ¨ç«¯å¯¼èˆªé®ç½© */
        .mobile-nav-overlay {
            position: fixed;
            top: 60px;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            display: none;
            z-index: 998;
        }

        .mobile-nav-overlay.active {
            display: block;
        }

        /* æ ‡é¢˜æ ·å¼ */
        h1 {
            font-size: 48px;
            font-weight: 700;
            margin-bottom: var(--spacing-md);
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            text-align: center;
        }

        h2 {
            font-size: 32px;
            font-weight: 600;
            margin-bottom: var(--spacing-md);
            color: var(--apple-black);
        }

        h3 {
            font-size: 24px;
            font-weight: 600;
            margin-bottom: var(--spacing-sm);
            color: var(--apple-black);
        }

        /* æ®µè½ */
        p {
            margin-bottom: var(--spacing-sm);
            color: var(--apple-gray-dark);
            line-height: 1.6;
        }

        /* åŠ è½½åŠ¨ç”» */
        .loading {
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 200px;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 3px solid var(--apple-border);
            border-top-color: var(--apple-blue);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* è®ºå›æ ·å¼ - å°çº¢ä¹¦é£æ ¼ */
        .post-card {
            background: white;
            border-radius: var(--border-radius-md);
            box-shadow: var(--shadow-light);
            margin-bottom: var(--spacing-md);
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .post-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-medium);
        }

        .post-header {
            display: flex;
            align-items: center;
            padding: var(--spacing-sm);
            border-bottom: 1px solid var(--apple-border);
        }

        .post-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--apple-blue), var(--apple-purple));
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            margin-right: var(--spacing-sm);
        }

        .post-info {
            flex: 1;
        }

        .post-author {
            font-weight: 600;
            color: var(--apple-black);
            font-size: 14px;
        }

        .post-time {
            color: var(--apple-gray-medium);
            font-size: 12px;
        }

        .post-content {
            padding: var(--spacing-md);
        }

        .post-images {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
            gap: var(--spacing-xs);
            margin-top: var(--spacing-sm);
            margin-bottom: var(--spacing-sm);
        }

        .post-image {
            width: 100%;
            height: 100px;
            object-fit: cover;
            border-radius: var(--border-radius-sm);
        }

        .post-actions {
            display: flex;
            justify-content: space-around;
            padding: var(--spacing-sm);
            border-top: 1px solid var(--apple-border);
        }

        .post-action-btn {
            background: none;
            border: none;
            color: var(--apple-gray-medium);
            cursor: pointer;
            font-size: 14px;
            padding: var(--spacing-xs);
            border-radius: var(--border-radius-sm);
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .post-action-btn:hover {
            background: var(--apple-gray-light);
            color: var(--apple-black);
        }

        .post-action-btn.liked {
            color: var(--apple-red);
        }

        /* å•†åŸåˆ†ç±»æ ·å¼ */
        .category-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: var(--spacing-md);
            margin-bottom: var(--spacing-lg);
        }

        .category-card {
            background: white;
            border-radius: var(--border-radius-md);
            padding: var(--spacing-md);
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: var(--shadow-light);
        }

        .category-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-medium);
        }

        .category-icon {
            font-size: 48px;
            margin-bottom: var(--spacing-sm);
        }

        /* æŠ˜å å¼åˆ†ç±»æ ·å¼ */
        .shop-categories {
            margin-bottom: var(--spacing-lg);
        }

        .category-section {
            background: white;
            border-radius: var(--border-radius-md);
            border: 1px solid var(--apple-border);
            margin-bottom: var(--spacing-sm);
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .category-section:hover {
            box-shadow: var(--cat-card-shadow);
            border-color: var(--cat-secondary);
        }

        .category-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: var(--spacing-md);
            cursor: pointer;
            background: var(--apple-gray-light);
            transition: background 0.3s ease;
        }

        .category-header:hover {
            background: var(--cat-bg-gradient);
        }

        .category-info {
            display: flex;
            align-items: center;
            gap: var(--spacing-md);
        }

        .category-info .category-icon {
            font-size: 24px;
            margin-bottom: 0;
        }

        .category-info h4 {
            margin: 0;
            color: var(--apple-black);
            font-weight: 600;
        }

        .category-arrow {
            font-size: 18px;
            color: var(--apple-gray-medium);
            transition: transform 0.3s ease;
        }

        .category-section.expanded .category-arrow {
            transform: rotate(180deg);
        }

        .category-content {
            padding: 0 var(--spacing-md) var(--spacing-md);
            display: none;
            background: var(--apple-white);
        }

        .category-section.expanded .category-content {
            display: block;
        }

        .tag {
            background: var(--cat-bg-gradient);
            color: var(--cat-primary);
            padding: 4px 8px;
            border-radius: var(--border-radius-sm);
            font-size: 12px;
            font-weight: 500;
            border: 1px solid rgba(255, 107, 157, 0.2);
        }



        /* åœ°å›¾æ ·å¼ */
        .map-container {
            height: 400px;
            background: var(--apple-gray-light);
            border-radius: var(--border-radius-md);
            margin-bottom: var(--spacing-md);
            position: relative;
        }

        .hospital-card {
            background: white;
            border-radius: var(--border-radius-md);
            box-shadow: var(--shadow-light);
            margin-bottom: var(--spacing-sm);
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .hospital-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-medium);
        }

        .hospital-header {
            padding: var(--spacing-md);
            border-bottom: 1px solid var(--apple-border);
        }

        .hospital-name {
            font-weight: 600;
            font-size: 18px;
            margin-bottom: var(--spacing-xs);
            color: var(--apple-black);
        }

        .hospital-info {
            color: var(--apple-gray-dark);
            font-size: 14px;
            line-height: 1.5;
        }

        .hospital-rating {
            display: flex;
            align-items: center;
            gap: var(--spacing-xs);
            margin-top: var(--spacing-xs);
        }

        .rating-stars {
            color: var(--apple-orange);
        }

        .hospital-actions {
            padding: var(--spacing-sm);
            display: flex;
            gap: var(--spacing-sm);
        }

        .btn-small {
            padding: 8px 16px;
            font-size: 14px;
        }

        /* åŒ»é™¢æ’è¡Œæ¦œæ ·å¼ */
        .ranking-list {
            max-height: 400px;
            overflow-y: auto;
        }

        .ranking-item {
            display: flex;
            align-items: center;
            padding: var(--spacing-sm);
            border-radius: var(--border-radius-sm);
            margin-bottom: var(--spacing-xs);
            background: var(--apple-gray-light);
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .ranking-item:hover {
            background: var(--cat-bg-gradient);
            transform: translateX(4px);
        }

        .ranking-number {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 14px;
            margin-right: var(--spacing-sm);
            flex-shrink: 0;
        }

        .ranking-number.gold {
            background: linear-gradient(135deg, #FFD700, #FFA500);
            color: white;
        }

        .ranking-number.silver {
            background: linear-gradient(135deg, #C0C0C0, #808080);
            color: white;
        }

        .ranking-number.bronze {
            background: linear-gradient(135deg, #CD7F32, #8B4513);
            color: white;
        }

        .ranking-number.normal {
            background: var(--apple-gray-medium);
            color: white;
        }

        .ranking-info {
            flex: 1;
            min-width: 0;
        }

        .ranking-name {
            font-weight: 600;
            color: var(--apple-black);
            margin-bottom: 2px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .ranking-details {
            font-size: 12px;
            color: var(--apple-gray-medium);
            display: flex;
            align-items: center;
            gap: var(--spacing-xs);
        }

        .ranking-likes {
            display: flex;
            align-items: center;
            gap: 4px;
            font-size: 12px;
            color: var(--apple-red);
        }

        .ranking-actions {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .rank-up-btn, .rank-down-btn {
            background: none;
            border: none;
            cursor: pointer;
            font-size: 16px;
            padding: 2px 6px;
            border-radius: var(--border-radius-sm);
            transition: all 0.2s ease;
        }

        .rank-up-btn:hover {
            background: var(--apple-green);
            color: white;
        }

        .rank-down-btn:hover {
            background: var(--apple-red);
            color: white;
        }

        /* æŠ˜å è¯„è®ºæ ·å¼ */
        .comments-section {
            max-height: 200px;
            overflow: hidden;
            transition: max-height 0.3s ease;
        }

        .comments-section.expanded {
            max-height: none;
        }

        .comment-item {
            padding: var(--spacing-sm);
            border-bottom: 1px solid var(--apple-border);
        }

        .comment-author {
            font-weight: 600;
            font-size: 14px;
            margin-bottom: 4px;
        }

        .comment-content {
            color: var(--apple-gray-dark);
            font-size: 14px;
            margin-bottom: 4px;
        }

        .comment-time {
            color: var(--apple-gray-medium);
            font-size: 12px;
        }

        .expand-comments {
            text-align: center;
            padding: var(--spacing-sm);
            background: var(--apple-gray-light);
            cursor: pointer;
            font-size: 14px;
            color: var(--apple-blue);
            transition: background 0.3s ease;
        }

        .expand-comments:hover {
            background: var(--apple-gray-medium);
            color: white;
        }

        /* æ¨¡æ€æ¡†å¢å¼º */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            display: none;
            backdrop-filter: blur(10px);
        }

        .modal-overlay.active {
            display: flex !important;
            align-items: center;
            justify-content: center;
            z-index: 10000 !important;
        }

        /* ç™»å½•æ¨¡æ€æ¡†ç‰¹æ®Šæ ·å¼ */
        #loginModal.modal-overlay.active {
            z-index: 10001 !important;
        }

        /* å›¾ç‰‡æŸ¥çœ‹å™¨æ ·å¼ */
        .image-viewer-content {
            max-width: 90vw;
            max-height: 95vh;
            background: white;
            border-radius: var(--border-radius-md);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        .image-viewer-header {
            padding: var(--spacing-md);
            border-bottom: 1px solid var(--apple-border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .image-viewer-body {
            padding: var(--spacing-md);
            display: flex;
            justify-content: center;
            align-items: center;
            flex: 1;
            background: #f8f9fa;
        }

        .image-viewer-footer {
            padding: var(--spacing-md);
            border-top: 1px solid var(--apple-border);
            display: flex;
            gap: var(--spacing-sm);
            justify-content: center;
        }

        /* å¸–å­å›¾ç‰‡æ‚¬åœæ•ˆæœ */
        .post-image {
            cursor: pointer;
            transition: transform 0.2s ease;
        }

        .post-image:hover {
            transform: scale(1.02);
        }

        /* å¤´åƒé€‰æ‹©æ ·å¼ */
        .avatar-option {
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 2px solid var(--apple-border);
            border-radius: 50%;
            cursor: pointer;
            font-size: 20px;
            background: white;
            transition: all 0.2s ease;
        }

        .avatar-option:hover {
            border-color: var(--apple-blue);
            transform: scale(1.1);
        }

        .avatar-option.selected {
            border-color: var(--apple-blue);
            background: var(--apple-blue-light);
        }
    </style>
</head>
<body>
    <!-- å¯¼èˆªæ  -->
    <nav class="nav" style="position: fixed; top: 0; left: 0; right: 0; z-index: 1000;">
        <div class="container">
            <div class="nav-content">
                <div style="display: flex; align-items: center; gap: var(--spacing-sm);">
                    <div style="position: relative; font-size: 24px;">
                        ğŸ±
                        <div style="position: absolute; top: -3px; right: -8px; font-size: 10px; opacity: 0.7;">ğŸ¾</div>
                    </div>
                    <div style="font-weight: 700; font-size: 20px; color: var(--cat-primary); text-shadow: 0 1px 2px rgba(255, 107, 157, 0.2);">é‡‘çŒ«ä¹‹å®¶</div>
                </div>
                
                <div class="nav-menu" id="navMenu">
                    <a href="#" class="nav-link active" data-page="home" onclick="event.preventDefault(); showPage('home', this)">é¦–é¡µ</a>
                    <a href="#" class="nav-link" data-page="cats" onclick="event.preventDefault(); showPage('cats', this)">çŒ«å’ªç®¡ç†</a>
                    <a href="#" class="nav-link" data-page="hospital" onclick="event.preventDefault(); showPage('hospital', this)">å® ç‰©åŒ»é™¢</a>
                    <a href="#" class="nav-link" data-page="logistics" onclick="event.preventDefault(); showPage('logistics', this)">ç‰©æµæŸ¥è¯¢</a>
                    <a href="#" class="nav-link" data-page="forum" onclick="event.preventDefault(); showPage('forum', this)">è®ºå›äº¤æµ</a>
                    <a href="#" class="nav-link" data-page="shop" onclick="event.preventDefault(); showPage('shop', this)">å® ç‰©å•†åŸ</a>
                    <a href="#" class="nav-link" data-page="profile" onclick="event.preventDefault(); showPage('profile', this)">ä¸ªäººä¸­å¿ƒ</a>
                </div>

                <div style="display: flex; align-items: center; gap: var(--spacing-sm); z-index: 1002; position: relative;">
                    <button class="mobile-nav-toggle" onclick="toggleMobileMenu()" style="z-index: 1004; position: relative; pointer-events: auto;">â˜°</button>
                </div>
            </div>
        </div>
    </nav>

    <!-- ç§»åŠ¨ç«¯å¯¼èˆªé®ç½© -->
    <div class="mobile-nav-overlay" id="mobileNavOverlay" onclick="closeMobileMenu()"></div>

    <!-- é¦–é¡µ -->
    <div id="home" class="page active">
        <div class="container">
            <h1>ğŸ± é‡‘çŒ«ä¹‹å®¶</h1>
            <p style="text-align: center; font-size: 18px; margin-bottom: var(--spacing-lg);">
                æ­å·è‡ªå®¶å°çŒ«å’ª-æå…ˆç”Ÿçš„å® ç‰©ç¤¾åŒºå¹³å°
            </p>
            
            <!-- åŠŸèƒ½ç½‘æ ¼ -->
            <div class="grid grid-3">
                <div class="card" onclick="showPage('cats', null)">
                    <div style="padding: var(--spacing-md); text-align: center;">
                        <div style="font-size: 48px; margin-bottom: var(--spacing-sm);">ğŸ±</div>
                        <h3>çŒ«å’ªç®¡ç†</h3>
                        <p>ç®¡ç†æ‚¨çš„çŒ«å’ªä¿¡æ¯ã€å¥åº·è®°å½•å’Œæ—¥å¸¸æŠ¤ç†</p>
                    </div>
                </div>
                
                <div class="card" onclick="showPage('hospital', null)">
                    <div style="padding: var(--spacing-md); text-align: center;">
                        <div style="font-size: 48px; margin-bottom: var(--spacing-sm);">ğŸ¥</div>
                        <h3>å® ç‰©åŒ»é™¢</h3>
                        <p>æŸ¥æ‰¾é™„è¿‘çš„å® ç‰©åŒ»é™¢å’ŒåŒ»ç–—æœåŠ¡</p>
                    </div>
                </div>
                
                <div class="card" onclick="showPage('logistics', null)">
                    <div style="padding: var(--spacing-md); text-align: center;">
                        <div style="font-size: 48px; margin-bottom: var(--spacing-sm);">ğŸ“¦</div>
                        <h3>ç‰©æµæŸ¥è¯¢</h3>
                        <p>æŸ¥è¯¢å® ç‰©ç”¨å“ç‰©æµä¿¡æ¯</p>
                    </div>
                </div>
                
                <div class="card" onclick="showPage('forum', null)">
                    <div style="padding: var(--spacing-md); text-align: center;">
                        <div style="font-size: 48px; margin-bottom: var(--spacing-sm);">ğŸ’¬</div>
                        <h3>è®ºå›äº¤æµ</h3>
                        <p>ä¸å…¶ä»–å® ç‰©ä¸»äººäº¤æµç»éªŒ</p>
                    </div>
                </div>
                
                <div class="card" onclick="showPage('shop', null)">
                    <div style="padding: var(--spacing-md); text-align: center;">
                        <div style="font-size: 48px; margin-bottom: var(--spacing-sm);">ğŸ›ï¸</div>
                        <h3>å® ç‰©å•†åŸ</h3>
                        <p>è´­ä¹°å® ç‰©ç”¨å“å’ŒæœåŠ¡</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- çŒ«å’ªç®¡ç†é¡µé¢ -->
    <div id="cats" class="page">
        <div class="container">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: var(--spacing-md);">
                <h2>ğŸ± çŒ«å’ªç®¡ç†</h2>
                <div id="catManagementButtons" style="display: none;">
                    <button class="btn btn-primary" onclick="addCat()">+ æ·»åŠ çŒ«å’ª</button>
                </div>
                <div id="catUserHint" style="color: var(--apple-gray-medium); font-size: 14px;">
                    æ™®é€šç”¨æˆ·åªèƒ½æŸ¥çœ‹çŒ«å’ªä¿¡æ¯
                </div>
            </div>
            <div id="catList" class="grid grid-2">
                <!-- çŒ«å’ªåˆ—è¡¨å°†åœ¨è¿™é‡ŒåŠ¨æ€ç”Ÿæˆ -->
            </div>
        </div>
    </div>

    <!-- å•†åŸç®¡ç†æ¨¡æ€æ¡† -->
    <div id="shopManagerModal" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header">
                <h3>å•†å“ç®¡ç†</h3>
                <button class="modal-close-btn" onclick="closeShopManager()">Ã—</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>å•†å“åç§°</label>
                    <input type="text" class="input" id="productName" placeholder="è¯·è¾“å…¥å•†å“åç§°...">
                </div>
                <div class="form-group">
                    <label>å•†å“åˆ†ç±»</label>
                    <select class="input" id="productCategory">
                        <option value="food">çŒ«ç²®ä¸»é£Ÿ</option>
                        <option value="toys">ç©å…·ç”¨å“</option>
                        <option value="supplies">æ—¥å¸¸ç”¨å“</option>
                        <option value="grooming">æ´—æŠ¤ç¾å®¹</option>
                        <option value="health">å¥åº·ä¿å¥</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>å•†å“ä»·æ ¼</label>
                    <input type="text" class="input" id="productPrice" placeholder="è¯·è¾“å…¥ä»·æ ¼ï¼ˆå¦‚ï¼š29ï¼‰">
                </div>
                <div class="form-group">
                    <label>è´­ä¹°é“¾æ¥å¹³å°</label>
                    <select class="input" id="productPlatform">
                        <option value="taobao">æ·˜å®</option>
                        <option value="pinduoduo">æ‹¼å¤šå¤š</option>
                        <option value="jd">äº¬ä¸œ</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>å•†å“é“¾æ¥</label>
                    <input type="text" class="input" id="productUrl" placeholder="è¯·è¾“å…¥å•†å“è´­ä¹°é“¾æ¥...">
                </div>
                <div class="form-group">
                    <label>å•†å“å›¾æ ‡</label>
                    <select class="input" id="productIcon">
                        <option value="ğŸ¥«">ğŸ¥« çŒ«ç²®</option>
                        <option value="ğŸ§¶">ğŸ§¶ ç©å…·</option>
                        <option value="ğŸ§¼">ğŸ§¼ çŒ«ç ‚</option>
                        <option value="ğŸ ">ğŸ  çŒ«çª</option>
                        <option value="ğŸ§´">ğŸ§´ æŠ¤ç†</option>
                        <option value="ğŸ’Š">ğŸ’Š ä¿å¥å“</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>å•†å“æè¿°</label>
                    <textarea class="input" id="productDescription" rows="3" placeholder="è¯·è¾“å…¥å•†å“æè¿°..."></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeShopManager()">å–æ¶ˆ</button>
                <button class="btn btn-primary" onclick="saveProduct()">ä¿å­˜å•†å“</button>
            </div>
        </div>
    </div>

    <!-- åŒ»é™¢ç®¡ç†æ¨¡æ€æ¡† -->
    <div id="hospitalManagerModal" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header">
                <h3>æ·»åŠ åŒ»é™¢</h3>
                <button class="modal-close-btn" onclick="closeHospitalManager()">Ã—</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>åŒ»é™¢åç§°</label>
                    <input type="text" class="input" id="hospitalName" placeholder="è¯·è¾“å…¥åŒ»é™¢åç§°...">
                </div>
                <div class="form-group">
                    <label>åŒ»é™¢åœ°å€</label>
                    <input type="text" class="input" id="hospitalAddress" placeholder="è¯·è¾“å…¥è¯¦ç»†åœ°å€...">
                    ${appData.currentLocation ? `
                        <button type="button" class="btn btn-secondary" onclick="fillCurrentCityAddress()" style="margin-top: 5px; font-size: 12px;">
                            ğŸ“ ä½¿ç”¨å½“å‰åŸå¸‚åœ°å€
                        </button>
                    ` : ''}
                </div>
                <div class="form-group">
                    <label>è”ç³»ç”µè¯</label>
                    <input type="text" class="input" id="hospitalPhone" placeholder="è¯·è¾“å…¥è”ç³»ç”µè¯...">
                </div>
                <div class="form-group">
                    <label>ç»åº¦ï¼ˆå¯é€‰ï¼‰</label>
                    <input type="text" class="input" id="hospitalLng" placeholder="ç•™ç©ºå°†ä½¿ç”¨å½“å‰å®šä½ä½ç½®">
                </div>
                <div class="form-group">
                    <label>çº¬åº¦ï¼ˆå¯é€‰ï¼‰</label>
                    <input type="text" class="input" id="hospitalLat" placeholder="ç•™ç©ºå°†ä½¿ç”¨å½“å‰å®šä½ä½ç½®">
                </div>
                <div class="form-group">
                    <label>åŒ»é™¢ç®€ä»‹</label>
                    <textarea class="input" id="hospitalDescription" rows="3" placeholder="è¯·è¾“å…¥åŒ»é™¢ç®€ä»‹..."></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeHospitalManager()">å–æ¶ˆ</button>
                <button class="btn btn-primary" onclick="saveHospital()">æ·»åŠ åŒ»é™¢</button>
            </div>
        </div>
    </div>

    <!-- æ·»åŠ çŒ«å’ªæ¨¡æ€æ¡† -->
    <div id="addCatModal" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header">
                <h3>æ·»åŠ çŒ«å’ª</h3>
                <button class="modal-close-btn" onclick="closeAddCatModal()">Ã—</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>çŒ«å’ªåå­—</label>
                    <input type="text" class="input" id="catName" placeholder="è¯·è¾“å…¥çŒ«å’ªåå­—...">
                </div>
                <div class="form-group">
                    <label>å“ç§</label>
                    <select class="input" id="catBreed">
                        <option value="">è¯·é€‰æ‹©å“ç§</option>
                        <option value="è‹±çŸ­">è‹±çŸ­</option>
                        <option value="ç¾çŸ­">ç¾çŸ­</option>
                        <option value="å¸ƒå¶çŒ«">å¸ƒå¶çŒ«</option>
                        <option value="æš¹ç½—çŒ«">æš¹ç½—çŒ«</option>
                        <option value="åŠ è²çŒ«">åŠ è²çŒ«</option>
                        <option value="ä¸­åç”°å›­çŒ«">ä¸­åç”°å›­çŒ«</option>
                        <option value="å…¶ä»–">å…¶ä»–</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>å¹´é¾„</label>
                    <input type="number" class="input" id="catAge" placeholder="è¯·è¾“å…¥å¹´é¾„ï¼ˆå²ï¼‰" min="0" max="30">
                </div>
                <div class="form-group">
                    <label>æ€§åˆ«</label>
                    <select class="input" id="catGender">
                        <option value="å…¬">å…¬</option>
                        <option value="æ¯">æ¯</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>ç…§ç‰‡</label>
                    <div style="display: flex; gap: var(--spacing-sm); margin-bottom: var(--spacing-sm);">
                        <input type="text" class="input" id="catPhoto" placeholder="è¯·è¾“å…¥ç…§ç‰‡é“¾æ¥æˆ–ä¸Šä¼ å›¾ç‰‡...">
                        <input type="file" id="catPhotoUpload" accept="image/*" style="display: none;" onchange="handleCatPhotoUpload(event)">
                        <button class="btn btn-secondary" onclick="document.getElementById('catPhotoUpload').click()">ğŸ“· ä¸Šä¼ </button>
                    </div>
                    <div id="catPhotoPreview" style="width: 100%; height: 200px; border: 2px dashed var(--apple-border); border-radius: var(--border-radius-sm); display: flex; align-items: center; justify-content: center; color: var(--apple-gray-medium); background-color: var(--apple-gray-light);">
                        <div style="text-align: center;">
                            <div style="font-size: 48px; margin-bottom: var(--spacing-sm);">ğŸ±</div>
                            <p>ç…§ç‰‡é¢„è§ˆåŒºåŸŸ</p>
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label>ç®€ä»‹</label>
                    <textarea class="input" id="catDescription" rows="3" placeholder="ä»‹ç»ä¸€ä¸‹è¿™åªå¯çˆ±çš„çŒ«å’ª..."></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeAddCatModal()">å–æ¶ˆ</button>
                <button class="btn btn-primary" onclick="submitCat()">æ·»åŠ </button>
            </div>
        </div>
    </div>

    <!-- å® ç‰©åŒ»é™¢é¡µé¢ -->
    <div id="hospital" class="page">
        <div class="container">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: var(--spacing-md);">
                <h2>ğŸ¥ å® ç‰©åŒ»é™¢æ¨è</h2>
                <div style="display: flex; gap: var(--spacing-sm);">
                    <button class="btn btn-secondary" onclick="refreshHospitals()">ğŸ”„ åˆ·æ–°</button>
                    <button id="hospitalManageBtn" class="btn btn-primary" onclick="openHospitalManager()" style="display: none;">â• æ·»åŠ æ¨è</button>
                </div>
            </div>
            
            <!-- é«˜å¾·å¯¼èˆªæ  -->
            <div class="card" style="margin-bottom: var(--spacing-lg);">
                <div style="padding: var(--spacing-md);">
                    <h3 style="margin-bottom: var(--spacing-sm);">ğŸ§­ é«˜å¾·åœ°å›¾å¯¼èˆª</h3>
                    <div style="display: flex; gap: var(--spacing-sm); margin-bottom: var(--spacing-sm);">
                        <input type="text" class="input" id="gaodeDestination" placeholder="è¾“å…¥åŒ»é™¢è¯¦ç»†åœ°å€..." style="flex: 1;">
                        <button class="btn btn-primary" onclick="openGaodeNavigation()">ğŸ—ºï¸ å¼€å§‹å¯¼èˆª</button>
                    </div>
                    <p style="color: var(--apple-gray-medium); font-size: 14px;">è¾“å…¥åŒ»é™¢åœ°å€åç›´æ¥è·³è½¬åˆ°é«˜å¾·åœ°å›¾è¿›è¡Œå¯¼èˆª</p>
                </div>
            </div>
            
            <!-- åŒ»é™¢æ’è¡Œæ¦œ -->
            <div class="card" style="margin-bottom: var(--spacing-lg);">
                <div style="padding: var(--spacing-md);">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: var(--spacing-md);">
                        <h3 style="margin: 0; display: flex; align-items: center; gap: var(--spacing-sm);">
                            ğŸ† åŒ»é™¢æ’è¡Œæ¦œ
                            <span style="font-size: 14px; color: var(--apple-gray-medium); font-weight: normal;">(æŒ‰ç”¨æˆ·ç‚¹èµå’Œä½¿ç”¨é‡æ’åº)</span>
                        </h3>
                        <button id="editRankingBtn" class="btn btn-secondary" onclick="openHospitalRankingManager()" style="display: none; font-size: 14px; padding: 8px 16px;">
                            âœï¸ ç¼–è¾‘æ’è¡Œ
                        </button>
                    </div>
                    <div id="hospitalRanking">
                        <div id="hospitalRankingList" class="ranking-list">
                            <!-- æ’è¡Œæ¦œå†…å®¹å°†åœ¨è¿™é‡ŒåŠ¨æ€ç”Ÿæˆ -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- ç”¨æˆ·æ¨èåŒ»é™¢ -->
            <h3 style="margin-bottom: var(--spacing-md);">ğŸ’ ç”¨æˆ·æ¨èåŒ»é™¢</h3>
            <div id="userRecommendedHospitals">
                <div style="text-align: center; padding: 40px; color: var(--apple-gray-medium);">
                    <div style="font-size: 48px; margin-bottom: var(--spacing-sm);">ğŸ¥</div>
                    <p>æš‚æ— ç”¨æˆ·æ¨èåŒ»é™¢</p>
                    <p style="font-size: 14px; margin-top: var(--spacing-sm);">æ¬¢è¿åˆ†äº«æ‚¨çŸ¥é“çš„å¥½åŒ»é™¢</p>
                </div>
            </div>
            
            <!-- æ·»åŠ æ¨èæŒ‰é’® -->
            <div style="text-align: center; margin: var(--spacing-lg) 0;">
                <button class="btn btn-primary" onclick="openHospitalRecommendation()">ğŸ“ æ¨èåŒ»é™¢</button>
            </div>
        </div>
    </div>

    <!-- åŒ»é™¢è¯„è®ºæ¨¡æ€æ¡† -->
    <div id="hospitalReviewModal" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header">
                <h3>åŒ»é™¢è¯„ä»·</h3>
                <button class="btn btn-secondary" onclick="closeHospitalReviewModal()">Ã—</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>è¯„åˆ†</label>
                    <div id="ratingStars" style="display: flex; gap: var(--spacing-xs); font-size: 24px;">
                        <span class="star" data-rating="1">â­</span>
                        <span class="star" data-rating="2">â­</span>
                        <span class="star" data-rating="3">â­</span>
                        <span class="star" data-rating="4">â­</span>
                        <span class="star" data-rating="5">â­</span>
                    </div>
                </div>
                <div class="form-group">
                    <label>è¯„è®ºå†…å®¹</label>
                    <textarea class="input" id="reviewContent" rows="4" placeholder="åˆ†äº«æ‚¨çš„å°±è¯Šä½“éªŒ..."></textarea>
                </div>
                <input type="hidden" id="reviewHospitalId">
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeHospitalReviewModal()">å–æ¶ˆ</button>
                <button class="btn btn-primary" onclick="submitReview()">æäº¤è¯„ä»·</button>
            </div>
        </div>
    </div>

    <!-- åŒ»é™¢æ¨èæ¨¡æ€æ¡† -->
    <div id="hospitalRecommendationModal" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header">
                <h3>ğŸ¥ æ¨èåŒ»é™¢</h3>
                <button class="btn btn-secondary" onclick="closeHospitalRecommendationModal()">Ã—</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>åŒ»é™¢åç§° *</label>
                    <input type="text" class="input" id="recommendHospitalName" placeholder="è¯·è¾“å…¥åŒ»é™¢åç§°">
                </div>
                <div class="form-group">
                    <label>è¯¦ç»†åœ°å€ *</label>
                    <input type="text" class="input" id="recommendHospitalAddress" placeholder="è¯·è¾“å…¥è¯¦ç»†åœ°å€">
                </div>
                <div class="form-group">
                    <label>è”ç³»ç”µè¯</label>
                    <input type="text" class="input" id="recommendHospitalPhone" placeholder="è¯·è¾“å…¥è”ç³»ç”µè¯">
                </div>
                <div class="form-group">
                    <label>æ¨èç†ç”±</label>
                    <textarea class="input" id="recommendHospitalReason" rows="3" placeholder="ä¸ºä»€ä¹ˆæ¨èè¿™å®¶åŒ»é™¢ï¼Ÿ"></textarea>
                </div>
                <div class="form-group">
                    <label>æ¨èäºº</label>
                    <input type="text" class="input" id="recommendHospitalUser" placeholder="æ‚¨çš„æ˜µç§°ï¼ˆå¯é€‰ï¼‰">
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeHospitalRecommendationModal()">å–æ¶ˆ</button>
                <button class="btn btn-primary" onclick="submitHospitalRecommendation()">æäº¤æ¨è</button>
            </div>
        </div>
    </div>

    <!-- åŒ»é™¢æ’è¡Œæ¦œç®¡ç†æ¨¡æ€æ¡† -->
    <div id="hospitalRankingManagerModal" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header">
                <h3>ğŸ† åŒ»é™¢æ’è¡Œæ¦œç®¡ç†</h3>
                <button class="modal-close-btn" onclick="closeHospitalRankingManager()">Ã—</button>
            </div>
            <div class="modal-body">
                <div style="margin-bottom: var(--spacing-md); padding: var(--spacing-sm); background: var(--apple-gray-light); border-radius: var(--border-radius-sm);">
                    <p style="margin: 0; color: var(--apple-gray-dark); font-size: 14px;">
                        ğŸ’¡ æç¤ºï¼šæ‚¨å¯ä»¥æ‹–æ‹½è°ƒæ•´åŒ»é™¢æ’åï¼Œæˆ–ä½¿ç”¨ä¸Šä¸‹ç®­å¤´ç²¾ç¡®è°ƒæ•´
                    </p>
                </div>
                
                <div id="sortableRankingList" style="max-height: 400px; overflow-y: auto;">
                    <!-- å¯æ’åºçš„åŒ»é™¢åˆ—è¡¨å°†åœ¨è¿™é‡Œç”Ÿæˆ -->
                </div>
                
                <div style="margin-top: var(--spacing-md);">
                    <button class="btn btn-secondary" onclick="addNewHospitalToRanking()">â• æ·»åŠ æ–°åŒ»é™¢</button>
                    <button class="btn btn-secondary" onclick="resetRankingToDefault()">ğŸ”„ é‡ç½®ä¸ºé»˜è®¤</button>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeHospitalRankingManager()">å–æ¶ˆ</button>
                <button class="btn btn-primary" onclick="saveRankingChanges()">ä¿å­˜æ›´æ”¹</button>
            </div>
        </div>
    </div>

    <!-- ç‰©æµæŸ¥è¯¢é¡µé¢ -->
    <div id="logistics" class="page">
        <div class="container">
            <h2>ğŸ“¦ ç‰©æµæŸ¥è¯¢</h2>
            
            <!-- å¿«æ·å…¥å£ -->
            <div class="grid grid-2" style="margin-bottom: var(--spacing-lg);">
                <div class="card" onclick="focusTrackingInput()">
                    <div style="padding: var(--spacing-md); text-align: center;">
                        <div style="font-size: 48px; margin-bottom: var(--spacing-sm);">ğŸ”</div>
                        <h3>è¿å•æŸ¥è¯¢</h3>
                        <p>è¾“å…¥è¿å•å·æŸ¥è¯¢ç‰©æµä¿¡æ¯</p>
                        <button class="btn btn-primary">å¼€å§‹æŸ¥è¯¢</button>
                    </div>
                </div>
                <div class="card" onclick="showTrackingHistory()">
                    <div style="padding: var(--spacing-md); text-align: center;">
                        <div style="font-size: 48px; margin-bottom: var(--spacing-sm);">ğŸ“‹</div>
                        <h3>æŸ¥è¯¢å†å²</h3>
                        <p>æŸ¥çœ‹å†å²æŸ¥è¯¢è®°å½•</p>
                        <button class="btn btn-secondary">æŸ¥çœ‹å†å²</button>
                    </div>
                </div>
            </div>

            <!-- æŸ¥è¯¢è¡¨å• -->
            <div class="card" style="margin-bottom: var(--spacing-lg);">
                <div style="padding: var(--spacing-md);">
                    <h3 style="margin-bottom: var(--spacing-md);">è¿å•å·æŸ¥è¯¢</h3>
                    <div class="form-group">
                        <label>è¿å•å·</label>
                        <input type="text" class="input" placeholder="è¯·è¾“å…¥è¿å•å·..." id="trackingNumber" onkeypress="if(event.key==='Enter') trackPackage()">
                    </div>
                    <button class="btn btn-primary" onclick="trackPackage()">æŸ¥è¯¢ç‰©æµ</button>
                </div>
            </div>

            <!-- å¸¸ç”¨å¿«é€’å…¬å¸ -->
            <h3 style="margin-bottom: var(--spacing-md);">ğŸšš å¸¸ç”¨å¿«é€’</h3>
            <div class="grid grid-3">
                <div class="card">
                    <div style="padding: var(--spacing-md); text-align: center;">
                        <div style="font-size: 32px; margin-bottom: var(--spacing-sm);">ğŸ“¦</div>
                        <h4>é¡ºä¸°é€Ÿè¿</h4>
                        <p style="color: var(--apple-gray-medium); font-size: 14px;">è¯·è¾“å…¥è¿å•å·æŸ¥è¯¢</p>
                    </div>
                </div>
                <div class="card">
                    <div style="padding: var(--spacing-md); text-align: center;">
                        <div style="font-size: 32px; margin-bottom: var(--spacing-sm);">ğŸ“¦</div>
                        <h4>ä¸­é€šå¿«é€’</h4>
                        <p style="color: var(--apple-gray-medium); font-size: 14px;">è¯·è¾“å…¥è¿å•å·æŸ¥è¯¢</p>
                    </div>
                </div>
                <div class="card">
                    <div style="padding: var(--spacing-md); text-align: center;">
                        <div style="font-size: 32px; margin-bottom: var(--spacing-sm);">ğŸ“¦</div>
                        <h4>åœ†é€šå¿«é€’</h4>
                        <p style="color: var(--apple-gray-medium); font-size: 14px;">è¯·è¾“å…¥è¿å•å·æŸ¥è¯¢</p>
                    </div>
                </div>
            </div>

            <div id="trackingResult" style="margin-top: var(--spacing-md);"></div>
        </div>
    </div>

    <!-- è®ºå›äº¤æµé¡µé¢ -->
    <div id="forum" class="page">
        <div class="container">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: var(--spacing-md);">
                <h2>ğŸ’¬ è®ºå›äº¤æµ</h2>
                <div style="display: flex; gap: var(--spacing-sm);">
                    <button id="forumManageBtn" class="btn btn-secondary" onclick="manageForum()" style="display: none;">ğŸ“ ç®¡ç†è®ºå›</button>
                    <button class="btn btn-primary" onclick="createPost()">+ å‘è¡¨å¸–å­</button>
                </div>
            </div>
            
            <div id="postList">
                <!-- å¸–å­åˆ—è¡¨å°†åœ¨è¿™é‡ŒåŠ¨æ€ç”Ÿæˆ -->
            </div>
        </div>
    </div>

    <!-- å‘å¸–æ¨¡æ€æ¡† -->
    <div id="createPostModal" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header">
                <h3>å‘è¡¨å¸–å­</h3>
                <button class="btn btn-secondary" onclick="closeCreatePostModal()">Ã—</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>æ ‡é¢˜</label>
                    <input type="text" class="input" id="postTitle" placeholder="ç»™å¸–å­èµ·ä¸ªæ ‡é¢˜...">
                </div>
                <div class="form-group">
                    <label>å†…å®¹</label>
                    <textarea class="input" id="postContent" rows="6" placeholder="åˆ†äº«ä½ çš„å…»çŒ«ç»éªŒ..."></textarea>
                </div>
                <div class="form-group">
                    <label>ä¸Šä¼ å›¾ç‰‡ (å¯é€‰)</label>
                    <input type="file" id="postImageUpload" accept="image/*" multiple style="display: none;" onchange="handlePostImageUpload(event)">
                    <div id="postImagePreview" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(100px, 1fr)); gap: 10px; margin-top: 10px;"></div>
                    <button type="button" class="btn btn-secondary" onclick="document.getElementById('postImageUpload').click()" style="margin-top: 10px;">
                        ğŸ“· é€‰æ‹©å›¾ç‰‡
                    </button>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeCreatePostModal()">å–æ¶ˆ</button>
                <button class="btn btn-primary" onclick="submitPost()">å‘è¡¨</button>
            </div>
        </div>
    </div>

    <!-- å® ç‰©å•†åŸé¡µé¢ -->
    <div id="shop" class="page">
        <div class="container">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: var(--spacing-md);">
                <h2 style="position: relative; display: inline-block;">
                <span style="position: relative; z-index: 2;">ğŸ›ï¸ å® ç‰©å•†åŸ</span>
                <div style="position: absolute; top: -5px; right: -25px; font-size: 16px; opacity: 0.6; transform: rotate(-15deg);">ğŸ¾</div>
            </h2>
                <div id="shopManageBtn" style="display: none;">
                    <button class="btn btn-primary" onclick="openShopManager()">ğŸ“ ç®¡ç†å•†å“</button>
                </div>
            </div>
            
            <!-- å•†å“åˆ†ç±» -->
            <div class="shop-categories">
                <div class="category-section" data-category="food">
                    <div class="category-header" onclick="toggleCategory('food')">
                        <div class="category-info">
                            <span class="category-icon">ğŸ¥«</span>
                            <h4>çŒ«ç²®ä¸»é£Ÿ</h4>
                        </div>
                        <span class="category-arrow">â–¼</span>
                    </div>
                    <div class="category-content">
                        <p style="color: var(--apple-gray-medium); font-size: 14px;">ä¸»é£Ÿç½å¤´ã€çŒ«ç²®ã€è¥å…»è†ã€å¤„æ–¹ç²®ã€å® ç‰©å¥¶ç²‰ã€è¥å…»è¡¥å……å‰‚</p>
                        <div style="display: flex; gap: 10px; margin-top: 10px;">
                            <span class="tag">å¹²ç²®</span>
                            <span class="tag">æ¹¿ç²®</span>
                            <span class="tag">é›¶é£Ÿ</span>
                            <span class="tag">è¥å…»å“</span>
                        </div>
                        <div class="product-grid grid-3" style="margin-top: 20px;">
                            <div style="grid-column: 1 / -1; text-align: center; padding: 20px; color: var(--apple-gray-medium);">
                                <p>æš‚æ— çŒ«ç²®ä¸»é£Ÿå•†å“</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="category-section" data-category="toys">
                    <div class="category-header" onclick="toggleCategory('toys')">
                        <div class="category-info">
                            <span class="category-icon">ğŸ§¶</span>
                            <h4>ç©å…·ç”¨å“</h4>
                        </div>
                        <span class="category-arrow">â–¼</span>
                    </div>
                    <div class="category-content">
                        <p style="color: var(--apple-gray-medium); font-size: 14px;">é€—çŒ«æ£’ã€æ¿€å…‰ç¬”ã€æ¯›çº¿çƒã€çŒ«çˆ¬æ¶ã€ç›Šæ™ºç©å…·ã€è‡ªåŠ¨ç©å…·</p>
                        <div style="display: flex; gap: 10px; margin-top: 10px;">
                            <span class="tag">äº’åŠ¨ç©å…·</span>
                            <span class="tag">æ™ºèƒ½ç©å…·</span>
                            <span class="tag">çŒ«æŠ“æ¿</span>
                            <span class="tag">çŒ«çˆ¬æ¶</span>
                        </div>
                        <div class="product-grid grid-3" style="margin-top: 20px;">
                            <div style="grid-column: 1 / -1; text-align: center; padding: 20px; color: var(--apple-gray-medium);">
                                <p>æš‚æ— ç©å…·ç”¨å“å•†å“</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="category-section" data-category="supplies">
                    <div class="category-header" onclick="toggleCategory('supplies')">
                        <div class="category-info">
                            <span class="category-icon">ğŸ§¼</span>
                            <h4>æ—¥å¸¸ç”¨å“</h4>
                        </div>
                        <span class="category-arrow">â–¼</span>
                    </div>
                    <div class="category-content">
                        <p style="color: var(--apple-gray-medium); font-size: 14px;">çŒ«ç ‚ç›†ã€çŒ«ç ‚ã€é£Ÿç›†æ°´ç¢—ã€çŒ«çªã€çŒ«èƒŒåŒ…ã€èˆªç©ºç®±</p>
                        <div style="display: flex; gap: 10px; margin-top: 10px;">
                            <span class="tag">çŒ«ç ‚</span>
                            <span class="tag">é£Ÿç›†</span>
                            <span class="tag">çŒ«çª</span>
                            <span class="tag">å‡ºè¡Œç”¨å“</span>
                        </div>
                        <div class="product-grid grid-3" style="margin-top: 20px;">
                            <div style="grid-column: 1 / -1; text-align: center; padding: 20px; color: var(--apple-gray-medium);">
                                <p>æš‚æ— æ—¥å¸¸ç”¨å“å•†å“</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="category-section" data-category="grooming">
                    <div class="category-header" onclick="toggleCategory('grooming')">
                        <div class="category-info">
                            <span class="category-icon">ğŸ§´</span>
                            <h4>æ´—æŠ¤ç¾å®¹</h4>
                        </div>
                        <span class="category-arrow">â–¼</span>
                    </div>
                    <div class="category-content">
                        <p style="color: var(--apple-gray-medium); font-size: 14px;">çŒ«æ¢³ã€æŒ‡ç”²å‰ªã€æ²æµ´éœ²ã€æŠ¤æ¯›ç´ ã€ç‰™è†ç‰™åˆ·ã€ç¾å®¹å·¥å…·</p>
                        <div style="display: flex; gap: 10px; margin-top: 10px;">
                            <span class="tag">æ¢³æ¯›</span>
                            <span class="tag">æ´—æŠ¤</span>
                            <span class="tag">æŒ‡ç”²æŠ¤ç†</span>
                            <span class="tag">ç¾å®¹</span>
                        </div>
                        <div class="product-grid grid-3" style="margin-top: 20px;">
                            <div style="grid-column: 1 / -1; text-align: center; padding: 20px; color: var(--apple-gray-medium);">
                                <p>æš‚æ— æ´—æŠ¤ç¾å®¹å•†å“</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="category-section" data-category="health">
                    <div class="category-header" onclick="toggleCategory('health')">
                        <div class="category-info">
                            <span class="category-icon">ğŸ’Š</span>
                            <h4>å¥åº·ä¿å¥</h4>
                        </div>
                        <span class="category-arrow">â–¼</span>
                    </div>
                    <div class="category-content">
                        <p style="color: var(--apple-gray-medium); font-size: 14px;">é©±è™«è¯ã€ç»´ç”Ÿç´ ã€ç›Šç”ŸèŒã€åŒ–æ¯›è†ã€çŒ«ç”¨è¯å“ã€è¥å…»è†</p>
                        <div style="display: flex; gap: 10px; margin-top: 10px;">
                            <span class="tag">ä¿å¥å“</span>
                            <span class="tag">é©±è™«</span>
                            <span class="tag">è¯å“</span>
                            <span class="tag">è¥å…»å“</span>
                        </div>
                        <div class="product-grid grid-3" style="margin-top: 20px;">
                            <div style="grid-column: 1 / -1; text-align: center; padding: 20px; color: var(--apple-gray-medium);">
                                <p>æš‚æ— å¥åº·ä¿å¥å•†å“</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- æ¨èå•†å“ -->
            <h3 style="margin-bottom: var(--spacing-md);">ğŸ”¥ ç²¾é€‰å•†å“</h3>
            <div class="grid grid-3" id="recommendedProducts">
                <div style="text-align: center; padding: 40px; color: var(--apple-gray-medium);">
                    <div style="font-size: 48px; margin-bottom: var(--spacing-sm);">ğŸ›ï¸</div>
                    <p>æš‚æ— å•†å“ï¼Œè¯·è”ç³»ç®¡ç†å‘˜æ·»åŠ </p>
                </div>
            </div>
        </div>
    </div>

    <!-- ä¸ªäººä¸­å¿ƒé¡µé¢ -->
    <div id="profile" class="page">
        <div class="container">
            <h2>ğŸ‘¤ ä¸ªäººä¸­å¿ƒ</h2>
            
            <!-- ç”¨æˆ·ä¿¡æ¯å¡ç‰‡ -->
            <div class="card" style="margin-bottom: var(--spacing-lg);">
                <div style="padding: var(--spacing-md); display: flex; align-items: center; gap: var(--spacing-md);">
                    <div id="userAvatar" style="width: 60px; height: 60px; background: linear-gradient(135deg, var(--apple-blue), var(--apple-purple)); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 24px; color: white; cursor: pointer;" onclick="openUserProfile()">
                        ğŸ‘¤
                    </div>
                    <div style="flex: 1;">
                        <h3 id="userName">æ¸¸å®¢ç”¨æˆ·</h3>
                        <p id="userStatus" style="color: var(--apple-gray-medium); font-size: 14px;">æ¬¢è¿æ¥åˆ°é‡‘çŒ«ä¹‹å®¶</p>
                        <button class="btn btn-secondary" onclick="openUserProfile()" style="margin-top: 8px; font-size: 12px; padding: 4px 8px;">
                            âœï¸ ç¼–è¾‘èµ„æ–™
                        </button>
                    </div>
                </div>
            </div>

            <!-- åŠŸèƒ½èœå• -->
            <div class="card" style="margin-bottom: var(--spacing-lg);">
                <div style="padding: var(--spacing-md);">
                    <h3 style="margin-bottom: var(--spacing-md);">ğŸ”§ ç®¡ç†åŠŸèƒ½</h3>
                    <div class="menu-item" onclick="toggleLogin(event)" onmousedown="toggleLogin(event)" style="cursor: pointer; user-select: none;">
                        <span class="menu-icon">ğŸ”</span>
                        <span class="menu-text">ç®¡ç†å‘˜ç™»å½•</span>
                        <span class="menu-arrow">â†’</span>
                    </div>
                    <div id="adminMenuItems" style="display: none;">
                        <div class="menu-item" onclick="showAdminPanel()">
                            <span class="menu-icon">âš™ï¸</span>
                            <span class="menu-text">ç®¡ç†å‘˜é¢æ¿</span>
                            <span class="menu-arrow">â†’</span>
                        </div>
                        <div class="menu-item" onclick="handleLogout()">
                            <span class="menu-icon">ğŸšª</span>
                            <span class="menu-text">é€€å‡ºç™»å½•</span>
                            <span class="menu-arrow">â†’</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ç”¨æˆ·æœåŠ¡ -->
            <div class="card" style="margin-bottom: var(--spacing-lg);">
                <div style="padding: var(--spacing-md);">
                    <h3 style="margin-bottom: var(--spacing-md);">ğŸ› ï¸ ç”¨æˆ·æœåŠ¡</h3>
                    <div class="menu-item" onclick="showAddressManager(event)" onmousedown="showAddressManager(event)" style="cursor: pointer; user-select: none;">
                        <span class="menu-icon">ğŸ“</span>
                        <span class="menu-text">åœ°å€ç®¡ç†</span>
                        <span class="menu-arrow">â†’</span>
                    </div>
                    <div class="menu-item" onclick="showOrderManager(event)" onmousedown="showOrderManager(event)" style="cursor: pointer; user-select: none;">
                        <span class="menu-icon">ğŸ“¦</span>
                        <span class="menu-text">æˆ‘çš„è®¢å•</span>
                        <span class="menu-arrow">â†’</span>
                    </div>
                    <div class="menu-item" onclick="showSettings(event)" onmousedown="showSettings(event)" style="cursor: pointer; user-select: none;">
                        <span class="menu-icon">âš™ï¸</span>
                        <span class="menu-text">è®¾ç½®</span>
                        <span class="menu-arrow">â†’</span>
                    </div>
                </div>
            </div>

            <!-- å…³äºæˆ‘ä»¬ -->
            <div class="card">
                <div style="padding: var(--spacing-md);">
                    <h3 style="margin-bottom: var(--spacing-md);">â„¹ï¸ å…³äº</h3>
                    <div class="menu-item" onclick="showAbout(event)" onmousedown="showAbout(event)" style="cursor: pointer; user-select: none;">
                        <span class="menu-icon">ğŸ±</span>
                        <span class="menu-text">å…³äºé‡‘çŒ«ä¹‹å®¶</span>
                        <span class="menu-arrow">â†’</span>
                    </div>
                    <div class="menu-item" onclick="showVersion(event)" onmousedown="showVersion(event)" style="cursor: pointer; user-select: none;">
                        <span class="menu-icon">ğŸ“±</span>
                        <span class="menu-text">ç‰ˆæœ¬ä¿¡æ¯</span>
                        <span class="menu-arrow">â†’</span>
                    </div>
                    <div class="menu-item" onclick="checkAdminStatus(event)" onmousedown="checkAdminStatus(event)" style="cursor: pointer; user-select: none;">
                        <span class="menu-icon">ğŸ”</span>
                        <span class="menu-text">æ£€æŸ¥çŠ¶æ€</span>
                        <span class="menu-arrow">â†’</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Toasté€šçŸ¥å®¹å™¨ -->
    <div id="toast" class="toast"></div>

    <!-- ç§»åŠ¨ç«¯å¿«æ·å¯¼èˆª -->
    <nav class="mobile-quick-nav">
        <a href="#" class="mobile-quick-nav-item active" data-page="home" onclick="event.preventDefault(); showPage('home', this)">
            <span>ğŸ </span>
            <span>é¦–é¡µ</span>
        </a>
        <a href="#" class="mobile-quick-nav-item" data-page="cats" onclick="event.preventDefault(); showPage('cats', this)">
            <span>ğŸ±</span>
            <span>çŒ«å’ª</span>
        </a>
        <a href="#" class="mobile-quick-nav-item" data-page="hospital" onclick="event.preventDefault(); showPage('hospital', this)">
            <span>ğŸ¥</span>
            <span>åŒ»é™¢</span>
        </a>
        <a href="#" class="mobile-quick-nav-item" data-page="forum" onclick="event.preventDefault(); showPage('forum', this)">
            <span>ğŸ’¬</span>
            <span>è®ºå›</span>
        </a>
        <a href="#" class="mobile-quick-nav-item" data-page="shop" onclick="event.preventDefault(); showPage('shop', this)">
            <span>ğŸ›ï¸</span>
            <span>å•†åŸ</span>
        </a>
        <a href="#" class="mobile-quick-nav-item" data-page="profile" onclick="event.preventDefault(); showPage('profile', this)">
            <span>ğŸ‘¤</span>
            <span>æˆ‘çš„</span>
        </a>
    </nav>

    <!-- å³ä¸‹è§’ç§ä¿¡æŒ‰é’® -->
    <button class="fab" onclick="openMessageModal()" style="bottom: 80px;">âœ‰ï¸</button>

    <!-- ç§ä¿¡æ¨¡æ€æ¡† -->
    <div id="messageModal" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header">
                <h3>å‘é€ç§ä¿¡ç»™ç®¡ç†å‘˜</h3>
                <button class="btn btn-secondary" onclick="closeMessageModal()">Ã—</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>æ¶ˆæ¯å†…å®¹</label>
                    <textarea class="input" id="messageContent" rows="6" placeholder="è¯·è¾“å…¥æ‚¨æƒ³å¯¹ç®¡ç†å‘˜è¯´çš„è¯..."></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeMessageModal()">å–æ¶ˆ</button>
                <button class="btn btn-primary" onclick="sendMessage()">å‘é€</button>
            </div>
        </div>
    </div>

    <!-- ç™»å½•æ¨¡æ€æ¡† -->
    <div id="loginModal" class="modal-overlay" onclick="if(event.target === this) closeLoginModal()">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="loginTitle">ç®¡ç†å‘˜ç™»å½•</h3>
                <button class="btn btn-secondary" onclick="closeLoginModal()">Ã—</button>
            </div>
            <div class="modal-body">
                <div style="background: var(--apple-gray-light); padding: var(--spacing-sm); border-radius: var(--border-radius-sm); margin-bottom: var(--spacing-md);">
                    <p style="color: var(--apple-gray-dark); font-size: 14px; margin: 0;">
                        <strong>æ™®é€šç”¨æˆ·æ— éœ€ç™»å½•</strong>å³å¯ä½¿ç”¨æ‰€æœ‰åŠŸèƒ½ã€‚<br>
                        åªæœ‰ç®¡ç†å‘˜éœ€è¦ç™»å½•æ¥ç®¡ç†çŒ«å’ªä¿¡æ¯ã€‚
                    </p>
                </div>
                <div class="form-group">
                    <label>ç®¡ç†å‘˜è´¦å·</label>
                    <input type="text" class="input" id="username" placeholder="è¯·è¾“å…¥ç®¡ç†å‘˜è´¦å·...">
                </div>
                <div class="form-group">
                    <label>å¯†ç </label>
                    <input type="password" class="input" id="password" placeholder="è¯·è¾“å…¥å¯†ç ...">
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeLoginModal()">å–æ¶ˆ</button>
                <button class="btn btn-primary" onclick="handleLogin()">ç®¡ç†å‘˜ç™»å½•</button>
            </div>
        </div>
    </div>

    <!-- å›¾ç‰‡æŸ¥çœ‹å™¨æ¨¡æ€æ¡† -->
    <div id="imageViewerModal" class="modal-overlay" onclick="closeImageViewer(event)">
        <div class="image-viewer-content">
            <div class="image-viewer-header">
                <h3>å›¾ç‰‡æŸ¥çœ‹</h3>
                <button class="btn btn-secondary" onclick="closeImageViewer()">Ã—</button>
            </div>
            <div class="image-viewer-body">
                <img id="viewerImage" src="" alt="æŸ¥çœ‹å›¾ç‰‡" style="max-width: 100%; max-height: 80vh; border-radius: var(--border-radius-sm);">
            </div>
            <div class="image-viewer-footer">
                <button class="btn btn-primary" onclick="downloadImage()">ğŸ’¾ ä¸‹è½½å›¾ç‰‡</button>
                <button class="btn btn-secondary" onclick="shareImage()">ğŸ”— å¤åˆ¶é“¾æ¥</button>
            </div>
        </div>
    </div>

    <!-- ç”¨æˆ·èµ„æ–™ç¼–è¾‘æ¨¡æ€æ¡† -->
    <div id="userProfileModal" class="modal-overlay" onclick="if(event.target === this) closeUserProfile()">
        <div class="modal-content">
            <div class="modal-header">
                <h3>ç¼–è¾‘ä¸ªäººèµ„æ–™</h3>
                <button class="btn btn-secondary" onclick="closeUserProfile()">Ã—</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>ç”¨æˆ·å</label>
                    <input type="text" class="input" id="profileUserName" placeholder="è¯·è¾“å…¥ç”¨æˆ·å..." maxlength="20">
                </div>
                <div class="form-group">
                    <label>ä¸ªæ€§ç­¾å</label>
                    <textarea class="input" id="profileBio" rows="3" placeholder="ä»‹ç»ä¸€ä¸‹è‡ªå·±..." maxlength="100"></textarea>
                </div>
                <div class="form-group">
                    <label>å¤´åƒé€‰æ‹©</label>
                    <div style="display: grid; grid-template-columns: repeat(6, 1fr); gap: 10px; margin-bottom: 15px;">
                        <div class="avatar-option" data-avatar="ğŸ˜º" onclick="selectAvatar('ğŸ˜º')">ğŸ˜º</div>
                        <div class="avatar-option" data-avatar="ğŸ˜¸" onclick="selectAvatar('ğŸ˜¸')">ğŸ˜¸</div>
                        <div class="avatar-option" data-avatar="ğŸ˜¹" onclick="selectAvatar('ğŸ˜¹')">ğŸ˜¹</div>
                        <div class="avatar-option" data-avatar="ğŸ˜»" onclick="selectAvatar('ğŸ˜»')">ğŸ˜»</div>
                        <div class="avatar-option" data-avatar="ğŸ˜¼" onclick="selectAvatar('ğŸ˜¼')">ğŸ˜¼</div>
                        <div class="avatar-option" data-avatar="ğŸ˜½" onclick="selectAvatar('ğŸ˜½')">ğŸ˜½</div>
                        <div class="avatar-option" data-avatar="ğŸ™€" onclick="selectAvatar('ğŸ™€')">ğŸ™€</div>
                        <div class="avatar-option" data-avatar="ğŸ˜¿" onclick="selectAvatar('ğŸ˜¿')">ğŸ˜¿</div>
                        <div class="avatar-option" data-avatar="ğŸ±" onclick="selectAvatar('ğŸ±')">ğŸ±</div>
                        <div class="avatar-option" data-avatar="ğŸˆ" onclick="selectAvatar('ğŸˆ')">ğŸˆ</div>
                        <div class="avatar-option" data-avatar="ğŸˆâ€â¬›" onclick="selectAvatar('ğŸˆâ€â¬›')">ğŸˆâ€â¬›</div>
                        <div class="avatar-option" data-avatar="ğŸ¦" onclick="selectAvatar('ğŸ¦')">ğŸ¦</div>
                        <div class="avatar-option" data-avatar="ğŸ‘¤" onclick="selectAvatar('ğŸ‘¤')">ğŸ‘¤</div>
                        <div class="avatar-option" data-avatar="ğŸ‘¨" onclick="selectAvatar('ğŸ‘¨')">ğŸ‘¨</div>
                        <div class="avatar-option" data-avatar="ğŸ‘©" onclick="selectAvatar('ğŸ‘©')">ğŸ‘©</div>
                        <div class="avatar-option" data-avatar="ğŸ§‘" onclick="selectAvatar('ğŸ§‘')">ğŸ§‘</div>
                        <div class="avatar-option" data-avatar="ğŸ‘¦" onclick="selectAvatar('ğŸ‘¦')">ğŸ‘¦</div>
                        <div class="avatar-option" data-avatar="ğŸ‘§" onclick="selectAvatar('ğŸ‘§')">ğŸ‘§</div>
                        <div class="avatar-option" data-avatar="ğŸ¶" onclick="selectAvatar('ğŸ¶')">ğŸ¶</div>
                        <div class="avatar-option" data-avatar="ğŸ•" onclick="selectAvatar('ğŸ•')">ğŸ•</div>
                        <div class="avatar-option" data-avatar="ğŸ¦Š" onclick="selectAvatar('ğŸ¦Š')">ğŸ¦Š</div>
                        <div class="avatar-option" data-avatar="ğŸ°" onclick="selectAvatar('ğŸ°')">ğŸ°</div>
                    </div>
                    <div style="text-align: center; margin-top: 10px;">
                        <small style="color: var(--apple-gray-medium);">å½“å‰é€‰æ‹©ï¼š<span id="currentAvatar" style="font-size: 24px;">ğŸ˜º</span></small>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeUserProfile()">å–æ¶ˆ</button>
                <button class="btn btn-primary" onclick="saveUserProfile()">ä¿å­˜</button>
            </div>
        </div>
    </div>

    <script>
        // åº”ç”¨æ•°æ®
        const appData = {
            cats: [],
            hospitals: [], // ç®¡ç†å‘˜ä¸Šä¼ çš„æ¨èåŒ»é™¢
            userRecommendedHospitals: [], // ç”¨æˆ·æ¨èåŒ»é™¢
            nearbyHospitals: [], // åŸºäºåœ°ç†ä½ç½®çš„é™„è¿‘åŒ»é™¢
            posts: [],
            products: [],
            reviews: {},
            messages: [],
            currentLocation: {
                lat: 30.2741, // æ­å·å¸‚ä¸­å¿ƒåæ ‡
                lng: 120.1551
            },
            currentUser: null,
            userProfile: null, // æ™®é€šç”¨æˆ·èµ„æ–™
            isLoggedIn: false,
            isAdmin: false,
            map: null, // åœ°å›¾å®ä¾‹
            hospitalMarkers: [] // åŒ»é™¢æ ‡è®°æ•°ç»„
        };

        // æœ¬åœ°å­˜å‚¨åˆå§‹åŒ–
        function initializeLocalStorage() {
            const storedData = localStorage.getItem('petCommunityData');
            if (storedData) {
                const data = JSON.parse(storedData);
                Object.assign(appData, data);
                console.log('ğŸ“¦ ä»æœ¬åœ°å­˜å‚¨åŠ è½½æ•°æ®:', data);
                
                // ç¡®ä¿ç”¨æˆ·æ¨èåŒ»é™¢æ•°ç»„å­˜åœ¨
                if (!appData.userRecommendedHospitals) {
                    appData.userRecommendedHospitals = [];
                }
                
                // ç¡®ä¿åŒ»é™¢æ’è¡Œæ¦œæ•°ç»„å­˜åœ¨
                if (!appData.hospitalRanking) {
                    appData.hospitalRanking = [];
                }
            } else {
                console.log('ğŸ†• ä½¿ç”¨é»˜è®¤æ•°æ®åˆå§‹åŒ–');
                // åˆå§‹åŒ–å¿…è¦çš„æ•°æ®ç»“æ„
                appData.userRecommendedHospitals = [];
                appData.hospitalRanking = [];
                
                // åˆå§‹åŒ–é»˜è®¤æ’è¡Œæ¦œæ•°æ®
                initDefaultHospitalRanking();
                
                saveToLocalStorage();
            }
        }

        // åˆå§‹åŒ–é»˜è®¤åŒ»é™¢æ’è¡Œæ¦œ
        function initDefaultHospitalRanking() {
            appData.hospitalRanking = [
                {
                    id: 1,
                    name: 'æ­å·çˆ±å¿ƒå® ç‰©åŒ»é™¢',
                    address: 'æ­å·å¸‚è¥¿æ¹–åŒºæ–‡ä¸‰è·¯123å·',
                    phone: '0571-88888888',
                    likes: 156,
                    rating: 4.8,
                    description: 'ä¸“ä¸šå® ç‰©åŒ»ç–—æœåŠ¡ï¼Œè®¾å¤‡å…ˆè¿›'
                },
                {
                    id: 2,
                    name: 'æ­å·å® ç‰©ä¸­å¿ƒåŒ»é™¢',
                    address: 'æ­å·å¸‚æ‹±å¢…åŒºæ¹–å¢…å—è·¯456å·',
                    phone: '0571-99999999',
                    likes: 128,
                    rating: 4.6,
                    description: '24å°æ—¶æ€¥è¯ŠæœåŠ¡ï¼Œç»éªŒä¸°å¯Œ'
                },
                {
                    id: 3,
                    name: 'æ­å·èŒå® å® ç‰©åŒ»é™¢',
                    address: 'æ­å·å¸‚ä¸ŠåŸåŒºé’±æ±Ÿè·¯789å·',
                    phone: '0571-77777777',
                    likes: 95,
                    rating: 4.5,
                    description: 'ç¯å¢ƒæ¸©é¦¨ï¼ŒæœåŠ¡è´´å¿ƒ'
                }
            ];
        }

        // æ¸²æŸ“åŒ»é™¢æ’è¡Œæ¦œ
        function renderHospitalRanking() {
            const container = document.getElementById('hospitalRankingList');
            if (!container) return;

            let ranking = [...(appData.hospitalRanking || [])];
            
            // æŒ‰ç‚¹èµé‡æ’åº
            ranking.sort((a, b) => b.likes - a.likes);

            if (ranking.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 20px; color: var(--apple-gray-medium);">
                        <p>æš‚æ— æ’è¡Œæ¦œæ•°æ®</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = ranking.map((hospital, index) => {
                const rankClass = index === 0 ? 'gold' : index === 1 ? 'silver' : index === 2 ? 'bronze' : 'normal';
                const rankEmoji = index === 0 ? 'ğŸ¥‡' : index === 1 ? 'ğŸ¥ˆ' : index === 2 ? 'ğŸ¥‰' : `${index + 1}`;

                return `
                    <div class="ranking-item" onclick="showHospitalDetails(${hospital.id})">
                        <div class="ranking-number ${rankClass}">
                            ${rankEmoji}
                        </div>
                        <div class="ranking-info">
                            <div class="ranking-name">${hospital.name}</div>
                            <div class="ranking-details">
                                <span>ğŸ“ ${hospital.address}</span>
                                <span>â­ ${hospital.rating}</span>
                            </div>
                        </div>
                        <div class="ranking-likes">
                            <span>â¤ï¸</span>
                            <span>${hospital.likes}</span>
                        </div>
                        ${appData.isAdmin ? `
                            <div class="ranking-actions">
                                <button class="rank-up-btn" onclick="event.stopPropagation(); moveHospitalRank(${hospital.id}, -1)" title="ä¸Šå‡æ’å">â¬†ï¸</button>
                                <button class="rank-down-btn" onclick="event.stopPropagation(); moveHospitalRank(${hospital.id}, 1)" title="ä¸‹é™æ’å">â¬‡ï¸</button>
                            </div>
                        ` : ''}
                    </div>
                `;
            }).join('');
        }

        // ç§»åŠ¨åŒ»é™¢æ’å
        function moveHospitalRank(hospitalId, direction) {
            if (!appData.hospitalRanking || appData.hospitalRanking.length === 0) return;

            const index = appData.hospitalRanking.findIndex(h => h.id === hospitalId);
            if (index === -1) return;

            const newIndex = index + direction;
            if (newIndex < 0 || newIndex >= appData.hospitalRanking.length) return;

            // äº¤æ¢ä½ç½®
            [appData.hospitalRanking[index], appData.hospitalRanking[newIndex]] = 
            [appData.hospitalRanking[newIndex], appData.hospitalRanking[index]];

            saveToLocalStorage();
            renderHospitalRanking();
            showToast('æ’åå·²æ›´æ–°', 'success');
        }

        // æ˜¾ç¤ºåŒ»é™¢è¯¦æƒ…
        function showHospitalDetails(hospitalId) {
            const hospital = appData.hospitalRanking.find(h => h.id === hospitalId);
            if (!hospital) return;

            showToast(`${hospital.name} - ${hospital.address} - ç”µè¯: ${hospital.phone}`, 'info');
        }

        // æ‰“å¼€åŒ»é™¢æ’è¡Œæ¦œç®¡ç†å™¨
        function openHospitalRankingManager() {
            const modal = document.getElementById('hospitalRankingManagerModal');
            modal.classList.add('active');
            
            // æ¸²æŸ“å¯ç¼–è¾‘çš„æ’è¡Œæ¦œ
            renderEditableRanking();
            
            // é˜»æ­¢èƒŒæ™¯æ»šåŠ¨
            document.body.style.overflow = 'hidden';
        }

        // å…³é—­åŒ»é™¢æ’è¡Œæ¦œç®¡ç†å™¨
        function closeHospitalRankingManager() {
            const modal = document.getElementById('hospitalRankingManagerModal');
            modal.classList.remove('active');
            
            // æ¢å¤èƒŒæ™¯æ»šåŠ¨
            document.body.style.overflow = '';
        }

        // æ¸²æŸ“å¯ç¼–è¾‘çš„æ’è¡Œæ¦œ
        function renderEditableRanking() {
            const container = document.getElementById('sortableRankingList');
            if (!container) return;
            
            let ranking = [...(appData.hospitalRanking || [])];
            
            if (ranking.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 20px; color: var(--apple-gray-medium);">
                        <p>æš‚æ— æ’è¡Œæ¦œæ•°æ®</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = ranking.map((hospital, index) => `
                <div class="ranking-item" data-hospital-id="${hospital.id}" draggable="true">
                    <div class="ranking-number" style="background: var(--apple-gray-medium); color: white; cursor: move;">
                        ${index + 1}
                    </div>
                    <div class="ranking-info">
                        <div class="ranking-name">${hospital.name}</div>
                        <div class="ranking-details">
                            <span>ğŸ“ ${hospital.address}</span>
                            <span>â­ ${hospital.rating}</span>
                        </div>
                    </div>
                    <div class="ranking-likes">
                        <span>â¤ï¸</span>
                        <input type="number" value="${hospital.likes}" min="0" style="width: 60px; padding: 4px; border: 1px solid var(--apple-border); border-radius: 4px;" onchange="updateHospitalLikes(${hospital.id}, this.value)">
                    </div>
                    <div class="ranking-actions">
                        <button class="rank-up-btn" onclick="moveHospitalInEditor(${hospital.id}, -1)" title="ä¸Šå‡æ’å">â¬†ï¸</button>
                        <button class="rank-down-btn" onclick="moveHospitalInEditor(${hospital.id}, 1)" title="ä¸‹é™æ’å">â¬‡ï¸</button>
                        <button class="btn btn-secondary" onclick="editHospitalInRanking(${hospital.id})" title="ç¼–è¾‘ä¿¡æ¯" style="padding: 4px 8px; font-size: 12px;">âœï¸</button>
                        <button class="btn btn-secondary" onclick="removeHospitalFromRanking(${hospital.id})" title="åˆ é™¤" style="padding: 4px 8px; font-size: 12px; background: var(--apple-red); color: white;">ğŸ—‘ï¸</button>
                    </div>
                </div>
            `).join('');

            // åˆå§‹åŒ–æ‹–æ‹½åŠŸèƒ½
            initializeDragAndDrop();
        }

        // åˆå§‹åŒ–æ‹–æ‹½åŠŸèƒ½
        function initializeDragAndDrop() {
            const items = document.querySelectorAll('#sortableRankingList .ranking-item');
            let draggedItem = null;

            items.forEach(item => {
                item.addEventListener('dragstart', function(e) {
                    draggedItem = this;
                    this.style.opacity = '0.5';
                });

                item.addEventListener('dragend', function(e) {
                    this.style.opacity = '';
                });

                item.addEventListener('dragover', function(e) {
                    e.preventDefault();
                    if (this !== draggedItem) {
                        const rect = this.getBoundingClientRect();
                        const midpoint = rect.top + rect.height / 2;
                        if (e.clientY < midpoint) {
                            this.parentNode.insertBefore(draggedItem, this);
                        } else {
                            this.parentNode.insertBefore(draggedItem, this.nextSibling);
                        }
                    }
                });
            });
        }

        // åœ¨ç¼–è¾‘å™¨ä¸­ç§»åŠ¨åŒ»é™¢æ’å
        function moveHospitalInEditor(hospitalId, direction) {
            const container = document.getElementById('sortableRankingList');
            const items = container.querySelectorAll('.ranking-item');
            const currentIndex = Array.from(items).findIndex(item => 
                parseInt(item.dataset.hospitalId) === hospitalId
            );
            
            if (currentIndex === -1) return;
            
            const newIndex = currentIndex + direction;
            if (newIndex < 0 || newIndex >= items.length) return;
            
            if (direction === -1) {
                container.insertBefore(items[newIndex], items[currentIndex]);
            } else {
                container.insertBefore(items[currentIndex], items[newIndex].nextSibling);
            }
        }

        // æ›´æ–°åŒ»é™¢ç‚¹èµæ•°
        function updateHospitalLikes(hospitalId, newLikes) {
            const hospital = appData.hospitalRanking.find(h => h.id === hospitalId);
            if (hospital) {
                hospital.likes = parseInt(newLikes) || 0;
                showToast('ç‚¹èµæ•°å·²æ›´æ–°', 'success');
            }
        }

        // ä»æ’è¡Œæ¦œä¸­ç§»é™¤åŒ»é™¢
        function removeHospitalFromRanking(hospitalId) {
            if (confirm('ç¡®å®šè¦ä»æ’è¡Œæ¦œä¸­ç§»é™¤è¿™å®¶åŒ»é™¢å—ï¼Ÿ')) {
                appData.hospitalRanking = appData.hospitalRanking.filter(h => h.id !== hospitalId);
                renderEditableRanking();
                showToast('åŒ»é™¢å·²ä»æ’è¡Œæ¦œä¸­ç§»é™¤', 'success');
            }
        }

        // æ·»åŠ æ–°åŒ»é™¢åˆ°æ’è¡Œæ¦œ
        function addNewHospitalToRanking() {
            const name = prompt('è¯·è¾“å…¥åŒ»é™¢åç§°ï¼š');
            if (!name) return;
            
            const address = prompt('è¯·è¾“å…¥åŒ»é™¢åœ°å€ï¼š');
            if (!address) return;
            
            const phone = prompt('è¯·è¾“å…¥è”ç³»ç”µè¯ï¼š') || '';
            const rating = parseFloat(prompt('è¯·è¾“å…¥è¯„åˆ†ï¼ˆ1-5ï¼‰ï¼š')) || 4.0;
            
            const newHospital = {
                id: Date.now(),
                name: name,
                address: address,
                phone: phone,
                likes: 0,
                rating: Math.min(5, Math.max(1, rating)),
                description: ''
            };
            
            appData.hospitalRanking.push(newHospital);
            renderEditableRanking();
            showToast('æ–°åŒ»é™¢å·²æ·»åŠ åˆ°æ’è¡Œæ¦œ', 'success');
        }

        // ç¼–è¾‘æ’è¡Œæ¦œä¸­çš„åŒ»é™¢ä¿¡æ¯
        function editHospitalInRanking(hospitalId) {
            const hospital = appData.hospitalRanking.find(h => h.id === hospitalId);
            if (!hospital) return;
            
            const newName = prompt('åŒ»é™¢åç§°ï¼š', hospital.name);
            if (!newName) return;
            
            const newAddress = prompt('åŒ»é™¢åœ°å€ï¼š', hospital.address);
            if (!newAddress) return;
            
            const newPhone = prompt('è”ç³»ç”µè¯ï¼š', hospital.phone);
            const newRating = parseFloat(prompt('è¯„åˆ†ï¼ˆ1-5ï¼‰ï¼š', hospital.rating));
            const newDescription = prompt('åŒ»é™¢ç®€ä»‹ï¼š', hospital.description || '');
            
            hospital.name = newName;
            hospital.address = newAddress;
            hospital.phone = newPhone;
            hospital.rating = isNaN(newRating) ? hospital.rating : Math.min(5, Math.max(1, newRating));
            hospital.description = newDescription || '';
            
            renderEditableRanking();
            showToast('åŒ»é™¢ä¿¡æ¯å·²æ›´æ–°', 'success');
        }

        // é‡ç½®æ’è¡Œæ¦œä¸ºé»˜è®¤
        function resetRankingToDefault() {
            if (confirm('ç¡®å®šè¦é‡ç½®ä¸ºé»˜è®¤æ’è¡Œæ¦œå—ï¼Ÿå½“å‰æ›´æ”¹å°†ä¸¢å¤±ã€‚')) {
                initDefaultHospitalRanking();
                renderEditableRanking();
                showToast('æ’è¡Œæ¦œå·²é‡ç½®ä¸ºé»˜è®¤', 'success');
            }
        }

        // ä¿å­˜æ’è¡Œæ¦œæ›´æ”¹
        function saveRankingChanges() {
            const container = document.getElementById('sortableRankingList');
            const items = container.querySelectorAll('.ranking-item');
            
            const newRanking = [];
            items.forEach((item, index) => {
                const hospitalId = parseInt(item.dataset.hospitalId);
                const hospital = appData.hospitalRanking.find(h => h.id === hospitalId);
                if (hospital) {
                    newRanking.push(hospital);
                }
            });
            
            appData.hospitalRanking = newRanking;
            saveToLocalStorage();
            renderHospitalRanking();
            closeHospitalRankingManager();
            showToast('æ’è¡Œæ¦œå·²ä¿å­˜', 'success');
        }

        // ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨
        function saveToLocalStorage() {
            localStorage.setItem('petCommunityData', JSON.stringify(appData));
            console.log('ğŸ’¾ æ•°æ®å·²ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨');
        }

        // ç®¡ç†å‘˜è´¦å·ä¿¡æ¯
        const ADMIN_CREDENTIALS = {
            username: 'abc123',
            password: 'abc123'
        };

        // é¡µé¢åˆ‡æ¢å‡½æ•° - æ ¸å¿ƒåŠŸèƒ½
        function showPage(pageId, element) {
            try {
                console.log('ğŸ”„ åˆ‡æ¢åˆ°é¡µé¢:', pageId);
                
                // 1. éšè—æ‰€æœ‰é¡µé¢ - å¼ºåˆ¶è®¾ç½®æ ·å¼
                document.querySelectorAll('.page').forEach(page => {
                    page.classList.remove('active');
                    page.style.display = 'none';
                    page.style.visibility = 'hidden';
                    page.style.opacity = '0';
                });
                
                // 2. æ˜¾ç¤ºç›®æ ‡é¡µé¢ - å¼ºåˆ¶è®¾ç½®æ ·å¼
                const targetPage = document.getElementById(pageId);
                if (targetPage) {
                    targetPage.classList.add('active');
                    targetPage.style.display = 'block';
                    targetPage.style.visibility = 'visible';
                    targetPage.style.opacity = '1';
                    console.log('âœ… é¡µé¢æ˜¾ç¤ºæˆåŠŸ:', pageId);
                } else {
                    console.error('âŒ é¡µé¢ä¸å­˜åœ¨:', pageId);
                    showToast('é¡µé¢ä¸å­˜åœ¨: ' + pageId, 'error');
                    return;
                }
                
                // 3. æ›´æ–°å¯¼èˆªçŠ¶æ€
                document.querySelectorAll('.nav-link').forEach(link => {
                    link.classList.remove('active');
                });
                
                document.querySelectorAll('.mobile-quick-nav-item').forEach(item => {
                    item.classList.remove('active');
                });
                
                if (element && element.classList) {
                    element.classList.add('active');
                } else {
                    // å¦‚æœæ²¡æœ‰ä¼ å…¥elementï¼Œå°è¯•é€šè¿‡data-pageæ‰¾åˆ°å¯¹åº”å¯¼èˆª
                    const navLink = document.querySelector(`[data-page="${pageId}"]`);
                    if (navLink) {
                        navLink.classList.add('active');
                    }
                    
                    // åŒæ—¶æ›´æ–°ç§»åŠ¨ç«¯å¯¼èˆª
                    const mobileNavLink = document.querySelector(`.mobile-quick-nav-item[data-page="${pageId}"]`);
                    if (mobileNavLink) {
                        mobileNavLink.classList.add('active');
                    }
                }
                
                // 4. æ»šåŠ¨åˆ°é¡¶éƒ¨
                window.scrollTo(0, 0);
                
                // 5. æ£€æŸ¥å¹¶å¯ç”¨ç®¡ç†å‘˜åŠŸèƒ½ï¼ˆé’ˆå¯¹æ¯ä¸ªé¡µé¢ï¼‰
                if (appData.isAdmin) {
                    console.log('é¡µé¢åˆ‡æ¢æ—¶æ£€æŸ¥ç®¡ç†å‘˜çŠ¶æ€ï¼Œå¯ç”¨ç›¸å…³åŠŸèƒ½...');
                    setTimeout(() => {
                        enableAdminFeatures();
                    }, 100);
                }
                
                // 6. æ˜¾ç¤ºæˆåŠŸæç¤º
                console.log('âœ… é¡µé¢åˆ‡æ¢å®Œæˆ:', pageId);
                showToast('å·²åˆ‡æ¢åˆ°:' + getPageName(pageId), 'success');
                
            } catch (error) {
                console.error('âŒ é¡µé¢åˆ‡æ¢é”™è¯¯:', error);
                showToast('é¡µé¢åˆ‡æ¢å¤±è´¥: ' + error.message, 'error');
            }
        }

        // è·å–é¡µé¢ä¸­æ–‡åç§°
        function getPageName(pageId) {
            const pageNames = {
                'home': 'é¦–é¡µ',
                'cats': 'çŒ«å’ªç®¡ç†',
                'hospital': 'å® ç‰©åŒ»é™¢',
                'logistics': 'ç‰©æµæŸ¥è¯¢',
                'forum': 'è®ºå›äº¤æµ',
                'shop': 'å® ç‰©å•†åŸ',
                'profile': 'ä¸ªäººä¸­å¿ƒ'
            };
            return pageNames[pageId] || pageId;
        }

        // Toasté€šçŸ¥å‡½æ•°
        function showToast(message, type = 'info') {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.className = 'toast ' + type;
            
            toast.classList.add('show');
            
            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }

        // æ·»åŠ çŒ«å’ª
        function addCat() {
            showToast('æ·»åŠ çŒ«å’ªåŠŸèƒ½å¼€å‘ä¸­...', 'info');
        }

        // æœç´¢é™„è¿‘åŒ»é™¢
        function searchNearbyHospitals() {
            const searchTerm = document.getElementById('hospitalSearch').value.trim();
            
            if (!searchTerm) {
                showToast('è¯·è¾“å…¥æœç´¢å…³é”®è¯', 'warning');
                return;
            }
            
            // é¦–å…ˆè·å–ä½ç½®
            loadNearbyHospitalsWithSearch(searchTerm);
        }

        // å¸¦æœç´¢å…³é”®è¯åŠ è½½é™„è¿‘åŒ»é™¢
        function loadNearbyHospitalsWithSearch(searchTerm) {
            showToast('æ­£åœ¨æœç´¢é™„è¿‘çš„å® ç‰©åŒ»é™¢...', 'info');
            
            // é¦–å…ˆå°è¯•è·å–ç”¨æˆ·çœŸå®ä½ç½®
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    function(position) {
                        // æˆåŠŸè·å–ä½ç½®
                        appData.currentLocation = {
                            lat: position.coords.latitude,
                            lng: position.coords.longitude
                        };
                        console.log('è·å–åˆ°çœŸå®ä½ç½®:', appData.currentLocation);
                        
                        // æ ¹æ®æœç´¢è¯ç”ŸæˆåŒ¹é…çš„åŒ»é™¢
                        generateSearchNearbyHospitals(searchTerm);
                    },
                    function(error) {
                        // å®šä½å¤±è´¥ï¼Œä½¿ç”¨é»˜è®¤ä½ç½®
                        console.warn('å®šä½å¤±è´¥ï¼Œä½¿ç”¨é»˜è®¤ä½ç½®:', error.message);
                        appData.currentLocation = {
                            lat: 30.2741,
                            lng: 120.1551
                        };
                        
                        // æ ¹æ®æœç´¢è¯ç”ŸæˆåŒ¹é…çš„åŒ»é™¢
                        generateSearchNearbyHospitals(searchTerm);
                    },
                    {
                        enableHighAccuracy: true,
                        timeout: 5000,
                        maximumAge: 0
                    }
                );
            } else {
                // æµè§ˆå™¨ä¸æ”¯æŒå®šä½
                appData.currentLocation = {
                    lat: 30.2741,
                    lng: 120.1551
                };
                
                // æ ¹æ®æœç´¢è¯ç”ŸæˆåŒ¹é…çš„åŒ»é™¢
                generateSearchNearbyHospitals(searchTerm);
            }
        }

        // ç”Ÿæˆæœç´¢ç»“æœé™„è¿‘çš„åŒ»é™¢
        function generateSearchNearbyHospitals(searchTerm) {
            const currentCity = getCityByLocation(appData.currentLocation.lat, appData.currentLocation.lng);
            
            // åŸºäºæœç´¢è¯ç”Ÿæˆç›¸å…³çš„åŒ»é™¢
            const hospitalTemplates = {
                'å® ç‰©åŒ»é™¢': [
                    { name: `${currentCity}å¸‚å® ç‰©åŒ»é™¢`, baseName: 'å¸‚å® ç‰©åŒ»é™¢' },
                    { name: `${currentCity}çˆ±å® åŒ»é™¢`, baseName: 'çˆ±å® åŒ»é™¢' },
                    { name: `${currentCity}ç‘é¹å® ç‰©åŒ»é™¢`, baseName: 'ç‘é¹å® ç‰©åŒ»é™¢' },
                    { name: `${currentCity}å® ç¦é‘«åŒ»é™¢`, baseName: 'å® ç¦é‘«åŒ»é™¢' }
                ],
                'çŒ«ç§‘': [
                    { name: `${currentCity}çŒ«ç§‘ä¸“ç§‘åŒ»é™¢`, baseName: 'çŒ«ç§‘ä¸“ç§‘åŒ»é™¢' },
                    { name: `${currentCity}çŒ«å’ªä¸“ç§‘è¯Šæ‰€`, baseName: 'çŒ«å’ªä¸“ç§‘è¯Šæ‰€' },
                    { name: `${currentCity}çˆ±çŒ«åŒ»é™¢`, baseName: 'çˆ±çŒ«åŒ»é™¢' }
                ],
                '24å°æ—¶': [
                    { name: `${currentCity}24å°æ—¶å® ç‰©åŒ»é™¢`, baseName: '24å°æ—¶å® ç‰©åŒ»é™¢' },
                    { name: `${currentCity}æ€¥è¯Šå® ç‰©åŒ»é™¢`, baseName: 'æ€¥è¯Šå® ç‰©åŒ»é™¢' },
                    { name: `${currentCity}å¤œé—´å® ç‰©åŒ»é™¢`, baseName: 'å¤œé—´å® ç‰©åŒ»é™¢' }
                ]
            };
            
            let selectedTemplates = [];
            
            // æ ¹æ®æœç´¢è¯é€‰æ‹©æ¨¡æ¿
            for (const [key, templates] of Object.entries(hospitalTemplates)) {
                if (searchTerm.includes(key)) {
                    selectedTemplates = selectedTemplates.concat(templates);
                }
            }
            
            // å¦‚æœæ²¡æœ‰åŒ¹é…çš„æ¨¡æ¿ï¼Œä½¿ç”¨é€šç”¨åŒ»é™¢æ¨¡æ¿
            if (selectedTemplates.length === 0) {
                selectedTemplates = [
                    { name: `${currentCity}${searchTerm}å® ç‰©åŒ»é™¢`, baseName: searchTerm },
                    { name: `${currentCity}${searchTerm}åŒ»é™¢`, baseName: searchTerm },
                    { name: `${currentCity}çˆ±${searchTerm}åŒ»é™¢`, baseName: searchTerm }
                ];
            }
            
            appData.nearbyHospitals = [];
            
            selectedTemplates.forEach((template, index) => {
                const angle = (index / selectedTemplates.length) * 2 * Math.PI;
                const distance = 2 + Math.random() * 8; // 2-10å…¬é‡Œ
                
                const hospital = {
                    id: 'nearby_' + Date.now() + '_' + index,
                    name: template.name,
                    address: `${currentCity}æŸåŒºæŸè¡—é“${Math.floor(Math.random() * 999) + 1}å·`,
                    phone: `05${Math.floor(Math.random() * 90) + 10}-${Math.floor(Math.random() * 90000000) + 10000000}`,
                    lat: appData.currentLocation.lat + (distance * Math.cos(angle)) / 111,
                    lng: appData.currentLocation.lng + (distance * Math.sin(angle)) / (111 * Math.cos(appData.currentLocation.lat * Math.PI / 180)),
                    distance: distance,
                    distanceText: `${distance.toFixed(1)}km`,
                    rating: 4.0 + Math.random() * 1.0,
                    reviews: [],
                    city: currentCity,
                    tags: ['æœç´¢ç»“æœ', 'å® ç‰©åŒ»é™¢', '24å°æ—¶æœåŠ¡'],
                    description: `ä¸“ä¸šçš„${template.baseName}ï¼Œæä¾›å…¨é¢çš„å® ç‰©åŒ»ç–—æœåŠ¡`,
                    images: []
                };
                
                hospital.reviews = generateMockReviews();
                appData.nearbyHospitals.push(hospital);
            });
            
            // æ¸²æŸ“æœç´¢ç»“æœ
            renderNearbyHospitals();
            renderRecommendedHospitals();
            
            // åœ¨åœ°å›¾ä¸Šæ˜¾ç¤ºåŒ»é™¢æ ‡è®°
            updateMapWithHospitals();
            
            showToast(`æœç´¢å®Œæˆï¼Œæ‰¾åˆ° ${appData.nearbyHospitals.length} å®¶${searchTerm}ç›¸å…³çš„å® ç‰©åŒ»é™¢`, 'success');
        }

        // æœç´¢åŒ»é™¢
        function searchHospital() {
            const searchTerm = document.getElementById('hospitalSearch').value;
            if (!searchTerm) {
                showToast('è¯·è¾“å…¥æœç´¢å…³é”®è¯', 'error');
                return;
            }
            filterHospitals(searchTerm);
        }

        // æ£€æµ‹æ˜¯å¦ä¸ºç§»åŠ¨è®¾å¤‡
        function isMobileDevice() {
            return /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent) || 
                   (window.innerWidth <= 768 && 'ontouchstart' in window);
        }



        // æ‰“å¼€ç§ä¿¡æ¨¡æ€æ¡†
        function openMessageModal() {
            document.getElementById('messageModal').classList.add('active');
            document.getElementById('messageContent').value = '';
        }

        // å…³é—­ç§ä¿¡æ¨¡æ€æ¡†
        function closeMessageModal() {
            document.getElementById('messageModal').classList.remove('active');
        }

        // å‘é€ç§ä¿¡
        function sendMessage() {
            const content = document.getElementById('messageContent').value.trim();
            if (!content) {
                showToast('è¯·è¾“å…¥æ¶ˆæ¯å†…å®¹', 'error');
                return;
            }

            const message = {
                id: Date.now(),
                content: content,
                time: new Date().toLocaleString(),
                from: appData.currentUser ? appData.currentUser : 'æ¸¸å®¢'
            };

            appData.messages.push(message);
            closeMessageModal();
            showToast('æ¶ˆæ¯å·²å‘é€ç»™ç®¡ç†å‘˜ï¼', 'success');
            
            console.log('å‘é€çš„æ¶ˆæ¯:', message);
        }

        // ç™»å½•ç›¸å…³åŠŸèƒ½
        function toggleLogin() {
            console.log('Toggle login clicked - function executed');
            
            // é˜²æ­¢äº‹ä»¶å†’æ³¡
            if (event) {
                event.preventDefault();
                event.stopPropagation();
            }
            
            const modal = document.getElementById('loginModal');
            console.log('Login modal found:', !!modal);
            
            if (modal) {
                // ç§»é™¤ä¹‹å‰çš„ç±»
                modal.classList.remove('active');
                
                // å¼ºåˆ¶æ˜¾ç¤ºæ¨¡æ€æ¡†
                modal.style.display = 'flex';
                modal.style.position = 'fixed';
                modal.style.top = '0';
                modal.style.left = '0';
                modal.style.width = '100%';
                modal.style.height = '100%';
                modal.style.zIndex = '10001';
                modal.style.backgroundColor = 'rgba(0, 0, 0, 0.5)';
                
                // æ·»åŠ activeç±»
                setTimeout(() => {
                    modal.classList.add('active');
                    console.log('Modal active class added');
                }, 50);
                
                // æ¸…ç©ºè¾“å…¥æ¡†
                const usernameInput = document.getElementById('username');
                const passwordInput = document.getElementById('password');
                if (usernameInput) usernameInput.value = '';
                if (passwordInput) passwordInput.value = '';
                
                showToast('ç™»å½•ç•Œé¢å·²æ‰“å¼€', 'info');
                
                // èšç„¦åˆ°ç”¨æˆ·åè¾“å…¥æ¡†
                setTimeout(() => {
                    if (usernameInput) {
                        usernameInput.focus();
                        console.log('Username input focused');
                    }
                }, 300);
            } else {
                console.error('Login modal not found');
                showToast('ç™»å½•ç•Œé¢é”™è¯¯', 'error');
            }
        }

        // å¤‡ç”¨ç™»å½•æ¨¡æ€æ¡†æ˜¾ç¤ºå‡½æ•°
        function showLoginModal() {
            toggleLogin();
        }

        function closeLoginModal() {
            const modal = document.getElementById('loginModal');
            if (modal) {
                modal.classList.remove('active');
                modal.style.display = 'none';
            }
        }

        function handleLogin() {
            const username = document.getElementById('username').value.trim();
            const password = document.getElementById('password').value.trim();

            if (!username || !password) {
                showToast('è¯·è¾“å…¥è´¦å·å’Œå¯†ç ', 'error');
                return;
            }

            // æ£€æŸ¥ç®¡ç†å‘˜è´¦å·
            if (username === ADMIN_CREDENTIALS.username && password === ADMIN_CREDENTIALS.password) {
                appData.currentUser = 'ç®¡ç†å‘˜';
                appData.isLoggedIn = true;
                appData.isAdmin = true;
                
                // å…³é—­ç™»å½•æ¨¡æ€æ¡†
                const loginModal = document.getElementById('loginModal');
                if (loginModal) {
                    loginModal.classList.remove('active');
                    loginModal.style.display = 'none';
                }
                
                // æ¸…ç©ºè¾“å…¥æ¡†
                document.getElementById('username').value = '';
                document.getElementById('password').value = '';
                
                // æ›´æ–°ç•Œé¢çŠ¶æ€ - é¡ºåºå¾ˆé‡è¦
                console.log('å¼€å§‹æ›´æ–°ç®¡ç†å‘˜çŠ¶æ€...');
                updateLoginButton();
                console.log('LoginæŒ‰é’®æ›´æ–°å®Œæˆ');
                
                enableAdminFeatures();
                console.log('ç®¡ç†å‘˜åŠŸèƒ½å¯ç”¨å®Œæˆ');
                
                updateProfileMenu();
                console.log('ä¸ªäººä¸­å¿ƒèœå•æ›´æ–°å®Œæˆ');
                
                showToast('ç®¡ç†å‘˜ç™»å½•æˆåŠŸï¼', 'success');
                console.log('ç®¡ç†å‘˜ç™»å½•æˆåŠŸï¼Œæ‰€æœ‰åŠŸèƒ½å·²å¯ç”¨', appData);
                
                // å»¶è¿Ÿé‡æ–°æ¸²æŸ“é¡µé¢ï¼Œç¡®ä¿çŠ¶æ€æ›´æ–°
                setTimeout(() => {
                    renderCats();
                    renderPosts();
                    console.log('é¡µé¢é‡æ–°æ¸²æŸ“å®Œæˆ');
                }, 100);
            } else {
                showToast('è´¦å·æˆ–å¯†ç é”™è¯¯ï¼Œåªæœ‰ç®¡ç†å‘˜å¯ä»¥ç™»å½•', 'error');
                // æ¸…ç©ºå¯†ç è¾“å…¥æ¡†
                document.getElementById('password').value = '';
            }
        }

        function logout() {
            appData.currentUser = null;
            appData.isLoggedIn = false;
            appData.isAdmin = false;
            
            updateLoginButton();
            disableAdminFeatures();
            showToast('å·²é€€å‡ºç™»å½•', 'info');
        }

        function updateLoginButton() {
            const loginBtn = document.getElementById('loginBtn');
            if (appData.isLoggedIn) {
                if (appData.isAdmin) {
                    loginBtn.textContent = 'ç®¡ç†å‘˜';
                    loginBtn.className = 'btn btn-primary';
                    loginBtn.onclick = showAdminPanel;
                } else {
                    loginBtn.textContent = 'ç”¨æˆ·';
                    loginBtn.className = 'btn btn-secondary';
                    loginBtn.onclick = logout;
                }
            } else {
                loginBtn.textContent = 'ç®¡ç†å‘˜ç™»å½•';
                loginBtn.className = 'btn btn-secondary';
                loginBtn.onclick = toggleLogin;
            }
            
            // æ›´æ–°ä¸ªäººä¸­å¿ƒèœå•
            updateProfileMenu();
            
            // æ›´æ–°çŒ«å’ªç®¡ç†é¡µé¢æƒé™
            updateCatManagementButtons();
        }

        function updateCatManagementButtons() {
            const managementButtons = document.getElementById('catManagementButtons');
            const userHint = document.getElementById('catUserHint');
            
            if (managementButtons && userHint) {
                if (appData.isAdmin) {
                    managementButtons.style.display = 'block';
                    userHint.style.display = 'none';
                } else {
                    managementButtons.style.display = 'none';
                    userHint.style.display = 'block';
                }
            }
        }

        function enableAdminFeatures() {
            // ç®¡ç†å‘˜å¯ä»¥ä¿®æ”¹çš„å…ƒç´ æ·»åŠ ç¼–è¾‘åŠŸèƒ½
            console.log('ç®¡ç†å‘˜åŠŸèƒ½å·²å¯ç”¨');
            console.log('å½“å‰çŠ¶æ€:', appData);
            
            // å¼ºåˆ¶è®¾ç½®ç®¡ç†å‘˜çŠ¶æ€
            appData.isAdmin = true;
            appData.isLoggedIn = true;
            appData.currentUser = 'ç®¡ç†å‘˜';
            
            // å¯ç”¨çŒ«å’ªç®¡ç†é¡µé¢
            const catManagementButtons = document.getElementById('catManagementButtons');
            const catUserHint = document.getElementById('catUserHint');
            if (catManagementButtons) {
                catManagementButtons.style.display = 'block';
                console.log('çŒ«å’ªç®¡ç†æŒ‰é’®å·²æ˜¾ç¤º');
            }
            if (catUserHint) {
                catUserHint.style.display = 'none';
                console.log('æ™®é€šç”¨æˆ·æç¤ºå·²éšè—');
            }
            
            // å¯ç”¨å•†åŸç®¡ç†åŠŸèƒ½
            const shopManageBtn = document.getElementById('shopManageBtn');
            if (shopManageBtn) {
                shopManageBtn.style.display = 'block';
                console.log('å•†åŸç®¡ç†æŒ‰é’®å·²æ˜¾ç¤º');
            }
            
            // å¯ç”¨åŒ»é™¢ç®¡ç†åŠŸèƒ½
            const hospitalManageBtn = document.getElementById('hospitalManageBtn');
            if (hospitalManageBtn) {
                hospitalManageBtn.style.display = 'block';
                console.log('åŒ»é™¢ç®¡ç†æŒ‰é’®å·²æ˜¾ç¤º');
            }
            
            // å¯ç”¨åŒ»é™¢æ’è¡Œæ¦œç¼–è¾‘åŠŸèƒ½
            const editRankingBtn = document.getElementById('editRankingBtn');
            if (editRankingBtn) {
                editRankingBtn.style.display = 'block';
                console.log('åŒ»é™¢æ’è¡Œæ¦œç¼–è¾‘æŒ‰é’®å·²æ˜¾ç¤º');
            }
            
            // å¯ç”¨è®ºå›ç®¡ç†åŠŸèƒ½
            enableForumAdminFeatures();
            
            // é‡æ–°æ¸²æŸ“ç›¸å…³é¡µé¢
            renderCats();
            renderPosts();
            renderProducts();
            updateProfileMenu();
            
            showToast('ç®¡ç†å‘˜åŠŸèƒ½å·²å…¨éƒ¨å¯ç”¨', 'success');
            console.log('æ‰€æœ‰ç®¡ç†å‘˜åŠŸèƒ½å¯ç”¨å®Œæˆ');
        }

        // è®ºå›ç®¡ç†åŠŸèƒ½
        function enableForumAdminFeatures() {
            const forumManageBtn = document.getElementById('forumManageBtn');
            if (forumManageBtn) {
                forumManageBtn.style.display = 'block';
                console.log('è®ºå›ç®¡ç†æŒ‰é’®å·²æ˜¾ç¤º');
            }
        }

        function disableForumAdminFeatures() {
            const forumManageBtn = document.getElementById('forumManageBtn');
            if (forumManageBtn) forumManageBtn.style.display = 'none';
        }

        function manageForum() {
            showToast('è®ºå›ç®¡ç†åŠŸèƒ½ï¼šå¯ä»¥åˆ é™¤/ç½®é¡¶å¸–å­', 'info');
            // è¿™é‡Œå¯ä»¥æ·»åŠ æ›´è¯¦ç»†çš„è®ºå›ç®¡ç†åŠŸèƒ½
        }

        // åˆ é™¤å¸–å­
        function deletePost(postId) {
            if (confirm('ç¡®å®šè¦åˆ é™¤è¿™ç¯‡å¸–å­å—ï¼Ÿ')) {
                const index = appData.posts.findIndex(p => p.id === postId);
                if (index !== -1) {
                    appData.posts.splice(index, 1);
                    renderPosts();
                    showToast('å¸–å­å·²åˆ é™¤', 'success');
                }
            }
        }

        // ç½®é¡¶å¸–å­
        function pinPost(postId) {
            const post = appData.posts.find(p => p.id === postId);
            if (post) {
                // å°†å¸–å­ç§»åˆ°é¡¶éƒ¨
                appData.posts = appData.posts.filter(p => p.id !== postId);
                appData.posts.unshift(post);
                post.pinned = true;
                post.pinTime = new Date().toLocaleString();
                renderPosts();
                showToast('å¸–å­å·²ç½®é¡¶', 'success');
            }
        }

        function disableAdminFeatures() {
            // ç¦ç”¨ç®¡ç†å‘˜åŠŸèƒ½
            console.log('ç®¡ç†å‘˜åŠŸèƒ½å·²ç¦ç”¨');
            
            // ç¦ç”¨çŒ«å’ªç®¡ç†é¡µé¢
            const catManagementButtons = document.getElementById('catManagementButtons');
            const catUserHint = document.getElementById('catUserHint');
            if (catManagementButtons) catManagementButtons.style.display = 'none';
            if (catUserHint) catUserHint.style.display = 'block';
            
            // ç¦ç”¨å•†åŸç®¡ç†åŠŸèƒ½
            const shopManageBtn = document.getElementById('shopManageBtn');
            if (shopManageBtn) shopManageBtn.style.display = 'none';
            
            // ç¦ç”¨åŒ»é™¢ç®¡ç†åŠŸèƒ½
            const hospitalManageBtn = document.getElementById('hospitalManageBtn');
            if (hospitalManageBtn) hospitalManageBtn.style.display = 'none';
            
            // ç¦ç”¨è®ºå›ç®¡ç†åŠŸèƒ½
            disableForumAdminFeatures();
            
            // é‡æ–°æ¸²æŸ“ç›¸å…³é¡µé¢
            renderCats();
            renderPosts();
            updateProfileMenu();
        }

        function showAdminPanel() {
            // æ˜¾ç¤ºç®¡ç†å‘˜é¢æ¿
            showToast('ç®¡ç†å‘˜é¢æ¿å¼€å‘ä¸­...', 'info');
        }

        // ç‰©æµç›¸å…³åŠŸèƒ½
        function focusTrackingInput() {
            document.getElementById('trackingNumber').focus();
        }

        // æ˜¾ç¤ºæŸ¥è¯¢å†å²
        function showTrackingHistory() {
            const history = JSON.parse(localStorage.getItem('trackingHistory') || '[]');
            const trackingResult = document.getElementById('trackingResult');
            
            if (history.length === 0) {
                trackingResult.innerHTML = `
                    <div class="card">
                        <div style="padding: var(--spacing-md); text-align: center;">
                            <p style="color: var(--apple-gray-medium);">æš‚æ— æŸ¥è¯¢å†å²</p>
                        </div>
                    </div>
                `;
            } else {
                trackingResult.innerHTML = `
                    <div class="card">
                        <div style="padding: var(--spacing-md);">
                            <h4>ğŸ“‹ æŸ¥è¯¢å†å²</h4>
                            <div style="margin-top: var(--spacing-md);">
                                ${history.map((item, index) => `
                                    <div style="padding: var(--spacing-sm); border-bottom: 1px solid var(--apple-border); display: flex; justify-content: space-between; align-items: center;">
                                        <div>
                                            <strong>${item.number}</strong>
                                            <span style="color: var(--apple-gray-medium); font-size: 12px; margin-left: var(--spacing-sm);">${item.time}</span>
                                        </div>
                                        <button class="btn btn-small btn-secondary" onclick="retrackPackage('${item.number}')">é‡æ–°æŸ¥è¯¢</button>
                                    </div>
                                `).join('')}
                            </div>
                            ${history.length > 0 ? `<button class="btn btn-secondary" onclick="clearTrackingHistory()" style="margin-top: var(--spacing-md);">æ¸…ç©ºå†å²</button>` : ''}
                        </div>
                    </div>
                `;
            }
        }

        // ç‰©æµæŸ¥è¯¢
        function trackPackage() {
            const trackingNumber = document.getElementById('trackingNumber').value.trim();
            if (!trackingNumber) {
                showToast('è¯·è¾“å…¥è¿å•å·', 'error');
                return;
            }

            // ä¿å­˜æŸ¥è¯¢å†å²
            saveTrackingHistory(trackingNumber);

            // æ¨¡æ‹Ÿç‰©æµæŸ¥è¯¢ç»“æœ
            const trackingResult = document.getElementById('trackingResult');
            const mockData = generateMockTrackingInfo(trackingNumber);
            
            trackingResult.innerHTML = `
                <div class="card">
                    <div style="padding: var(--spacing-md);">
                        <h4>ğŸ“¦ è¿å•æŸ¥è¯¢ç»“æœ</h4>
                        <p><strong>è¿å•å·ï¼š</strong>${trackingNumber}</p>
                        <p><strong>çŠ¶æ€ï¼š</strong><span style="color: ${mockData.statusColor};">${mockData.status}</span></p>
                        <p><strong>æœ€æ–°æ›´æ–°ï¼š</strong>${mockData.lastUpdate}</p>
                        
                        <div style="margin-top: var(--spacing-md);">
                            <h5 style="margin-bottom: var(--spacing-sm);">ç‰©æµè½¨è¿¹</h5>
                            ${mockData.timeline.map(item => `
                                <div style="padding: var(--spacing-sm); border-left: 2px solid var(--apple-blue); margin-left: 8px; position: relative;">
                                    <div style="position: absolute; left: -10px; top: var(--spacing-sm); width: 8px; height: 8px; background: var(--apple-blue); border-radius: 50%;"></div>
                                    <div style="font-size: 14px; color: var(--apple-gray-dark);">${item.time}</div>
                                    <div style="margin-top: 4px;">${item.location}</div>
                                </div>
                            `).join('')}
                        </div>
                        
                        <div style="margin-top: var(--spacing-md);">
                            <button class="btn btn-secondary" onclick="document.getElementById('trackingNumber').focus()">é‡æ–°æŸ¥è¯¢</button>
                        </div>
                    </div>
                </div>
            `;
            
            showToast('æŸ¥è¯¢æˆåŠŸï¼', 'success');
        }

        // ç”Ÿæˆæ¨¡æ‹Ÿç‰©æµä¿¡æ¯
        function generateMockTrackingInfo(trackingNumber) {
            const hash = trackingNumber.length % 3;
            const statusMap = [
                { status: 'å·²ç­¾æ”¶', color: 'var(--apple-green)' },
                { status: 'æ´¾é€ä¸­', color: 'var(--apple-blue)' },
                { status: 'è¿è¾“ä¸­', color: 'var(--apple-orange)' }
            ];
            
            const currentStatus = statusMap[hash];
            
            return {
                status: currentStatus.status,
                statusColor: currentStatus.color,
                lastUpdate: new Date().toLocaleString(),
                timeline: [
                    { time: '2024-01-20 10:30', location: 'ã€æ­å·å¸‚ã€‘å·²æ½æ”¶' },
                    { time: '2024-01-20 14:15', location: 'ã€æ­å·å¸‚ã€‘å·²å‘å‡º' },
                    { time: '2024-01-20 18:45', location: 'ã€ä¸Šæµ·å¸‚ã€‘åˆ°è¾¾åˆ†æ‹£ä¸­å¿ƒ' },
                    { time: '2024-01-21 06:20', location: 'ã€åŒ—äº¬å¸‚ã€‘åˆ°è¾¾åˆ†æ‹£ä¸­å¿ƒ' },
                    { time: '2024-01-21 09:15', location: currentStatus.status === 'å·²ç­¾æ”¶' ? 'ã€åŒ—äº¬å¸‚ã€‘å·²ç­¾æ”¶ï¼Œç­¾æ”¶äººï¼šæœ¬äºº' : 'ã€åŒ—äº¬å¸‚ã€‘æ­£åœ¨æ´¾é€' }
                ]
            };
        }

        // ä¿å­˜æŸ¥è¯¢å†å²
        function saveTrackingHistory(trackingNumber) {
            let history = JSON.parse(localStorage.getItem('trackingHistory') || '[]');
            
            // æ£€æŸ¥æ˜¯å¦å·²å­˜åœ¨
            history = history.filter(item => item.number !== trackingNumber);
            
            // æ·»åŠ åˆ°å¼€å¤´
            history.unshift({
                number: trackingNumber,
                time: new Date().toLocaleString()
            });
            
            // åªä¿ç•™æœ€è¿‘10æ¡
            history = history.slice(0, 10);
            
            localStorage.setItem('trackingHistory', JSON.stringify(history));
        }

        // é‡æ–°æŸ¥è¯¢
        function retrackPackage(trackingNumber) {
            document.getElementById('trackingNumber').value = trackingNumber;
            trackPackage();
        }

        // æ¸…ç©ºå†å²
        function clearTrackingHistory() {
            if (confirm('ç¡®å®šè¦æ¸…ç©ºæŸ¥è¯¢å†å²å—ï¼Ÿ')) {
                localStorage.removeItem('trackingHistory');
                showTrackingHistory();
                showToast('å†å²å·²æ¸…ç©º', 'success');
            }
        }

        // ç§»åŠ¨ç«¯èœå•ç›¸å…³
        function toggleMobileMenu() {
            const navMenu = document.getElementById('navMenu');
            const overlay = document.getElementById('mobileNavOverlay');
            
            navMenu.classList.toggle('active');
            overlay.classList.toggle('active');
        }

        function closeMobileMenu() {
            const navMenu = document.getElementById('navMenu');
            const overlay = document.getElementById('mobileNavOverlay');
            
            navMenu.classList.remove('active');
            overlay.classList.remove('active');
        }

        function showPageAndCloseMenu(pageId, element) {
            showPage(pageId, element);
            closeMobileMenu();
        }

        // çŒ«å’ªç®¡ç†ç›¸å…³
        function addCat() {
            if (!appData.isAdmin) {
                showToast('åªæœ‰ç®¡ç†å‘˜æ‰èƒ½æ·»åŠ çŒ«å’ª', 'error');
                return;
            }
            document.getElementById('addCatModal').classList.add('active');
            // æ¸…ç©ºè¡¨å•
            document.getElementById('catName').value = '';
            document.getElementById('catBreed').value = '';
            document.getElementById('catAge').value = '';
            document.getElementById('catGender').value = 'å…¬';
            document.getElementById('catPhoto').value = '';
            document.getElementById('catDescription').value = '';
        }

        function closeAddCatModal() {
            document.getElementById('addCatModal').classList.remove('active');
            // æ¸…ç©ºè¡¨å•
            document.getElementById('catName').value = '';
            document.getElementById('catBreed').value = '';
            document.getElementById('catAge').value = '';
            document.getElementById('catGender').value = 'å…¬';
            document.getElementById('catPhoto').value = '';
            document.getElementById('catDescription').value = '';
            document.getElementById('catPhotoPreview').innerHTML = `
                <div style="text-align: center;">
                    <div style="font-size: 48px; margin-bottom: var(--spacing-sm);">ğŸ±</div>
                    <p>ç…§ç‰‡é¢„è§ˆåŒºåŸŸ</p>
                </div>
            `;
            // é‡ç½®ç¼–è¾‘çŠ¶æ€
            delete appData.editingCatId;
        }

        // å¤„ç†çŒ«å’ªç…§ç‰‡ä¸Šä¼ 
        function handleCatPhotoUpload(event) {
            const file = event.target.files[0];
            if (file && file.type.startsWith('image/')) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const photoUrl = e.target.result;
                    document.getElementById('catPhoto').value = photoUrl;
                    document.getElementById('catPhotoPreview').innerHTML = `
                        <img src="${photoUrl}" style="width: 100%; height: 100%; object-fit: cover; border-radius: var(--border-radius-sm);">
                    `;
                    showToast('å›¾ç‰‡ä¸Šä¼ æˆåŠŸ', 'success');
                };
                reader.readAsDataURL(file);
            } else {
                showToast('è¯·é€‰æ‹©æœ‰æ•ˆçš„å›¾ç‰‡æ–‡ä»¶', 'error');
            }
        }

        // ç¼–è¾‘çŒ«å’ª
        function editCat(catId) {
            const cat = appData.cats.find(c => c.id === catId);
            if (cat) {
                appData.editingCatId = catId;
                // å¡«å……è¡¨å•
                document.getElementById('catName').value = cat.name;
                document.getElementById('catBreed').value = cat.breed;
                document.getElementById('catAge').value = cat.age;
                document.getElementById('catGender').value = cat.gender;
                document.getElementById('catPhoto').value = cat.photo;
                document.getElementById('catDescription').value = cat.description || '';
                
                // æ˜¾ç¤ºå›¾ç‰‡é¢„è§ˆ
                document.getElementById('catPhotoPreview').innerHTML = `
                    <img src="${cat.photo}" style="width: 100%; height: 100%; object-fit: cover; border-radius: var(--border-radius-sm);">
                `;
                
                // ä¿®æ”¹æ¨¡æ€æ¡†æ ‡é¢˜å’ŒæŒ‰é’®
                document.querySelector('#addCatModal .modal-header h3').textContent = 'ç¼–è¾‘çŒ«å’ª';
                document.querySelector('#addCatModal .modal-footer .btn-primary').textContent = 'ä¿å­˜';
                
                document.getElementById('addCatModal').classList.add('active');
            }
        }

        function submitCat() {
            const name = document.getElementById('catName').value.trim();
            const breed = document.getElementById('catBreed').value;
            const age = document.getElementById('catAge').value;
            const gender = document.getElementById('catGender').value;
            const photo = document.getElementById('catPhoto').value.trim();
            const description = document.getElementById('catDescription').value.trim();

            if (!name || !breed || !age) {
                showToast('è¯·å¡«å†™å¿…è¦ä¿¡æ¯', 'error');
                return;
            }

            if (appData.editingCatId) {
                // ç¼–è¾‘æ¨¡å¼
                const cat = appData.cats.find(c => c.id === appData.editingCatId);
                if (cat) {
                    cat.name = name;
                    cat.breed = breed;
                    cat.age = parseInt(age);
                    cat.gender = gender;
                    cat.photo = photo || 'https://picsum.photos/300/200?random=' + Date.now();
                    cat.description = description || `è¿™æ˜¯ä¸€åªå¯çˆ±çš„${breed}`;
                    cat.updatedTime = new Date().toLocaleString();
                    
                    renderCats();
                    closeAddCatModal();
                    showToast('çŒ«å’ªä¿¡æ¯æ›´æ–°æˆåŠŸï¼', 'success');
                }
            } else {
                // æ·»åŠ æ¨¡å¼
                const cat = {
                    id: Date.now(),
                    name: name,
                    breed: breed,
                    age: parseInt(age),
                    gender: gender,
                    photo: photo || 'https://picsum.photos/300/200?random=' + Date.now(),
                    description: description || `è¿™æ˜¯ä¸€åªå¯çˆ±çš„${breed}`,
                    addedBy: appData.currentUser,
                    addedTime: new Date().toLocaleString(),
                    likes: 0,
                    comments: [],
                    liked: false
                };

                appData.cats.unshift(cat);
                renderCats();
                closeAddCatModal();
                showToast('çŒ«å’ªæ·»åŠ æˆåŠŸï¼', 'success');
            }
        }

        function renderCats() {
            const catList = document.getElementById('catList');
            
            if (appData.cats.length === 0) {
                // æ˜¾ç¤ºæç¤ºä¿¡æ¯
                catList.innerHTML = `
                    <div style="text-align: center; padding: 40px; color: var(--apple-gray-medium);">
                        <div style="font-size: 48px; margin-bottom: var(--spacing-sm);">ğŸ±</div>
                        <p>æš‚æ— çŒ«å’ªä¿¡æ¯</p>
                        ${appData.isAdmin ? '<button class="btn btn-primary" onclick="addCat()">æ·»åŠ ç¬¬ä¸€åªçŒ«å’ª</button>' : ''}
                    </div>
                `;
                return;
            }

            catList.innerHTML = appData.cats.map(cat => `
                <div class="card">
                    <div style="padding: var(--spacing-md);">
                        <img src="${cat.photo}" style="width: 100%; height: 200px; object-fit: cover; border-radius: var(--border-radius-sm); margin-bottom: var(--spacing-sm);" onerror="this.src='https://picsum.photos/300/200?fallback'">
                        <h3>${cat.name}</h3>
                        <p>å“ç§ï¼š${cat.breed}</p>
                        <p>å¹´é¾„ï¼š${cat.age}å²</p>
                        <p>æ€§åˆ«ï¼š${cat.gender}</p>
                        ${cat.description ? `<p style="color: var(--apple-gray-dark); margin-top: var(--spacing-sm);">${cat.description}</p>` : ''}
                        <p style="color: var(--apple-gray-medium); font-size: 12px;">æ·»åŠ æ—¶é—´ï¼š${cat.addedTime}</p>
                        <div style="margin-top: var(--spacing-sm);">
                            <button class="post-action-btn ${cat.liked ? 'liked' : ''}" onclick="likeCat(${cat.id}, this)">
                                <span>${cat.liked ? 'â¤ï¸' : 'ğŸ¤'}</span>
                                <span>${cat.likes}</span>
                            </button>
                            <button class="post-action-btn" onclick="commentCat(${cat.id})">
                                <span>ğŸ’¬</span>
                                <span>${cat.comments.length}</span>
                            </button>
                            ${appData.isAdmin ? `
                                <button class="btn btn-secondary btn-small" onclick="editCat(${cat.id})">ç¼–è¾‘</button>
                                <button class="btn btn-secondary btn-small" onclick="deleteCat(${cat.id})">åˆ é™¤</button>
                            ` : ''}
                        </div>
                        ${cat.comments.length > 0 || !appData.isAdmin ? `
                            <div class="comments-section" id="cat-comments-${cat.id}" style="margin-top: var(--spacing-sm);">
                                ${cat.comments.map((comment, index) => `
                                    <div class="comment-item">
                                        <div style="display: flex; justify-content: space-between; align-items: flex-start;">
                                            <div style="flex: 1;">
                                                <div class="comment-author">${comment.author}</div>
                                                <div class="comment-content">${comment.content}</div>
                                                <div class="comment-time">${comment.time}</div>
                                            </div>
                                            ${appData.isAdmin ? `
                                                <button class="btn btn-secondary btn-small" onclick="deleteCatComment(${cat.id}, ${index})" style="margin-left: 8px; padding: 4px 8px; font-size: 12px;">åˆ é™¤</button>
                                            ` : ''}
                                        </div>
                                    </div>
                                `).join('')}
                                <div class="comment-item">
                                    <div class="form-group" style="margin: 0; display: flex; gap: 8px;">
                                        <input type="text" class="input" id="cat-comment-input-${cat.id}" placeholder="å†™ä¸‹ä½ çš„è¯„è®º..." onkeypress="if(event.key==='Enter') addCatComment(${cat.id}, this.value, this)">
                                        <button class="btn btn-primary btn-small" onclick="addCatComment(${cat.id}, document.getElementById('cat-comment-input-${cat.id}').value, document.getElementById('cat-comment-input-${cat.id}'))">å‘é€</button>
                                    </div>
                                </div>
                            </div>
                        ` : ''}
                    </div>
                </div>
            `).join('');
        }

        function likeCat(catId, button) {
            const cat = appData.cats.find(c => c.id === catId);
            if (cat) {
                cat.liked = !cat.liked;
                cat.likes += cat.liked ? 1 : -1;
                
                const btn = button.querySelector('span:first-child');
                const count = button.querySelector('span:last-child');
                
                btn.textContent = cat.liked ? 'â¤ï¸' : 'ğŸ¤';
                button.classList.toggle('liked', cat.liked);
                count.textContent = cat.likes;
                
                showToast(cat.liked ? 'å·²ç‚¹èµ' : 'å·²å–æ¶ˆç‚¹èµ', 'success');
            }
        }

        function commentCat(catId) {
            // æ»šåŠ¨åˆ°è¯„è®ºåŒº
            const commentsSection = document.getElementById(`cat-comments-${catId}`);
            if (commentsSection) {
                commentsSection.classList.add('expanded');
                commentsSection.scrollIntoView({ behavior: 'smooth' });
                // èšç„¦åˆ°è¯„è®ºè¾“å…¥æ¡†
                commentsSection.querySelector('input').focus();
            }
        }

        function addCatComment(catId, content, input) {
            if (!content.trim()) {
                showToast('è¯·è¾“å…¥è¯„è®ºå†…å®¹', 'error');
                return;
            }
            
            const cat = appData.cats.find(c => c.id === catId);
            if (cat) {
                const comment = {
                    author: appData.currentUser ? appData.currentUser : 'æ¸¸å®¢',
                    content: content.trim(),
                    time: 'åˆšåˆš'
                };
                cat.comments.push(comment);
                renderCats();
                showToast('è¯„è®ºæˆåŠŸ', 'success');
                
                // æ¸…ç©ºè¾“å…¥æ¡†
                if (input) {
                    input.value = '';
                }
            }
        }

        function deleteCatComment(catId, commentIndex) {
            if (!appData.isAdmin) {
                showToast('åªæœ‰ç®¡ç†å‘˜æ‰èƒ½åˆ é™¤è¯„è®º', 'error');
                return;
            }
            
            if (confirm('ç¡®å®šè¦åˆ é™¤è¿™æ¡è¯„è®ºå—ï¼Ÿ')) {
                const cat = appData.cats.find(c => c.id === catId);
                if (cat && cat.comments[commentIndex]) {
                    cat.comments.splice(commentIndex, 1);
                    renderCats();
                    showToast('è¯„è®ºåˆ é™¤æˆåŠŸ', 'success');
                }
            }
        }

        function editCat(catId) {
            if (!appData.isAdmin) {
                showToast('åªæœ‰ç®¡ç†å‘˜æ‰èƒ½ç¼–è¾‘çŒ«å’ª', 'error');
                return;
            }
            
            const cat = appData.cats.find(c => c.id === catId);
            if (!cat) {
                showToast('çŒ«å’ªä¿¡æ¯ä¸å­˜åœ¨', 'error');
                return;
            }
            
            // è®¾ç½®ç¼–è¾‘æ¨¡å¼
            appData.editingCatId = catId;
            
            // å¡«å……è¡¨å•
            document.getElementById('catName').value = cat.name;
            document.getElementById('catBreed').value = cat.breed;
            document.getElementById('catAge').value = cat.age;
            document.getElementById('catGender').value = cat.gender;
            document.getElementById('catPhoto').value = cat.photo;
            document.getElementById('catDescription').value = cat.description || '';
            
            // ä¿®æ”¹æ¨¡æ€æ¡†æ ‡é¢˜å’ŒæŒ‰é’®
            document.querySelector('#addCatModal .modal-header h3').textContent = 'ç¼–è¾‘çŒ«å’ª';
            document.querySelector('#addCatModal .modal-footer .btn-primary').textContent = 'ä¿å­˜';
            
            document.getElementById('addCatModal').classList.add('active');
        }

        function deleteCat(catId) {
            if (confirm('ç¡®å®šè¦åˆ é™¤è¿™åªçŒ«å’ªå—ï¼Ÿ')) {
                const index = appData.cats.findIndex(c => c.id === catId);
                if (index > -1) {
                    appData.cats.splice(index, 1);
                    renderCats();
                    showToast('åˆ é™¤æˆåŠŸ', 'success');
                }
            }
        }

        // å¤„ç†å›¾ç‰‡ä¸Šä¼ 
        function handlePostImageUpload(event) {
            const files = event.target.files;
            const preview = document.getElementById('postImagePreview');
            
            for (let file of files) {
                if (file.type.startsWith('image/')) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        const imageContainer = document.createElement('div');
                        imageContainer.style.cssText = 'position: relative; padding: 10px; border: 1px solid var(--apple-border); border-radius: var(--border-radius-sm); background: var(--apple-gray-light);';
                        
                        const img = document.createElement('img');
                        img.src = e.target.result;
                        img.style.cssText = 'width: 100%; height: 100px; object-fit: cover; border-radius: var(--border-radius-sm);';
                        
                        const removeBtn = document.createElement('button');
                        removeBtn.innerHTML = 'Ã—';
                        removeBtn.style.cssText = 'position: absolute; top: 5px; right: 5px; background: var(--apple-red); color: white; border: none; border-radius: 50%; width: 20px; height: 20px; cursor: pointer; font-size: 12px;';
                        removeBtn.onclick = function() {
                            imageContainer.remove();
                        };
                        
                        imageContainer.appendChild(img);
                        imageContainer.appendChild(removeBtn);
                        preview.appendChild(imageContainer);
                    };
                    reader.readAsDataURL(file);
                }
            }
        }

        // å‘è¡¨å¸–å­
        function createPost() {
            document.getElementById('createPostModal').classList.add('active');
            // æ¸…ç©ºè¡¨å•
            document.getElementById('postTitle').value = '';
            document.getElementById('postContent').value = '';
            document.getElementById('postImagePreview').innerHTML = '';
            document.getElementById('postImageUpload').value = '';
        }

        // å…³é—­å‘å¸–æ¨¡æ€æ¡†
        function closeCreatePostModal() {
            document.getElementById('createPostModal').classList.remove('active');
        }

        // æäº¤å¸–å­
        function submitPost() {
            const title = document.getElementById('postTitle').value.trim();
            const content = document.getElementById('postContent').value.trim();
            
            // è·å–ä¸Šä¼ çš„å›¾ç‰‡
            const preview = document.getElementById('postImagePreview');
            const imageElements = preview.querySelectorAll('img');
            const uploadedImages = Array.from(imageElements).map(img => img.src);

            if (!title || !content) {
                showToast('è¯·å¡«å†™æ ‡é¢˜å’Œå†…å®¹', 'error');
                return;
            }

            // ä½¿ç”¨ç”¨æˆ·èµ„æ–™ä¿¡æ¯
            let userName = 'ç”¨æˆ·' + Math.floor(Math.random() * 1000);
            let userAvatar = 'ğŸ‘¤';
            
            if (appData.userProfile) {
                userName = appData.userProfile.userName;
                userAvatar = appData.userProfile.avatar;
            } else if (appData.currentUser) {
                userName = appData.currentUser;
                userAvatar = 'ğŸ‘¤';
            }

            const post = {
                id: Date.now(),
                title: title,
                content: content,
                author: userName,
                avatar: userAvatar,
                time: 'åˆšåˆš',
                images: uploadedImages,
                likes: 0,
                comments: [],
                liked: false
            };

            appData.posts.unshift(post);
            renderPosts();
            closeCreatePostModal();
            showToast('å‘è¡¨æˆåŠŸï¼', 'success');
        }

        // åˆå§‹åŒ–é»˜è®¤çŒ«å’ªæ•°æ®
        function initDefaultCats() {
            if (appData.cats.length === 0) {
                appData.cats = [
                    {
                        id: 1,
                        name: 'å’ªå’ª',
                        breed: 'è‹±çŸ­',
                        age: 2,
                        gender: 'æ¯',
                        photo: 'https://picsum.photos/300/200?cat1',
                        description: 'ä¸€åªå¯çˆ±çš„å°çŒ«å’ªï¼Œæ€§æ ¼æ¸©é¡ºï¼Œå–œæ¬¢ç©è€',
                        addedBy: 'ç®¡ç†å‘˜',
                        addedTime: '2024-01-15 10:30:00',
                        likes: 15,
                        comments: [
                            {
                                author: 'ç”¨æˆ·1',
                                content: 'å¥½å¯çˆ±çš„çŒ«å’ªï¼',
                                time: '2å°æ—¶å‰'
                            },
                            {
                                author: 'æ¸¸å®¢',
                                content: 'æ¯›è‰²çœŸæ¼‚äº®',
                                time: '1å¤©å‰'
                            }
                        ],
                        liked: false
                    },
                    {
                        id: 2,
                        name: 'å°ç™½',
                        breed: 'å¸ƒå¶çŒ«',
                        age: 3,
                        gender: 'å…¬',
                        photo: 'https://picsum.photos/300/200?cat2',
                        description: 'æ¼‚äº®çš„å¸ƒå¶çŒ«ï¼Œçœ¼ç›åƒè“å®çŸ³ä¸€æ ·',
                        addedBy: 'ç®¡ç†å‘˜',
                        addedTime: '2024-01-14 15:20:00',
                        likes: 23,
                        comments: [
                            {
                                author: 'çŒ«å¥´',
                                content: 'å¸ƒå¶çŒ«å¤ªç¾äº†ï¼',
                                time: '3å°æ—¶å‰'
                            }
                        ],
                        liked: false
                    }
                ];
            }
        }

        // åˆå§‹åŒ–é»˜è®¤å•†å“æ•°æ®
        function initDefaultProducts() {
            if (!appData.products || appData.products.length === 0) {
                appData.products = [
                    {
                        id: 1,
                        name: 'ä¼˜è´¨çŒ«ç²®',
                        category: 'food',
                        price: '89',
                        platform: 'taobao',
                        url: 'https://taobao.com/item1',
                        icon: 'ğŸ¥«',
                        description: 'è¥å…»å‡è¡¡çš„ä¼˜è´¨çŒ«ç²®ï¼Œé€‚åˆå„å¹´é¾„æ®µçŒ«å’ª',
                        addedBy: 'ç®¡ç†å‘˜',
                        addedTime: '2024-01-15 10:30:00',
                        clickCount: 25
                    },
                    {
                        id: 2,
                        name: 'é€—çŒ«æ£’å¥—è£…',
                        category: 'toys',
                        price: '29',
                        platform: 'pinduoduo',
                        url: 'https://pinduoduo.com/item2',
                        icon: 'ğŸ§¶',
                        description: 'å¤šç§æ¬¾å¼çš„é€—çŒ«æ£’ï¼Œè®©çŒ«å’ªçˆ±ä¸é‡Šæ‰‹',
                        addedBy: 'ç®¡ç†å‘˜',
                        addedTime: '2024-01-14 15:20:00',
                        clickCount: 18
                    }
                ];
            }
        }

        // åˆå§‹åŒ–é»˜è®¤å¸–å­æ•°æ®
        function initDefaultPosts() {
            if (!appData.posts || appData.posts.length === 0) {
                appData.posts = [
                    {
                        id: 1,
                        title: 'æ¬¢è¿æ¥åˆ°é‡‘çŒ«è®ºå›ï¼',
                        content: 'æ¬¢è¿å¤§å®¶åœ¨è¿™é‡Œåˆ†äº«å…»çŒ«ç»éªŒï¼Œäº¤æµå…»çŒ«å¿ƒå¾—ã€‚æ— è®ºæ˜¯çŒ«å’ªçš„æ—¥å¸¸æŠ¤ç†ã€å¥åº·é—®é¢˜ï¼Œè¿˜æ˜¯æœ‰è¶£çš„çŒ«å’ªæ•…äº‹ï¼Œéƒ½å¯ä»¥åœ¨è¿™é‡Œå’Œå¤§å®¶åˆ†äº«ã€‚\\n\\nè®©æˆ‘ä»¬ä¸€èµ·æ¥åˆ›é€ ä¸€ä¸ªæ¸©æš–çš„çŒ«å’ªç¤¾åŒºå§ï¼ ğŸ±ğŸ’•',
                        author: 'ç®¡ç†å‘˜',
                        avatar: 'ğŸ‘¤',
                        time: '2å°æ—¶å‰',
                        images: [],
                        likes: 128,
                        comments: [
                            {
                                author: 'ç”¨æˆ·1',
                                content: 'è¿™ä¸ªç¤¾åŒºçœŸæ£’ï¼',
                                time: '1å°æ—¶å‰'
                            }
                        ],
                        liked: false
                    }
                ];
            }
        }

        // åˆå§‹åŒ–é»˜è®¤åŒ»é™¢æ•°æ®
        function initDefaultHospitals() {
            if (!appData.hospitals || appData.hospitals.length === 0) {
                appData.hospitals = [
                    {
                        id: 1,
                        name: 'æ­å·çˆ±å¿ƒå® ç‰©åŒ»é™¢',
                        address: 'æ­å·å¸‚è¥¿æ¹–åŒºæ–‡ä¸‰è·¯123å·',
                        phone: '0571-88888888',
                        lat: 30.2741,
                        lng: 120.1551,
                        rating: 4.8,
                        reviews: [
                            {
                                author: 'çŒ«ä¸»äºº',
                                content: 'åŒ»ç”Ÿå¾ˆä¸“ä¸šï¼ŒæœåŠ¡æ€åº¦å¾ˆå¥½',
                                time: '1å‘¨å‰',
                                rating: 5
                            }
                        ],
                        distance: 0,
                        distanceText: '0m',
                        addedBy: 'ç®¡ç†å‘˜',
                        addedTime: '2024-01-15 10:30:00'
                    }
                ];
            }
        }

        // æ¸²æŸ“å¸–å­åˆ—è¡¨
        function renderPosts() {
            const postList = document.getElementById('postList');
            
            if (appData.posts.length === 0) {
                // æ˜¾ç¤ºç¤ºä¾‹å¸–å­
                postList.innerHTML = `
                    <div class="post-card">
                        <div class="post-header">
                            <div class="post-avatar">ç®¡</div>
                            <div class="post-info">
                                <div class="post-author">ç®¡ç†å‘˜</div>
                                <div class="post-time">2å°æ—¶å‰</div>
                            </div>
                        </div>
                        <div class="post-content">
                            <h3 style="margin-bottom: var(--spacing-sm);">æ¬¢è¿æ¥åˆ°é‡‘çŒ«è®ºå›ï¼</h3>
                            <p>æ¬¢è¿å¤§å®¶åœ¨è¿™é‡Œåˆ†äº«å…»çŒ«ç»éªŒï¼Œäº¤æµå…»çŒ«å¿ƒå¾—ã€‚æ— è®ºæ˜¯çŒ«å’ªçš„æ—¥å¸¸æŠ¤ç†ã€å¥åº·é—®é¢˜ï¼Œè¿˜æ˜¯æœ‰è¶£çš„çŒ«å’ªæ•…äº‹ï¼Œéƒ½å¯ä»¥åœ¨è¿™é‡Œå’Œå¤§å®¶åˆ†äº«ã€‚</p>
                            <p style="margin-top: var(--spacing-sm);">è®©æˆ‘ä»¬ä¸€èµ·æ¥åˆ›é€ ä¸€ä¸ªæ¸©æš–çš„çŒ«å’ªç¤¾åŒºå§ï¼ ğŸ±ğŸ’•</p>
                        </div>
                        <div class="post-actions">
                            <button class="post-action-btn" onclick="likePost(${Date.now()}, this)">
                                <span>â¤ï¸</span>
                                <span>128</span>
                            </button>
                            <button class="post-action-btn" onclick="showComments(${Date.now()})">
                                <span>ğŸ’¬</span>
                                <span>32</span>
                            </button>
                            <button class="post-action-btn" onclick="sharePost(${Date.now()})">
                                <span>ğŸ“¤</span>
                                <span>åˆ†äº«</span>
                            </button>
                        </div>
                    </div>
                `;
                return;
            }

            postList.innerHTML = appData.posts.map(post => `
                <div class="post-card">
                    <div class="post-header">
                        <div class="post-avatar">${post.avatar}</div>
                        <div class="post-info">
                            <div class="post-author">${post.author}</div>
                            <div class="post-time">${post.time}</div>
                        </div>
                    </div>
                    <div class="post-content">
                        <h3 style="margin-bottom: var(--spacing-sm);">${post.title}</h3>
                        <p>${post.content}</p>
                        ${post.images.length > 0 ? `
                            <div class="post-images">
                                ${post.images.map(image => `<img src="${image}" class="post-image" alt="å¸–å­å›¾ç‰‡" onclick="openImageViewer('${image}', ${post.id})">`).join('')}
                            </div>
                        ` : ''}
                    </div>
                    <div class="post-actions">
                        <button class="post-action-btn ${post.liked ? 'liked' : ''}" onclick="likePost(${post.id}, this)">
                            <span>${post.liked ? 'â¤ï¸' : 'ğŸ¤'}</span>
                            <span>${post.likes}</span>
                        </button>
                        <button class="post-action-btn" onclick="showComments(${post.id})">
                            <span>ğŸ’¬</span>
                            <span>${post.comments.length}</span>
                        </button>
                        <button class="post-action-btn" onclick="sharePost(${post.id})">
                            <span>ğŸ“¤</span>
                            <span>åˆ†äº«</span>
                        </button>
                        ${appData.isAdmin ? `
                            <button class="post-action-btn admin-btn" onclick="deletePost(${post.id})">
                                <span>ğŸ—‘ï¸</span>
                                <span>åˆ é™¤</span>
                            </button>
                            <button class="post-action-btn admin-btn" onclick="pinPost(${post.id})">
                                <span>ğŸ“Œ</span>
                                <span>ç½®é¡¶</span>
                            </button>
                        ` : ''}
                    </div>
                    <div class="comments-section" id="comments-${post.id}">
                        ${post.comments.map(comment => `
                            <div class="comment-item">
                                <div class="comment-author">${comment.author}</div>
                                <div class="comment-content">${comment.content}</div>
                                <div class="comment-time">${comment.time}</div>
                            </div>
                        `).join('')}
                        <div class="comment-item">
                            <div class="form-group" style="margin: 0; display: flex; gap: 8px;">
                                <input type="text" class="input" id="comment-input-${post.id}" placeholder="å†™ä¸‹ä½ çš„è¯„è®º..." onkeypress="if(event.key==='Enter') addComment(${post.id}, this.value, this)">
                                <button class="btn btn-primary btn-small" onclick="addComment(${post.id}, document.getElementById('comment-input-${post.id}').value, document.getElementById('comment-input-${post.id}'))">å‘é€</button>
                            </div>
                        </div>
                    </div>
                    ${post.comments.length > 0 ? `
                        <div class="expand-comments" onclick="toggleComments(${post.id})">
                            <span id="expand-text-${post.id}">å±•å¼€æ‰€æœ‰è¯„è®º â–¼</span>
                        </div>
                    ` : ''}
                </div>
            `).join('');
        }

        // ç‚¹èµå¸–å­
        function likePost(postId, button) {
            const post = appData.posts.find(p => p.id === postId);
            if (post) {
                post.liked = !post.liked;
                post.likes += post.liked ? 1 : -1;
                
                const btn = button.querySelector('span:first-child');
                const count = button.querySelector('span:last-child');
                
                btn.textContent = post.liked ? 'â¤ï¸' : 'ğŸ¤';
                button.classList.toggle('liked', post.liked);
                count.textContent = post.likes;
                
                showToast(post.liked ? 'å·²ç‚¹èµ' : 'å·²å–æ¶ˆç‚¹èµ', 'success');
            }
        }

        // æ˜¾ç¤ºè¯„è®º
        function showComments(postId) {
            const commentsSection = document.getElementById(`comments-${postId}`);
            if (commentsSection) {
                commentsSection.classList.add('expanded');
            }
        }

        // åˆ‡æ¢è¯„è®ºå±•å¼€/æ”¶èµ·
        function toggleComments(postId) {
            const commentsSection = document.getElementById(`comments-${postId}`);
            const expandText = document.getElementById(`expand-text-${postId}`);
            
            if (commentsSection.classList.contains('expanded')) {
                commentsSection.classList.remove('expanded');
                expandText.textContent = 'å±•å¼€æ‰€æœ‰è¯„è®º â–¼';
            } else {
                commentsSection.classList.add('expanded');
                expandText.textContent = 'æ”¶èµ·è¯„è®º â–²';
            }
        }

        // æ·»åŠ è¯„è®º
        function addComment(postId, content, input) {
            if (!content.trim()) {
                showToast('è¯·è¾“å…¥è¯„è®ºå†…å®¹', 'error');
                return;
            }
            
            const post = appData.posts.find(p => p.id === postId);
            if (post) {
                const comment = {
                    author: appData.currentUser ? appData.currentUser : 'æ¸¸å®¢',
                    content: content.trim(),
                    time: 'åˆšåˆš'
                };
                post.comments.push(comment);
                renderPosts();
                showToast('è¯„è®ºæˆåŠŸ', 'success');
                
                // æ¸…ç©ºè¾“å…¥æ¡†
                if (input) {
                    input.value = '';
                }
            }
        }

        // åˆ†äº«å¸–å­
        function sharePost(postId) {
            showToast('åˆ†äº«åŠŸèƒ½å¼€å‘ä¸­...', 'info');
        }

        // è·å–å½“å‰ä½ç½®
        function getCurrentLocation() {
            if (!navigator.geolocation) {
                showToast('æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒå®šä½åŠŸèƒ½', 'error');
                return;
            }

            showToast('æ­£åœ¨è·å–ä½ç½®ä¿¡æ¯...', 'info');
            
            navigator.geolocation.getCurrentPosition(
                (position) => {
                    appData.currentLocation = {
                        lat: position.coords.latitude,
                        lng: position.coords.longitude
                    };
                    showToast('å®šä½æˆåŠŸï¼', 'success');
                    initMap();
                    loadNearbyHospitals();
                },
                (error) => {
                    console.error('å®šä½å¤±è´¥:', error);
                    showToast('å®šä½å¤±è´¥ï¼Œè¯·æ£€æŸ¥å®šä½æƒé™', 'error');
                    // ä½¿ç”¨é»˜è®¤ä½ç½®ï¼ˆæ­å·å¸‚ä¸­å¿ƒï¼‰
                    appData.currentLocation = {
                        lat: 30.2741,
                        lng: 120.1551
                    };
                    initMap();
                    loadNearbyHospitals();
                }
            );
        }

        // åˆå§‹åŒ–åœ°å›¾
        function initMap() {
            const mapContainer = document.getElementById('mapContainer');
            
            // æ£€æŸ¥é«˜å¾·åœ°å›¾APIæ˜¯å¦åŠ è½½æˆåŠŸ
            if (typeof AMap !== 'undefined') {
                // ä½¿ç”¨çœŸæ­£çš„é«˜å¾·åœ°å›¾
                try {
                    // åˆ›å»ºåœ°å›¾å®ä¾‹
                    appData.map = new AMap.Map('mapContainer', {
                        zoom: 13,
                        center: [appData.currentLocation.lng, appData.currentLocation.lat]
                    });

                    // æ·»åŠ å½“å‰ä½ç½®æ ‡è®°
                    const currentMarker = new AMap.Marker({
                        position: [appData.currentLocation.lng, appData.currentLocation.lat],
                        title: 'å½“å‰ä½ç½®',
                        icon: new AMap.Icon({
                            size: new AMap.Size(25, 34),
                            image: 'https://webapi.amap.com/theme/v1.3/markers/n/mark_b.png'
                        })
                    });

                    appData.map.add(currentMarker);

                    // æ·»åŠ åŒ»é™¢æ ‡è®°
                    updateMapWithHospitals();

                    const totalHospitals = (appData.hospitals ? appData.hospitals.length : 0) + (appData.nearbyHospitals ? appData.nearbyHospitals.length : 0);
                    if (totalHospitals > 0) {
                        showToast('åœ°å›¾åŠ è½½æˆåŠŸï¼æ˜¾ç¤º ' + totalHospitals + ' å®¶åŒ»é™¢', 'success');
                    } else {
                        showToast('åœ°å›¾åŠ è½½æˆåŠŸï¼æš‚æ— åŒ»é™¢ä¿¡æ¯', 'info');
                    }
                    
                } catch (error) {
                    console.error('åœ°å›¾åˆå§‹åŒ–å¤±è´¥:', error);
                    showFallbackMap();
                }
            } else {
                // é«˜å¾·APIæœªåŠ è½½ï¼Œæ˜¾ç¤ºå¤‡ç”¨åœ°å›¾
                showFallbackMap();
            }
        }

        // åœ¨åœ°å›¾ä¸Šæ˜¾ç¤ºåŒ»é™¢æ ‡è®°
        function updateMapWithHospitals() {
            if (!appData.map) {
                return;
            }
            
            // æ¸…é™¤ç°æœ‰åŒ»é™¢æ ‡è®°
            if (appData.hospitalMarkers && appData.hospitalMarkers.length > 0) {
                appData.hospitalMarkers.forEach(marker => {
                    appData.map.remove(marker);
                });
            }
            
            appData.hospitalMarkers = [];
            
            // æ·»åŠ æ¨èåŒ»é™¢æ ‡è®°ï¼ˆç®¡ç†å‘˜ä¸Šä¼ çš„ï¼‰
            if (appData.hospitals && appData.hospitals.length > 0) {
                appData.hospitals.forEach(hospital => {
                    const marker = new AMap.Marker({
                        position: [hospital.lng, hospital.lat],
                        title: hospital.name,
                        icon: new AMap.Icon({
                            size: new AMap.Size(25, 34),
                            image: 'https://webapi.amap.com/theme/v1.3/markers/n/mark_r.png'
                        })
                    });
                    
                    // æ·»åŠ ç‚¹å‡»äº‹ä»¶
                    marker.on('click', function() {
                        selectHospital(hospital.id);
                    });
                    
                    appData.map.add(marker);
                    appData.hospitalMarkers.push(marker);
                });
            }
            
            // æ·»åŠ é™„è¿‘åŒ»é™¢æ ‡è®°ï¼ˆåŸºäºåœ°ç†ä½ç½®ï¼‰
            if (appData.nearbyHospitals && appData.nearbyHospitals.length > 0) {
                appData.nearbyHospitals.forEach(hospital => {
                    const marker = new AMap.Marker({
                        position: [hospital.lng, hospital.lat],
                        title: hospital.name,
                        icon: new AMap.Icon({
                            size: new AMap.Size(25, 34),
                            image: 'https://webapi.amap.com/theme/v1.3/markers/n/mark_g.png'
                        })
                    });
                    
                    // æ·»åŠ ç‚¹å‡»äº‹ä»¶
                    marker.on('click', function() {
                        selectNearbyHospital(hospital.id);
                    });
                    
                    appData.map.add(marker);
                    appData.hospitalMarkers.push(marker);
                });
            }
        }

        // å¤‡ç”¨åœ°å›¾æ˜¾ç¤º
        function showFallbackMap() {
            const mapContainer = document.getElementById('mapContainer');
            
            mapContainer.innerHTML = `
                <div style="height: 100%; background: linear-gradient(to bottom, #e8f5e8, #f0f8f0); position: relative; cursor: move;" onclick="openExternalMap()">
                    <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); font-size: 48px;">ğŸ“</div>
                    <div style="position: absolute; top: 20px; left: 10px; background: white; padding: 10px; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                        <div style="font-weight: 600;">ğŸ—ºï¸ åœ°å›¾è§†å›¾</div>
                        <div style="font-size: 12px; color: #666;">${(appData.hospitals ? appData.hospitals.length : 0) + (appData.nearbyHospitals ? appData.nearbyHospitals.length : 0)} å®¶åŒ»é™¢</div>
                        <div style="font-size: 10px; color: #999; margin-top: 4px;">ç‚¹å‡»æ‰“å¼€å¤–éƒ¨åœ°å›¾</div>
                    </div>
                    <!-- æ¨èåŒ»é™¢æ ‡è®° -->
                    ${appData.hospitals && appData.hospitals.length > 0 ? appData.hospitals.slice(0, 2).map((hospital, index) => {
                        const positions = [
                            { top: '30%', left: '20%' },
                            { top: '50%', left: '30%' }
                        ];
                        return `
                            <div style="position: absolute; ${positions[index].top}; ${positions[index].left}; transform: translate(-50%, -50%); cursor: pointer;" onclick="event.stopPropagation(); selectHospital(${hospital.id})">
                                <div style="font-size: 24px;">â­</div>
                                <div style="background: white; padding: 4px 8px; border-radius: 4px; font-size: 12px; white-space: nowrap; box-shadow: 0 2px 4px rgba(0,0,0,0.2);">
                                    ${hospital.name}
                                </div>
                            </div>
                        `;
                    }).join('') : ''}
                    <!-- é™„è¿‘åŒ»é™¢æ ‡è®° -->
                    ${appData.nearbyHospitals && appData.nearbyHospitals.length > 0 ? appData.nearbyHospitals.slice(0, 1).map((hospital, index) => {
                        const positions = [
                            { top: '60%', left: '70%' }
                        ];
                        return `
                            <div style="position: absolute; ${positions[index].top}; ${positions[index].left}; transform: translate(-50%, -50%); cursor: pointer;" onclick="event.stopPropagation(); selectNearbyHospital('${hospital.id}')">
                                <div style="font-size: 24px;">ğŸ“</div>
                                <div style="background: white; padding: 4px 8px; border-radius: 4px; font-size: 12px; white-space: nowrap; box-shadow: 0 2px 4px rgba(0,0,0,0.2);">
                                    ${hospital.name}
                                </div>
                            </div>
                        `;
                    }).join('') : ''}
                </div>
            `;
            
            showToast('åœ°å›¾å·²åŠ è½½ï¼ˆç‚¹å‡»åœ°å›¾å¯æ‰“å¼€å¤–éƒ¨åœ°å›¾ï¼‰', 'info');
        }

        // æ‰“å¼€å¤–éƒ¨åœ°å›¾
        function openExternalMap() {
            if (appData.currentLocation) {
                // ä½¿ç”¨é«˜å¾·åœ°å›¾å¯¼èˆªåˆ°å½“å‰ä½ç½®
                const mapUrl = `https://uri.amap.com/navigation?to=${appData.currentLocation.lng},${appData.currentLocation.lat},æˆ‘çš„ä½ç½®&mode=car`;
                window.open(mapUrl, '_blank');
            } else {
                showToast('è¯·å…ˆè·å–å½“å‰ä½ç½®', 'warning');
            }
        }

        // åŠ è½½é™„è¿‘åŒ»é™¢ - åªæ˜¾ç¤ºç®¡ç†å‘˜ä¸Šä¼ çš„åŒ»é™¢
        function loadNearbyHospitals() {
            // é¦–å…ˆå°è¯•è·å–ç”¨æˆ·çœŸå®ä½ç½®
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    function(position) {
                        // æˆåŠŸè·å–ä½ç½®
                        appData.currentLocation = {
                            lat: position.coords.latitude,
                            lng: position.coords.longitude
                        };
                        console.log('è·å–åˆ°çœŸå®ä½ç½®:', appData.currentLocation);
                        // åŒæ—¶æ¸²æŸ“æ¨èåŒ»é™¢å’Œç”Ÿæˆé™„è¿‘åŒ»é™¢
                        renderRecommendedHospitals();
                        generateNearbyHospitals();
                    },
                    function(error) {
                        // å®šä½å¤±è´¥ï¼Œä½¿ç”¨é»˜è®¤ä½ç½®
                        console.warn('å®šä½å¤±è´¥ï¼Œä½¿ç”¨é»˜è®¤ä½ç½®:', error.message);
                        appData.currentLocation = {
                            lat: 30.2741,
                            lng: 120.1551
                        };
                        // åŒæ—¶æ¸²æŸ“æ¨èåŒ»é™¢å’Œç”Ÿæˆé™„è¿‘åŒ»é™¢
                        renderRecommendedHospitals();
                        generateNearbyHospitals();
                    },
                    {
                        enableHighAccuracy: true,
                        timeout: 5000,
                        maximumAge: 0
                    }
                );
            } else {
                // æµè§ˆå™¨ä¸æ”¯æŒå®šä½
                appData.currentLocation = {
                    lat: 30.2741,
                    lng: 120.1551
                };
                // åŒæ—¶æ¸²æŸ“æ¨èåŒ»é™¢å’Œç”Ÿæˆé™„è¿‘åŒ»é™¢
                renderRecommendedHospitals();
                generateNearbyHospitals();
            }
        }

        // æ¸²æŸ“æ¨èåŒ»é™¢ï¼ˆç®¡ç†å‘˜ä¸Šä¼ ï¼Œæ ¹æ®å½“å‰ä½ç½®ç­›é€‰é™„è¿‘ï¼‰
        function renderRecommendedHospitals() {
            const container = document.getElementById('recommendedHospitalList');
            
            if (!appData.hospitals || appData.hospitals.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 20px; color: var(--apple-gray-medium);">
                        <div style="font-size: 32px; margin-bottom: var(--spacing-sm);">ğŸ¥</div>
                        <p>æš‚æ— æ¨èåŒ»é™¢ï¼Œè¯·è”ç³»ç®¡ç†å‘˜æ·»åŠ </p>
                    </div>
                `;
                return;
            }

            // è·å–å½“å‰åŸå¸‚ä¿¡æ¯
            let currentCity = 'æœªçŸ¥åŸå¸‚';
            if (appData.currentLocation) {
                currentCity = getCityByLocation(appData.currentLocation.lat, appData.currentLocation.lng);
            }

            // ç­›é€‰å½“å‰åŸå¸‚çš„æ¨èåŒ»é™¢ï¼ˆ50kmèŒƒå›´å†…ï¼‰
            let filteredHospitals = appData.hospitals;
            if (appData.currentLocation) {
                filteredHospitals = appData.hospitals.filter(hospital => {
                    const distance = calculateDistance(
                        appData.currentLocation.lat,
                        appData.currentLocation.lng,
                        hospital.lat,
                        hospital.lng
                    );
                    // åªæ˜¾ç¤º50kmå†…çš„æ¨èåŒ»é™¢
                    return distance <= 50;
                }).map(hospital => {
                    const distance = calculateDistance(
                        appData.currentLocation.lat,
                        appData.currentLocation.lng,
                        hospital.lat,
                        hospital.lng
                    );
                    return {
                        ...hospital,
                        distance: distance,
                        distanceText: distance < 1 ? `${(distance * 1000).toFixed(0)}m` : `${distance.toFixed(1)}km`
                    };
                }).sort((a, b) => a.distance - b.distance);
            }

            if (filteredHospitals.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 20px; color: var(--apple-gray-medium);">
                        <div style="font-size: 32px; margin-bottom: var(--spacing-sm);">ğŸ¥</div>
                        <p>${currentCity}é™„è¿‘æš‚æ— æ¨èåŒ»é™¢</p>
                        <p style="font-size: 12px; margin-top: 8px;">è¯·è”ç³»ç®¡ç†å‘˜æ·»åŠ ${currentCity}çš„æ¨èåŒ»é™¢</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = `
                <div style="margin-bottom: 15px; padding: 10px; background: var(--apple-blue-light); border-radius: 8px; text-align: center; color: var(--apple-blue-dark);">
                    ğŸ“ ${currentCity}é™„è¿‘æ¨èåŒ»é™¢ (${filteredHospitals.length}å®¶)
                </div>
            ` + filteredHospitals.map(hospital => `
                <div class="hospital-card">
                    <div class="hospital-header">
                        <div class="hospital-name">â­ ${hospital.name}</div>
                        <div class="hospital-info">
                            <div>ğŸ“ ${hospital.address}</div>
                            <div>ğŸ“ ${hospital.phone}</div>
                            <div>ğŸš¶ è·ç¦» ${hospital.distanceText}</div>
                        </div>
                        <div class="hospital-rating">
                            <span class="rating-stars">${'â­'.repeat(Math.floor(hospital.rating))}</span>
                            <span>${hospital.rating} åˆ†</span>
                            <span style="color: var(--apple-gray-medium);">(${hospital.reviews.length} æ¡è¯„ä»·)</span>
                        </div>
                    </div>
                    <div class="hospital-actions">
                        <button class="btn btn-primary btn-small" onclick="selectHospital(${hospital.id})">ğŸ§­ å¯¼èˆª</button>
                        <button class="btn btn-secondary btn-small" onclick="openGaodeMap(${hospital.id})">ğŸ—ºï¸ é«˜å¾·</button>
                        ${appData.isAdmin ? `
                            <button class="btn btn-secondary btn-small" onclick="deleteHospital(${hospital.id})">ğŸ—‘ï¸ åˆ é™¤</button>
                        ` : ''}
                    </div>
                </div>
            `).join('');
        }

        // æ ¹æ®ç»çº¬åº¦è·å–åŸå¸‚åç§°
        function getCityByLocation(lat, lng) {
            if (lat > 39 && lat < 41 && lng > 116 && lng < 117) {
                return 'åŒ—äº¬';
            } else if (lat > 31 && lat < 32 && lng > 121 && lng < 122) {
                return 'ä¸Šæµ·';
            } else if (lat > 22 && lat < 24 && lng > 113 && lng < 115) {
                return 'æ·±åœ³';
            } else if (lat > 31 && lat < 31.5 && lng > 120.4 && lng < 121) {
                return 'è‹å·';
            } else if (lat > 30 && lat < 31 && lng > 120 && lng < 121) {
                return 'æ­å·';
            } else {
                return 'æœªçŸ¥åŸå¸‚';
            }
        }

        // ç”Ÿæˆé™„è¿‘åŒ»é™¢æ•°æ®ï¼ˆåŸºäºåœ°ç†ä½ç½®ï¼‰
        function generateNearbyHospitals() {
            // æ¸…ç©ºé™„è¿‘åŒ»é™¢æ•°æ®
            appData.nearbyHospitals = [];
            
            const hospitalPrefixes = ['çˆ±å¿ƒ', 'åå’Œ', 'èŒå® ', 'å®ˆæŠ¤', 'é˜³å…‰', 'è“å¤©', 'å¸Œæœ›', 'åº·ä¹', 'å¥åº·', 'å® çˆ±'];
            const hospitalSuffixes = ['å® ç‰©åŒ»é™¢', 'åŠ¨ç‰©åŒ»é™¢', 'å® ç‰©è¯Šæ‰€', 'å…½åŒ»é™¢', 'å® ç‰©ä¸­å¿ƒ'];
            
            const hospitalTemplates = [];
            
            // ç”Ÿæˆ7ä¸ªéšæœºåŒ»é™¢
            for (let i = 0; i < 7; i++) {
                const randomPrefix = hospitalPrefixes[Math.floor(Math.random() * hospitalPrefixes.length)];
                const randomSuffix = hospitalSuffixes[Math.floor(Math.random() * hospitalSuffixes.length)];
                hospitalTemplates.push({
                    prefix: randomPrefix,
                    suffix: randomSuffix,
                    baseRating: 3.5 + Math.random() * 1.5 // 3.5-5.0ä¹‹é—´çš„éšæœºè¯„åˆ†
                });
            }

            // åŸºäºå½“å‰ä½ç½®ç”ŸæˆåŒ»é™¢æ•°æ®
            const hospitalData = hospitalTemplates.map((template, index) => {
                // åœ¨ç”¨æˆ·ä½ç½®å‘¨å›´éšæœºåˆ†å¸ƒåŒ»é™¢
                const angle = (Math.PI * 2 * index) / hospitalTemplates.length;
                const distance = 0.5 + Math.random() * 5; // 0.5km - 5.5km èŒƒå›´å†…
                
                const lat = appData.currentLocation.lat + distance * Math.sin(angle) / 111;
                const lng = appData.currentLocation.lng + distance * Math.cos(angle) / (111 * Math.cos(appData.currentLocation.lat * Math.PI / 180));
                
                // æ ¹æ®å½“å‰ä½ç½®ç”Ÿæˆæ›´çœŸå®çš„åœ°å€
                let city = 'æ­å·å¸‚';
                let districts;
                
                // æ ¹æ®ç»çº¬åº¦åˆ¤æ–­åŸå¸‚
                if (appData.currentLocation.lat > 39 && appData.currentLocation.lat < 41 && 
                    appData.currentLocation.lng > 116 && appData.currentLocation.lng < 117) {
                    city = 'åŒ—äº¬å¸‚';
                    districts = ['æœé˜³åŒº', 'æµ·æ·€åŒº', 'ä¸œåŸåŒº', 'è¥¿åŸåŒº', 'ä¸°å°åŒº', 'çŸ³æ™¯å±±åŒº', 'é€šå·åŒº', 'æ˜Œå¹³åŒº'];
                } else if (appData.currentLocation.lat > 31 && appData.currentLocation.lat < 32 && 
                          appData.currentLocation.lng > 121 && appData.currentLocation.lng < 122) {
                    city = 'ä¸Šæµ·å¸‚';
                    districts = ['æµ¦ä¸œæ–°åŒº', 'é»„æµ¦åŒº', 'å¾æ±‡åŒº', 'é•¿å®åŒº', 'é™å®‰åŒº', 'æ™®é™€åŒº', 'è™¹å£åŒº', 'æ¨æµ¦åŒº'];
                } else if (appData.currentLocation.lat > 22 && appData.currentLocation.lat < 24 && 
                          appData.currentLocation.lng > 113 && appData.currentLocation.lng < 115) {
                    city = 'æ·±åœ³å¸‚';
                    districts = ['ç¦ç”°åŒº', 'å—å±±åŒº', 'ç½—æ¹–åŒº', 'å®å®‰åŒº', 'é¾™å²—åŒº', 'é¾™ååŒº', 'åªå±±åŒº', 'å…‰æ˜åŒº'];
                } else if (appData.currentLocation.lat > 31 && appData.currentLocation.lat < 31.5 && 
                          appData.currentLocation.lng > 120.4 && appData.currentLocation.lng < 121) {
                    city = 'è‹å·å¸‚';
                    districts = ['å§‘è‹åŒº', 'è™ä¸˜åŒº', 'å´ä¸­åŒº', 'ç›¸åŸåŒº', 'å´æ±ŸåŒº', 'æ˜†å±±å¸‚', 'å¤ªä»“å¸‚', 'å¸¸ç†Ÿå¸‚'];
                } else if (appData.currentLocation.lat > 30 && appData.currentLocation.lat < 31 && 
                          appData.currentLocation.lng > 120 && appData.currentLocation.lng < 121) {
                    city = 'æ­å·å¸‚';
                    districts = ['æ±Ÿå¹²åŒº', 'è¥¿æ¹–åŒº', 'æ‹±å¢…åŒº', 'æ»¨æ±ŸåŒº', 'ä¸ŠåŸåŒº', 'ä¸‹åŸåŒº', 'ä½™æ­åŒº', 'è§å±±åŒº'];
                } else {
                    districts = ['ä¸­å¿ƒåŒº', 'ä¸œåŒº', 'è¥¿åŒº', 'å—åŒº', 'åŒ—åŒº', 'æ–°åŒº', 'å¼€å‘åŒº', 'é«˜æ–°åŒº'];
                }
                
                const roads = ['è·¯', 'è¡—', 'å¤§é“', 'å··', 'å¹¿åœº', 'ä¸­å¿ƒ'];
                const numbers = Math.floor(Math.random() * 999) + 1;
                
                // æ ¹æ®åŸå¸‚è®¾ç½®å¯¹åº”çš„ç”µè¯åŒºå·
                let phonePrefix = '0571'; // é»˜è®¤æ­å·
                if (city === 'åŒ—äº¬å¸‚') phonePrefix = '010';
                else if (city === 'ä¸Šæµ·å¸‚') phonePrefix = '021';
                else if (city === 'æ·±åœ³å¸‚') phonePrefix = '0755';
                else if (city === 'è‹å·å¸‚') phonePrefix = '0512';
                else if (city === 'æ­å·å¸‚') phonePrefix = '0571';
                
                return {
                    id: 'nearby_' + (index + 1),
                    name: template.prefix + template.suffix,
                    address: `${city}${districts[index % districts.length]}${roads[index % roads.length]}${numbers}å·`,
                    phone: `${phonePrefix}-${Math.floor(Math.random() * 90000000) + 10000000}`,
                    lat: lat,
                    lng: lng,
                    rating: parseFloat((template.baseRating + (Math.random() - 0.5)).toFixed(1)),
                    reviews: generateMockReviews()
                };
            });

            // è®¡ç®—è·ç¦»å¹¶æ’åº
            appData.nearbyHospitals = hospitalData.map(hospital => {
                const distance = calculateDistance(
                    appData.currentLocation.lat,
                    appData.currentLocation.lng,
                    hospital.lat,
                    hospital.lng
                );
                
                return {
                    ...hospital,
                    distance: distance,
                    distanceText: distance < 1 ? `${(distance * 1000).toFixed(0)}m` : `${distance.toFixed(1)}km`
                };
            }).sort((a, b) => a.distance - b.distance);

            renderNearbyHospitals();
            showToast(`æ‰¾åˆ° ${appData.nearbyHospitals.length} å®¶é™„è¿‘åŒ»é™¢`, 'info');
        }

        // æ¸²æŸ“é™„è¿‘åŒ»é™¢åˆ—è¡¨
        function renderNearbyHospitals() {
            const container = document.getElementById('nearbyHospitalList');
            
            if (!appData.nearbyHospitals || appData.nearbyHospitals.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 40px; color: var(--apple-gray-medium);">
                        <div style="font-size: 48px; margin-bottom: var(--spacing-sm);">ğŸ—ºï¸</div>
                        <p>è¯·ç‚¹å‡»"å®šä½"æŒ‰é’®æœç´¢é™„è¿‘å® ç‰©åŒ»é™¢</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = appData.nearbyHospitals.map(hospital => `
                <div class="hospital-card">
                    <div class="hospital-header">
                        <div class="hospital-name">ğŸ“ ${hospital.name}</div>
                        <div class="hospital-info">
                            <div>ğŸ“ ${hospital.address}</div>
                            <div>ğŸ“ ${hospital.phone}</div>
                            <div>ğŸš¶ è·ç¦» ${hospital.distanceText}</div>
                        </div>
                        <div class="hospital-rating">
                            <span class="rating-stars">${'â­'.repeat(Math.floor(hospital.rating))}</span>
                            <span>${hospital.rating} åˆ†</span>
                            <span style="color: var(--apple-gray-medium);">(${hospital.reviews.length} æ¡è¯„ä»·)</span>
                        </div>
                    </div>
                    <div class="hospital-actions">
                        <button class="btn btn-primary btn-small" onclick="selectNearbyHospital('${hospital.id}')">ğŸ§­ å¯¼èˆª</button>
                        <button class="btn btn-secondary btn-small" onclick="openGaodeMapNearby('${hospital.id}')">ğŸ—ºï¸ é«˜å¾·</button>
                    </div>
                </div>
            `).join('');
        }

        // ç”Ÿæˆæ¨¡æ‹Ÿè¯„è®º
        function generateMockReviews() {
            const reviewTemplates = [
                { author: 'çŒ«ä¸»äºº', content: 'åŒ»ç”Ÿå¾ˆä¸“ä¸šï¼ŒæœåŠ¡æ€åº¦å¾ˆå¥½', rating: 5 },
                { author: 'çˆ±çŒ«äººå£«', content: 'ä»·æ ¼åˆç†ï¼Œç¯å¢ƒå¹²å‡€', rating: 4 },
                { author: 'å® ç‰©å®¶é•¿', content: 'æ€¥è¯Šå¾ˆå¿«ï¼Œè®¾å¤‡å…ˆè¿›', rating: 5 },
                { author: 'çŒ«å¥´', content: 'åŒ»ç”Ÿå¾ˆè€å¿ƒï¼Œè§£ç­”è¯¦ç»†', rating: 4 },
                { author: 'é“²å±å®˜', content: 'æœåŠ¡ä¸€æµï¼Œæ¨èï¼', rating: 5 },
                { author: 'å® ç‰©çˆ±å¥½è€…', content: 'ç¯å¢ƒå¾ˆå¥½ï¼ŒåŒ»ç”Ÿä¸“ä¸š', rating: 4 },
                { author: 'å…»çŒ«è¾¾äºº', content: 'ä»·æ ¼å®æƒ ï¼ŒæœåŠ¡æ€åº¦å¥½', rating: 4 }
            ];
            
            const numReviews = Math.floor(Math.random() * 3) + 1; // 1-3æ¡è¯„è®º
            const selectedReviews = [];
            
            for (let i = 0; i < numReviews; i++) {
                const template = reviewTemplates[Math.floor(Math.random() * reviewTemplates.length)];
                selectedReviews.push({
                    ...template,
                    time: [`${Math.floor(Math.random() * 7) + 1}å¤©å‰`, '1å‘¨å‰', '2å‘¨å‰'][Math.floor(Math.random() * 3)]
                });
            }
            
            return selectedReviews;
        }

        // è®¡ç®—ä¸¤ç‚¹ä¹‹é—´è·ç¦»ï¼ˆä½¿ç”¨Haversineå…¬å¼ï¼‰
        function calculateDistance(lat1, lon1, lat2, lon2) {
            const R = 6371; // åœ°çƒåŠå¾„ï¼ˆå…¬é‡Œï¼‰
            const dLat = (lat2 - lat1) * Math.PI / 180;
            const dLon = (lon2 - lon1) * Math.PI / 180;
            const a = 
                Math.sin(dLat/2) * Math.sin(dLat/2) +
                Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) * 
                Math.sin(dLon/2) * Math.sin(dLon/2);
            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
            const distance = R * c;
            return distance;
        }

        // æ¸²æŸ“åŒ»é™¢åˆ—è¡¨
        function renderHospitals() {
            const hospitalList = document.getElementById('hospitalList');
            
            // å¦‚æœæ²¡æœ‰åŒ»é™¢æ•°æ®ï¼Œæ˜¾ç¤ºæç¤ºä¿¡æ¯
            if (!appData.hospitals || appData.hospitals.length === 0) {
                hospitalList.innerHTML = `
                    <div style="text-align: center; padding: 40px; color: var(--apple-gray-medium);">
                        <div style="font-size: 48px; margin-bottom: var(--spacing-sm);">ğŸ¥</div>
                        <p>æš‚æ— åŒ»é™¢ä¿¡æ¯ï¼Œè¯·è”ç³»ç®¡ç†å‘˜æ·»åŠ </p>
                    </div>
                `;
                return;
            }
            
            hospitalList.innerHTML = appData.hospitals.map(hospital => `
                <div class="hospital-card">
                    <div class="hospital-header">
                        <div class="hospital-name">${hospital.name}</div>
                        <div class="hospital-info">
                            <div>ğŸ“ ${hospital.address}</div>
                            <div>ğŸ“ ${hospital.phone}</div>
                            <div>ğŸš¶ è·ç¦» ${hospital.distanceText}</div>
                        </div>
                        <div class="hospital-rating">
                            <span class="rating-stars">${'â­'.repeat(Math.floor(hospital.rating))}</span>
                            <span>${hospital.rating} åˆ†</span>
                            <span style="color: var(--apple-gray-medium);">(${hospital.reviews.length} æ¡è¯„ä»·)</span>
                        </div>
                    </div>
                    <div class="hospital-actions">
                        <button class="btn btn-primary btn-small" onclick="selectHospital(${hospital.id})">ğŸ§­ å¯¼èˆª</button>
                        <button class="btn btn-secondary btn-small" onclick="openGaodeMap(${hospital.id})">ğŸ—ºï¸ é«˜å¾·</button>
                        <button class="btn btn-secondary btn-small" onclick="openHospitalReviewModal(${hospital.id})">â­ è¯„ä»·</button>
                    </div>
                    <div class="comments-section" id="hospital-comments-${hospital.id}">
                        ${hospital.reviews.map(review => `
                            <div class="comment-item">
                                <div class="comment-author">${review.author} ${'â­'.repeat(review.rating)}</div>
                                <div class="comment-content">${review.content}</div>
                                <div class="comment-time">${review.time}</div>
                            </div>
                        `).join('')}
                    </div>
                    ${hospital.reviews.length > 0 ? `
                        <div class="expand-comments" onclick="toggleHospitalComments(${hospital.id})">
                            <span id="hospital-expand-${hospital.id}">å±•å¼€è¯„ä»· â–¼</span>
                        </div>
                    ` : ''}
                </div>
            `).join('');
        }

        // åˆ‡æ¢åŒ»é™¢è¯„è®ºå±•å¼€/æ”¶èµ·
        function toggleHospitalComments(hospitalId) {
            const commentsSection = document.getElementById(`hospital-comments-${hospitalId}`);
            const expandText = document.getElementById(`hospital-expand-${hospitalId}`);
            
            if (commentsSection.classList.contains('expanded')) {
                commentsSection.classList.remove('expanded');
                expandText.textContent = 'å±•å¼€è¯„ä»· â–¼';
            } else {
                commentsSection.classList.add('expanded');
                expandText.textContent = 'æ”¶èµ·è¯„ä»· â–²';
            }
        }

        // é€‰æ‹©åŒ»é™¢ - ç›´æ¥è·³è½¬é«˜å¾·åœ°å›¾
        function selectHospital(hospitalId) {
            const hospital = appData.hospitals.find(h => h.id === hospitalId);
            if (hospital) {
                showToast(`æ­£åœ¨è·³è½¬åˆ°é«˜å¾·åœ°å›¾å¯¼èˆªåˆ° ${hospital.name}...`, 'info');
                
                // ç¡®ä¿åæ ‡æ ¼å¼æ­£ç¡®
                const fromLng = appData.currentLocation.lng || 120.1551;
                const fromLat = appData.currentLocation.lat || 30.2741;
                
                // æ„å»ºé«˜å¾·åœ°å›¾å¯¼èˆªURLï¼Œç›®çš„åœ°ä¸ºé€‰ä¸­çš„åŒ»é™¢
                const gaodeUrl = `https://uri.amap.com/navigation?to=${hospital.lng},${hospital.lat},${encodeURIComponent(hospital.name)}&mode=car&from=${fromLng},${fromLat},æˆ‘çš„ä½ç½®`;
                
                // å»¶è¿Ÿè·³è½¬ï¼Œè®©æç¤ºå…ˆæ˜¾ç¤º
                setTimeout(() => {
                    window.open(gaodeUrl, '_blank');
                }, 500);
            }
        }

        // é€‰æ‹©é™„è¿‘åŒ»é™¢ - ç›´æ¥è·³è½¬é«˜å¾·åœ°å›¾
        function selectNearbyHospital(hospitalId) {
            const hospital = appData.nearbyHospitals.find(h => h.id === hospitalId);
            if (hospital) {
                showToast(`æ­£åœ¨è·³è½¬åˆ°é«˜å¾·åœ°å›¾å¯¼èˆªåˆ° ${hospital.name}...`, 'info');
                
                // ç¡®ä¿åæ ‡æ ¼å¼æ­£ç¡®
                const fromLng = appData.currentLocation.lng || 120.1551;
                const fromLat = appData.currentLocation.lat || 30.2741;
                
                // æ„å»ºé«˜å¾·åœ°å›¾å¯¼èˆªURLï¼Œç›®çš„åœ°ä¸ºé€‰ä¸­çš„åŒ»é™¢
                const gaodeUrl = `https://uri.amap.com/navigation?to=${hospital.lng},${hospital.lat},${encodeURIComponent(hospital.name)}&mode=car&from=${fromLng},${fromLat},æˆ‘çš„ä½ç½®`;
                
                // å»¶è¿Ÿè·³è½¬ï¼Œè®©æç¤ºå…ˆæ˜¾ç¤º
                setTimeout(() => {
                    window.open(gaodeUrl, '_blank');
                }, 500);
            }
        }

        // æ‰“å¼€é™„è¿‘åŒ»é™¢çš„é«˜å¾·åœ°å›¾
        function openGaodeMapNearby(hospitalId) {
            const hospital = appData.nearbyHospitals.find(h => h.id === hospitalId);
            if (!hospital) return;
            
            showToast(`æ­£åœ¨æ‰“å¼€ ${hospital.name} çš„é«˜å¾·åœ°å›¾...`, 'info');
            
            // æ„å»ºé«˜å¾·åœ°å›¾URLï¼Œç›´æ¥æ˜¾ç¤ºåŒ»é™¢ä½ç½®
            const mapUrl = `https://uri.amap.com/marker?position=${hospital.lng},${hospital.lat}&name=${encodeURIComponent(hospital.name)}&coordinate=${appData.currentLocation.lng},${appData.currentLocation.lat}`;
            window.open(mapUrl, '_blank');
        }

        // æ‰“å¼€æ¨èåŒ»é™¢çš„é«˜å¾·åœ°å›¾
        function openGaodeMap(hospitalId) {
            const hospital = appData.hospitals.find(h => h.id === hospitalId);
            if (!hospital) return;
            
            showToast(`æ­£åœ¨æ‰“å¼€ ${hospital.name} çš„é«˜å¾·åœ°å›¾...`, 'info');
            
            // æ„å»ºé«˜å¾·åœ°å›¾URLï¼Œç›´æ¥æ˜¾ç¤ºåŒ»é™¢ä½ç½®
            const mapUrl = `https://uri.amap.com/marker?position=${hospital.lng},${hospital.lat}&name=${encodeURIComponent(hospital.name)}&coordinate=${appData.currentLocation.lng},${appData.currentLocation.lat}`;
            window.open(mapUrl, '_blank');
        }

        // åˆ é™¤æ¨èåŒ»é™¢ï¼ˆç®¡ç†å‘˜ä¸“ç”¨ï¼‰
        function deleteHospital(hospitalId) {
            if (!appData.isAdmin) {
                showToast('åªæœ‰ç®¡ç†å‘˜æ‰èƒ½åˆ é™¤åŒ»é™¢', 'error');
                return;
            }
            
            if (confirm('ç¡®å®šè¦åˆ é™¤è¿™å®¶æ¨èåŒ»é™¢å—ï¼Ÿ')) {
                const index = appData.hospitals.findIndex(h => h.id === hospitalId);
                if (index > -1) {
                    const hospitalName = appData.hospitals[index].name;
                    appData.hospitals.splice(index, 1);
                    renderRecommendedHospitals();
                    showToast(`å·²åˆ é™¤æ¨èåŒ»é™¢ï¼š${hospitalName}`, 'success');
                }
            }
        }

        // æ‰“å¼€åŒ»é™¢è¯„ä»·æ¨¡æ€æ¡†
        function openHospitalReviewModal(hospitalId) {
            document.getElementById('hospitalReviewModal').classList.add('active');
            document.getElementById('reviewHospitalId').value = hospitalId;
            document.getElementById('reviewContent').value = '';
            // é‡ç½®æ˜Ÿçº§é€‰æ‹©
            document.querySelectorAll('.star').forEach(star => star.style.opacity = '0.3');
        }

        // å…³é—­åŒ»é™¢è¯„ä»·æ¨¡æ€æ¡†
        function closeHospitalReviewModal() {
            document.getElementById('hospitalReviewModal').classList.remove('active');
        }

        // æäº¤åŒ»é™¢è¯„ä»·
        function submitReview() {
            const hospitalId = parseInt(document.getElementById('reviewHospitalId').value);
            const content = document.getElementById('reviewContent').value.trim();
            const selectedRating = parseInt(document.querySelector('.star[style*="opacity: 1"]')?.dataset.rating || 0);

            if (selectedRating === 0) {
                showToast('è¯·é€‰æ‹©è¯„åˆ†', 'error');
                return;
            }

            if (!content) {
                showToast('è¯·å¡«å†™è¯„ä»·å†…å®¹', 'error');
                return;
            }

            const hospital = appData.hospitals.find(h => h.id === hospitalId);
            if (hospital) {
                const review = {
                    author: 'ç”¨æˆ·' + Math.floor(Math.random() * 1000),
                    content: content,
                    time: 'åˆšåˆš',
                    rating: selectedRating
                };

                hospital.reviews.push(review);
                // é‡æ–°è®¡ç®—å¹³å‡è¯„åˆ†
                const totalRating = hospital.reviews.reduce((sum, r) => sum + r.rating, 0);
                hospital.rating = (totalRating / hospital.reviews.length).toFixed(1);

                renderHospitals();
                closeHospitalReviewModal();
                showToast('è¯„ä»·æäº¤æˆåŠŸï¼', 'success');
            }
        }

        // åˆ·æ–°åŒ»é™¢åˆ—è¡¨
        function refreshHospitals() {
            showToast('æ­£åœ¨åˆ·æ–°åŒ»é™¢ä¿¡æ¯...', 'info');
            loadNearbyHospitals();
        }

        // è¿‡æ»¤åŒ»é™¢
        function filterHospitals(searchTerm) {
            const filtered = appData.hospitals.filter(hospital => 
                hospital.name.includes(searchTerm) || 
                hospital.address.includes(searchTerm)
            );
            
            const hospitalList = document.getElementById('hospitalList');
            if (filtered.length === 0) {
                hospitalList.innerHTML = '<div style="text-align: center; padding: 40px; color: var(--apple-gray-medium);">æ²¡æœ‰æ‰¾åˆ°åŒ¹é…çš„åŒ»é™¢</div>';
            } else {
                const tempHospitals = appData.hospitals;
                appData.hospitals = filtered;
                renderHospitals();
                appData.hospitals = tempHospitals;
            }
        }

        // æ˜Ÿçº§è¯„åˆ†äº¤äº’
        document.addEventListener('DOMContentLoaded', function() {
            document.querySelectorAll('.star').forEach(star => {
                star.addEventListener('click', function() {
                    const rating = parseInt(this.dataset.rating);
                    document.querySelectorAll('.star').forEach((s, index) => {
                        s.style.opacity = (index < rating) ? '1' : '0.3';
                    });
                });

                star.addEventListener('mouseenter', function() {
                    const rating = parseInt(this.dataset.rating);
                    document.querySelectorAll('.star').forEach((s, index) => {
                        s.style.opacity = (index < rating) ? '1' : '0.3';
                    });
                });
            });

            document.getElementById('ratingStars')?.addEventListener('mouseleave', function() {
                const selectedRating = parseInt(document.querySelector('.star[style*="opacity: 1"]')?.dataset.rating || 0);
                document.querySelectorAll('.star').forEach((s, index) => {
                    s.style.opacity = (index < selectedRating) ? '1' : '0.3';
                });
            });
        });

        // å¼ºåˆ¶åˆå§‹åŒ–é¡µé¢æ˜¾ç¤º
        function forceInitializePages() {
            console.log('ğŸ”§ å¼ºåˆ¶åˆå§‹åŒ–é¡µé¢æ˜¾ç¤º...');
            
            // å¼ºåˆ¶éšè—æ‰€æœ‰é¡µé¢
            document.querySelectorAll('.page').forEach(page => {
                page.classList.remove('active');
                page.style.display = 'none';
                page.style.visibility = 'hidden';
                page.style.opacity = '0';
            });
            
            // å¼ºåˆ¶æ˜¾ç¤ºé¦–é¡µ
            const homePage = document.getElementById('home');
            if (homePage) {
                homePage.classList.add('active');
                homePage.style.display = 'block';
                homePage.style.visibility = 'visible';
                homePage.style.opacity = '1';
                console.log('âœ… é¦–é¡µå¼ºåˆ¶æ¿€æ´»');
            }
            
            // å¼ºåˆ¶æ˜¾ç¤ºç§»åŠ¨ç«¯å¯¼èˆªï¼ˆå¦‚æœæ˜¯ç§»åŠ¨è®¾å¤‡ï¼‰
            if (window.innerWidth <= 768) {
                const mobileNav = document.querySelector('.mobile-quick-nav');
                if (mobileNav) {
                    mobileNav.style.display = 'flex';
                    mobileNav.style.visibility = 'visible';
                    mobileNav.style.opacity = '1';
                    mobileNav.style.position = 'fixed';
                    mobileNav.style.bottom = '0';
                    mobileNav.style.left = '0';
                    mobileNav.style.right = '0';
                    mobileNav.style.zIndex = '9999';
                    console.log('âœ… ç§»åŠ¨ç«¯å¯¼èˆªå¼ºåˆ¶æ˜¾ç¤º');
                }
            }
            
            // å¼ºåˆ¶æ›´æ–°å¯¼èˆªçŠ¶æ€
            document.querySelectorAll('.nav-link').forEach(link => {
                link.classList.remove('active');
            });
            
            document.querySelectorAll('.mobile-quick-nav-item').forEach(item => {
                item.classList.remove('active');
            });
            
            // æ¿€æ´»é¦–é¡µå¯¼èˆª
            const homeNavLink = document.querySelector('[data-page="home"]');
            if (homeNavLink) {
                homeNavLink.classList.add('active');
            }
            
            const homeMobileLink = document.querySelector('.mobile-quick-nav-item[data-page="home"]');
            if (homeMobileLink) {
                homeMobileLink.classList.add('active');
            }
        }

        // ä¸“é—¨ä¿®å¤ç§»åŠ¨ç«¯å¯¼èˆªçš„å‡½æ•°
        function fixMobileNavigation() {
            console.log('ğŸ“± ä¿®å¤ç§»åŠ¨ç«¯å¯¼èˆª...');
            
            const mobileNav = document.querySelector('.mobile-quick-nav');
            if (mobileNav) {
                // åº”ç”¨å®Œæ•´çš„æ ·å¼
                mobileNav.style.cssText = `
                    display: flex !important;
                    visibility: visible !important;
                    opacity: 1 !important;
                    position: fixed !important;
                    bottom: 0 !important;
                    left: 0 !important;
                    right: 0 !important;
                    z-index: 9999 !important;
                    background: white !important;
                    border-top: 1px solid var(--apple-border) !important;
                    box-shadow: 0 -2px 10px rgba(0,0,0,0.1) !important;
                    justify-content: space-around !important;
                    padding: 8px 0 !important;
                    margin: 0 !important;
                    width: 100% !important;
                    height: auto !important;
                `;
                console.log('âœ… ç§»åŠ¨ç«¯å¯¼èˆªæ ·å¼å®Œå…¨åº”ç”¨');
            } else {
                console.error('âŒ æ‰¾ä¸åˆ°ç§»åŠ¨ç«¯å¯¼èˆªå…ƒç´ ');
            }
        }

        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ğŸš€ é‡‘çŒ«ä¹‹å®¶åŠ è½½å®Œæˆ');
            
            try {
                // åˆå§‹åŒ–å¤åˆ¶ç²˜è´´åŠŸèƒ½
                setTimeout(() => {
                    initializeCopyPaste();
                }, 500);
                
                // åˆå§‹åŒ–åŒ»é™¢æ’è¡Œæ¦œ
                setTimeout(() => {
                    if (!appData.hospitalRanking || appData.hospitalRanking.length === 0) {
                        initDefaultHospitalRanking();
                        saveToLocalStorage();
                    }
                    renderHospitalRanking();
                }, 600);
                
                // ç«‹å³æ‰§è¡Œå¼ºåˆ¶åˆå§‹åŒ–
                forceInitializePages();
                
                // å»¶è¿Ÿå†æ¬¡æ‰§è¡Œç¡®ä¿åˆå§‹åŒ–æˆåŠŸ
                setTimeout(() => {
                    forceInitializePages();
                }, 100);
                
                // å¦‚æœæ˜¯ç§»åŠ¨è®¾å¤‡ï¼Œé¢å¤–ä¿®å¤å¯¼èˆª
                if (window.innerWidth <= 768) {
                    setTimeout(() => {
                        fixMobileNavigation();
                    }, 200);
                    
                    setTimeout(() => {
                        fixMobileNavigation();
                    }, 1000);
                }
                
                // åˆå§‹åŒ–æ•°æ®å­˜å‚¨
                initializeLocalStorage();
                
                // åˆå§‹åŒ–é»˜è®¤æ•°æ®
                if (!appData.cats || appData.cats.length === 0) {
                    initDefaultCats();
                }
                if (!appData.products || appData.products.length === 0) {
                    initDefaultProducts();
                }
                if (!appData.posts || appData.posts.length === 0) {
                    initDefaultPosts();
                }
                if (!appData.recommendedHospitals || appData.recommendedHospitals.length === 0) {
                    initDefaultHospitals();
                }
                
                // æ¸²æŸ“åˆå§‹æ•°æ®
                renderPosts();
                renderRecommendedHospitals();
                renderCats();
                renderProducts();
                
                // åˆå§‹åŒ–ç™»å½•æŒ‰é’®å’Œç®¡ç†å‘˜çŠ¶æ€
                updateLoginButton();
                
                // åˆå§‹åŒ–ç”¨æˆ·èµ„æ–™
                initUserProfile();
                
                // å¦‚æœå·²ç™»å½•ç®¡ç†å‘˜ï¼Œå¯ç”¨æ‰€æœ‰åŠŸèƒ½
                if (appData.isAdmin) {
                    console.log('æ£€æµ‹åˆ°ç®¡ç†å‘˜çŠ¶æ€ï¼Œæ­£åœ¨å¯ç”¨æ‰€æœ‰åŠŸèƒ½...');
                    setTimeout(() => {
                        enableAdminFeatures();
                    }, 500);
                } else {
                    console.log('å½“å‰æœªä»¥ç®¡ç†å‘˜èº«ä»½ç™»å½•');
                }
                
                // ä¸“é—¨ä¸ºç™»å½•æŒ‰é’®æ·»åŠ äº‹ä»¶ç›‘å¬å™¨ï¼ˆå¤‡ç”¨æ–¹æ¡ˆï¼‰
                const loginBtn = document.getElementById('loginBtn');
                if (loginBtn) {
                    // ç§»é™¤å¯èƒ½å­˜åœ¨çš„äº‹ä»¶ç›‘å¬å™¨
                    loginBtn.replaceWith(loginBtn.cloneNode(true));
                    const newLoginBtn = document.getElementById('loginBtn');
                    
                    // æ·»åŠ æ–°çš„äº‹ä»¶ç›‘å¬å™¨
                    newLoginBtn.addEventListener('click', function(e) {
                        e.preventDefault();
                        e.stopPropagation();
                        console.log('Login button clicked via addEventListener');
                        toggleLogin();
                    });
                    
                    console.log('âœ… ç™»å½•æŒ‰é’®äº‹ä»¶ç›‘å¬å™¨å·²æ·»åŠ ');
                }
                
                // æ£€æŸ¥æ‰€æœ‰onclickåŠŸèƒ½
                document.querySelectorAll('[onclick]').forEach(element => {
                    console.log('âœ… æ£€æŸ¥onclickå…ƒç´ :', element);
                });
                
                // æ£€æŸ¥é«˜å¾·åœ°å›¾APIåŠ è½½çŠ¶æ€
                if (typeof AMap !== 'undefined') {
                    console.log('âœ… é«˜å¾·åœ°å›¾APIåŠ è½½æˆåŠŸ');
                    showToast('é«˜å¾·åœ°å›¾å·²å°±ç»ª', 'success');
                } else {
                    console.log('âš ï¸ é«˜å¾·åœ°å›¾APIæœªåŠ è½½ï¼Œå°†ä½¿ç”¨å¤‡ç”¨åœ°å›¾');
                }
                
                // å¼ºåˆ¶æ£€æŸ¥ç§»åŠ¨ç«¯å¯¼èˆªæ˜¾ç¤º
                setTimeout(() => {
                    if (window.innerWidth <= 768) {
                        const mobileNav = document.querySelector('.mobile-quick-nav');
                        if (mobileNav) {
                            console.log('ğŸ”§ å¼ºåˆ¶æ˜¾ç¤ºç§»åŠ¨ç«¯å¯¼èˆª');
                            mobileNav.style.display = 'flex';
                            mobileNav.style.visibility = 'visible';
                            mobileNav.style.opacity = '1';
                            mobileNav.style.position = 'fixed';
                            mobileNav.style.bottom = '0';
                            mobileNav.style.left = '0';
                            mobileNav.style.right = '0';
                            mobileNav.style.zIndex = '9999';
                            console.log('âœ… ç§»åŠ¨ç«¯å¯¼èˆªæ ·å¼å¼ºåˆ¶åº”ç”¨');
                        } else {
                            console.error('âŒ æ‰¾ä¸åˆ°ç§»åŠ¨ç«¯å¯¼èˆªå…ƒç´ ');
                        }
                    }
                }, 200);

                // å†æ¬¡å¼ºåˆ¶åº”ç”¨ç§»åŠ¨ç«¯å¯¼èˆªæ ·å¼
                setTimeout(() => {
                    const mobileNav = document.querySelector('.mobile-quick-nav');
                    if (mobileNav && window.innerWidth <= 768) {
                        mobileNav.style.cssText = `
                            display: flex !important;
                            visibility: visible !important;
                            opacity: 1 !important;
                            position: fixed !important;
                            bottom: 0 !important;
                            left: 0 !important;
                            right: 0 !important;
                            z-index: 9999 !important;
                            background: white !important;
                            border-top: 1px solid var(--apple-border) !important;
                            box-shadow: 0 -2px 10px rgba(0,0,0,0.1) !important;
                        `;
                        console.log('ğŸ”§ ç§»åŠ¨ç«¯å¯¼èˆªæœ€ç»ˆå¼ºåˆ¶åº”ç”¨');
                    }
                }, 500);
                
                // å†æ¬¡å¼ºåˆ¶åˆå§‹åŒ–é¡µé¢
                setTimeout(() => {
                    forceInitializePages();
                    console.log('ğŸ”§ æœ€ç»ˆé¡µé¢åˆå§‹åŒ–å®Œæˆ');
                }, 300);

                // æ˜¾ç¤ºæ¬¢è¿æ¶ˆæ¯
                setTimeout(() => {
                    showToast('ğŸ‰ æ¬¢è¿æ¥åˆ°é‡‘çŒ«ä¹‹å®¶ï¼', 'success');
                    console.log('ğŸ’¡ è°ƒè¯•å‘½ä»¤ï¼š');
                    console.log('- testPageSwitching() : æµ‹è¯•é¡µé¢åˆ‡æ¢');
                    console.log('- forceShowAllPages() : å¼ºåˆ¶æ˜¾ç¤ºæ‰€æœ‰é¡µé¢');
                    console.log('- checkPageContent("é¡µé¢ID") : æ£€æŸ¥æŒ‡å®šé¡µé¢å†…å®¹');
                }, 500);
                
            } catch (error) {
                console.error('âŒ åˆå§‹åŒ–é”™è¯¯:', error);
                showToast('é¡µé¢åŠ è½½å®Œæˆ', 'success');
            }
        });

            // é”™è¯¯å¤„ç†
            window.addEventListener('error', function(e) {
                console.error('å…¨å±€é”™è¯¯:', e.error);
            });

            // æ·»åŠ æµ‹è¯•å‡½æ•°
            window.testPageSwitching = function() {
                console.log('ğŸ§ª å¼€å§‹æµ‹è¯•é¡µé¢åˆ‡æ¢...');
                const pages = ['home', 'cats', 'hospital', 'logistics', 'forum', 'shop', 'profile'];
                let currentIndex = 0;
                
                function switchToNextPage() {
                    if (currentIndex < pages.length) {
                        const pageId = pages[currentIndex];
                        console.log(`ğŸ§ª æµ‹è¯•åˆ‡æ¢åˆ°: ${pageId}`);
                        showPage(pageId, null);
                        
                        currentIndex++;
                        setTimeout(switchToNextPage, 1500);
                    } else {
                        console.log('ğŸ§ª é¡µé¢åˆ‡æ¢æµ‹è¯•å®Œæˆ');
                        showToast('é¡µé¢åˆ‡æ¢æµ‹è¯•å®Œæˆï¼', 'success');
                    }
                }
                
                switchToNextPage();
            };

            // å¼ºåˆ¶æ˜¾ç¤ºæ‰€æœ‰é¡µé¢å†…å®¹ï¼ˆç”¨äºè°ƒè¯•ï¼‰
            window.forceShowAllPages = function() {
                console.log('ğŸ”§ å¼ºåˆ¶æ˜¾ç¤ºæ‰€æœ‰é¡µé¢å†…å®¹...');
                document.querySelectorAll('.page').forEach(page => {
                    page.style.display = 'block';
                    page.style.visibility = 'visible';
                    page.style.opacity = '1';
                    page.style.position = 'static';
                    page.style.height = 'auto';
                    console.log('âœ… å¼ºåˆ¶æ˜¾ç¤ºé¡µé¢:', page.id);
                });
            };

            // æ£€æŸ¥é¡µé¢å†…å®¹
            window.checkPageContent = function(pageId) {
                const page = document.getElementById(pageId);
                if (page) {
                    console.log(`ğŸ“„ æ£€æŸ¥é¡µé¢ ${pageId}:`);
                    console.log('- display:', page.style.display);
                    console.log('- visibility:', page.style.visibility);
                    console.log('- opacity:', page.style.opacity);
                    console.log('- å†…å®¹é•¿åº¦:', page.innerHTML.length);
                    console.log('- å­å…ƒç´ æ•°é‡:', page.children.length);
                    
                    // æ˜¾ç¤ºé¡µé¢å†…å®¹çš„å‰100ä¸ªå­—ç¬¦
                    const contentPreview = page.innerHTML.substring(0, 100);
                    console.log('- å†…å®¹é¢„è§ˆ:', contentPreview);
                } else {
                    console.error(`âŒ é¡µé¢ ${pageId} ä¸å­˜åœ¨`);
                }
            };

            // æ·»åŠ çª—å£å¤§å°å˜åŒ–ç›‘å¬
            window.addEventListener('resize', function() {
                console.log('ğŸ–¥ï¸ çª—å£å¤§å°å˜åŒ–:', window.innerWidth, 'x', window.innerHeight);
                
                // é‡æ–°åº”ç”¨ç§»åŠ¨ç«¯å¯¼èˆªæ ·å¼
                if (window.innerWidth <= 768) {
                    const mobileNav = document.querySelector('.mobile-quick-nav');
                    if (mobileNav) {
                        mobileNav.style.display = 'flex';
                        console.log('ğŸ“± ç§»åŠ¨ç«¯å¯¼èˆªå·²æ˜¾ç¤º');
                    }
                } else {
                    const mobileNav = document.querySelector('.mobile-quick-nav');
                    if (mobileNav) {
                        mobileNav.style.display = 'none';
                        console.log('ğŸ–¥ï¸ æ¡Œé¢ç«¯éšè—ç§»åŠ¨ç«¯å¯¼èˆª');
                    }
                }

                // å¼ºåˆ¶é‡æ–°åº”ç”¨æ ·å¼
                setTimeout(() => {
                    const mobileNav = document.querySelector('.mobile-quick-nav');
                    if (mobileNav && window.innerWidth <= 768) {
                        mobileNav.style.cssText = `
                            display: flex !important;
                            visibility: visible !important;
                            opacity: 1 !important;
                            position: fixed !important;
                            bottom: 0 !important;
                            left: 0 !important;
                            right: 0 !important;
                            z-index: 9999 !important;
                            background: white !important;
                            border-top: 1px solid var(--apple-border) !important;
                            box-shadow: 0 -2px 10px rgba(0,0,0,0.1) !important;
                            justify-content: space-around !important;
                            padding: 8px 0 !important;
                        `;
                    }
                }, 100);
            });

        // ç§»åŠ¨ç«¯å¯¼èˆªåˆ‡æ¢
        document.querySelector('.mobile-nav-toggle')?.addEventListener('click', function() {
            const navMenu = document.querySelector('.nav-menu');
            navMenu.style.display = navMenu.style.display === 'flex' ? 'none' : 'flex';
        });

        // ä¸ªäººä¸­å¿ƒç›¸å…³åŠŸèƒ½
        function showAddressManager(event) {
            if (event) event.preventDefault();
            showToast('åœ°å€ç®¡ç†åŠŸèƒ½å¼€å‘ä¸­...', 'info');
            // è¿™é‡Œå¯ä»¥æ·»åŠ åœ°å€ç®¡ç†æ¨¡æ€æ¡†
        }

        function showOrderManager(event) {
            if (event) event.preventDefault();
            showToast('è®¢å•ç®¡ç†åŠŸèƒ½å¼€å‘ä¸­...', 'info');
            // è¿™é‡Œå¯ä»¥æ·»åŠ è®¢å•ç®¡ç†æ¨¡æ€æ¡†
        }

        function showSettings(event) {
            if (event) event.preventDefault();
            showToast('è®¾ç½®åŠŸèƒ½å¼€å‘ä¸­...', 'info');
            // è¿™é‡Œå¯ä»¥æ·»åŠ è®¾ç½®æ¨¡æ€æ¡†
        }

        function showAbout(event) {
            if (event) event.preventDefault();
            showToast('é‡‘çŒ«ä¹‹å®¶ v1.0 - æ­å·è‡ªå®¶å°çŒ«å’ª-æå…ˆç”Ÿçš„å® ç‰©ç¤¾åŒºå¹³å°', 'info');
        }

        function showVersion(event) {
            if (event) event.preventDefault();
            showToast('ç‰ˆæœ¬ï¼š1.0.0 | æ›´æ–°æ—¶é—´ï¼š2024å¹´', 'info');
        }

        function checkAdminStatus(event) {
            if (event) event.preventDefault();
            const status = `
                å½“å‰ç”¨æˆ·: ${appData.currentUser || 'æœªç™»å½•'}
                ç™»å½•çŠ¶æ€: ${appData.isLoggedIn ? 'å·²ç™»å½•' : 'æœªç™»å½•'}
                ç®¡ç†å‘˜æƒé™: ${appData.isAdmin ? 'æ˜¯' : 'å¦'}
            `;
            console.log('=== å½“å‰çŠ¶æ€æ£€æŸ¥ ===');
            console.log(status);
            console.log('=== appData å®Œæ•´ä¿¡æ¯ ===');
            console.log(JSON.stringify(appData, null, 2));
            
            // æ˜¾ç¤ºè¯¦ç»†ä¿¡æ¯
            alert(status);
            
            // å¼ºåˆ¶é‡æ–°å¯ç”¨ç®¡ç†å‘˜åŠŸèƒ½
            if (appData.isAdmin) {
                console.log('æ£€æµ‹åˆ°ç®¡ç†å‘˜æƒé™ï¼Œæ­£åœ¨é‡æ–°å¯ç”¨æ‰€æœ‰åŠŸèƒ½...');
                enableAdminFeatures();
            } else {
                showToast('å½“å‰æœªä»¥ç®¡ç†å‘˜èº«ä»½ç™»å½•', 'info');
            }
        }

        // æ›´æ–°ç®¡ç†å‘˜èœå•æ˜¾ç¤º
        function updateProfileMenu() {
            const adminMenuItems = document.getElementById('adminMenuItems');
            const userName = document.getElementById('userName');
            
            if (appData.isAdmin) {
                if (adminMenuItems) adminMenuItems.style.display = 'block';
                if (userName) userName.textContent = 'ç®¡ç†å‘˜';
            } else {
                if (adminMenuItems) adminMenuItems.style.display = 'none';
                if (userName) userName.textContent = 'æ¸¸å®¢ç”¨æˆ·';
            }
        }

        // å•†åŸç®¡ç†åŠŸèƒ½
        function openShopManager() {
            document.getElementById('shopManagerModal').classList.add('active');
            // æ¸…ç©ºè¡¨å•
            document.getElementById('productName').value = '';
            document.getElementById('productPrice').value = '';
            document.getElementById('productPlatform').value = 'taobao';
            document.getElementById('productUrl').value = '';
            document.getElementById('productDescription').value = '';
        }

        function closeShopManager() {
            document.getElementById('shopManagerModal').classList.remove('active');
        }

        function saveProduct() {
            const name = document.getElementById('productName').value.trim();
            const category = document.getElementById('productCategory').value;
            const price = document.getElementById('productPrice').value.trim();
            const platform = document.getElementById('productPlatform').value;
            const url = document.getElementById('productUrl').value.trim();
            const icon = document.getElementById('productIcon').value;
            const description = document.getElementById('productDescription').value.trim();

            if (!name || !price || !url) {
                showToast('è¯·å¡«å†™å¿…è¦ä¿¡æ¯', 'error');
                return;
            }

            const product = {
                id: Date.now(),
                name: name,
                category: category,
                price: price,
                platform: platform,
                url: url,
                icon: icon,
                description: description || 'ä¼˜è´¨å® ç‰©ç”¨å“',
                addedBy: appData.currentUser,
                addedTime: new Date().toLocaleString(),
                clickCount: 0,
                lastClicked: null,
                viewCount: 0
            };

            // åˆå§‹åŒ–äº§å“æ•°ç»„
            if (!appData.products) {
                appData.products = [];
            }

            appData.products.push(product);
            renderProducts();
            closeShopManager();
            showToast('å•†å“æ·»åŠ æˆåŠŸï¼', 'success');
        }

        // æ¸²æŸ“å•†å“åˆ—è¡¨ - æŒ‰åˆ†ç±»æ˜¾ç¤º
        function renderProducts() {
            const categories = ['food', 'toys', 'supplies', 'grooming', 'health'];
            
            // æ¸²æŸ“å„åˆ†ç±»å•†å“
            categories.forEach(category => {
                const container = document.querySelector(`[data-category="${category}"] .product-grid`);
                if (!container) return;
                
                const categoryProducts = appData.products ? appData.products.filter(p => p.category === category) : [];
                
                if (categoryProducts.length === 0) {
                    container.innerHTML = `
                        <div style="grid-column: 1 / -1; text-align: center; padding: 20px; color: var(--apple-gray-medium);">
                            <p>æš‚æ— ${getCategoryName(category)}å•†å“</p>
                        </div>
                    `;
                    return;
                }
                
                container.innerHTML = categoryProducts.map(product => {
                    const platformText = {
                        'taobao': 'æ·˜å®',
                        'pinduoduo': 'æ‹¼å¤šå¤š',
                        'jd': 'äº¬ä¸œ'
                    }[product.platform] || 'è´­ä¹°';

                    const clickCount = product.clickCount || 0;

                    return `
                        <div class="card">
                            <div style="padding: var(--spacing-md); text-align: center;">
                                <div style="font-size: 36px; margin-bottom: var(--spacing-sm);">${product.icon}</div>
                                <h4 style="font-size: 16px; margin-bottom: 8px;">${product.name}</h4>
                                <p style="color: var(--apple-orange); font-weight: 600; font-size: 18px;">Â¥${product.price}</p>
                                <div style="display: flex; justify-content: space-between; align-items: center; margin: 8px 0;">
                                    <span style="color: var(--apple-gray-medium); font-size: 11px;">ğŸ”¥ ${clickCount} æ¬¡ç‚¹å‡»</span>
                                    ${appData.isAdmin ? `
                                        <button class="btn btn-secondary btn-small" onclick="editProductStats(${product.id})" style="font-size: 10px; padding: 2px 6px;">ğŸ“Š</button>
                                    ` : ''}
                                </div>
                                ${product.description ? `<p style="color: var(--apple-gray-medium); font-size: 12px; margin: 8px 0;">${product.description}</p>` : ''}
                                <button class="btn btn-primary" onclick="openProductUrl('${product.url}', '${product.platform}', ${product.id})" style="font-size: 12px; padding: 8px 16px;">ğŸ›’ ${platformText}</button>
                                ${appData.isAdmin ? `
                                    <div style="margin-top: 8px;">
                                        <button class="btn btn-secondary btn-small" onclick="deleteProduct(${product.id})" style="font-size: 11px; padding: 4px 8px;">åˆ é™¤</button>
                                    </div>
                                ` : ''}
                            </div>
                        </div>
                    `;
                }).join('');
            });

            // æ¸²æŸ“ç²¾é€‰å•†å“åŒºåŸŸ - æ˜¾ç¤ºæ‰€æœ‰ç®¡ç†å‘˜æ·»åŠ çš„å•†å“
            renderFeaturedProducts();
        }

        // æ¸²æŸ“ç²¾é€‰å•†å“
        function renderFeaturedProducts() {
            const container = document.getElementById('recommendedProducts');
            if (!container) return;
            
            const allProducts = appData.products || [];
            
            if (allProducts.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 40px; color: var(--apple-gray-medium);">
                        <div style="font-size: 48px; margin-bottom: var(--spacing-sm);">ğŸ›ï¸</div>
                        <p>æš‚æ— å•†å“ï¼Œè¯·è”ç³»ç®¡ç†å‘˜æ·»åŠ </p>
                    </div>
                `;
                return;
            }
            
            // æŒ‰ç‚¹å‡»é¢‘ç‡æ’åºï¼Œç‚¹å‡»æ¬¡æ•°ç›¸åŒåˆ™æŒ‰æ·»åŠ æ—¶é—´å€’åº
            const sortedProducts = allProducts.sort((a, b) => {
                const aClicks = a.clickCount || 0;
                const bClicks = b.clickCount || 0;
                if (aClicks !== bClicks) {
                    return bClicks - aClicks; // ç‚¹å‡»æ¬¡æ•°å¤šçš„æ’å‰é¢
                }
                return b.id - a.id; // ç‚¹å‡»æ¬¡æ•°ç›¸åŒï¼ŒæŒ‰æ·»åŠ æ—¶é—´å€’åº
            });
            
            container.innerHTML = sortedProducts.slice(0, 9).map((product, index) => {
                const platformText = {
                    'taobao': 'æ·˜å®',
                    'pinduoduo': 'æ‹¼å¤šå¤š',
                    'jd': 'äº¬ä¸œ'
                }[product.platform] || 'è´­ä¹°';

                const categoryBadge = {
                    'food': 'ğŸ¥« ç²®é£Ÿ',
                    'toys': 'ğŸ§¶ ç©å…·',
                    'supplies': 'ğŸ§¼ ç”¨å“',
                    'grooming': 'ğŸ§´ ç¾å®¹',
                    'health': 'ğŸ’Š ä¿å¥'
                }[product.category] || 'ğŸ“¦ å…¶ä»–';

                // æ’è¡Œå¾½ç« 
                const rankBadge = index < 3 ? ['ğŸ¥‡', 'ğŸ¥ˆ', 'ğŸ¥‰'][index] : `#${index + 1}`;
                const clickCount = product.clickCount || 0;

                return `
                    <div class="card" style="position: relative;">
                        <div style="padding: var(--spacing-md); text-align: center;">
                            <div style="position: absolute; top: 8px; left: 8px; background: ${index < 3 ? 'var(--apple-orange)' : 'var(--apple-gray-medium)'}; color: white; font-size: 12px; padding: 2px 6px; border-radius: 10px; font-weight: bold;">
                                ${rankBadge}
                            </div>
                            <div style="position: absolute; top: 8px; right: 8px; background: var(--cat-primary); color: white; font-size: 10px; padding: 2px 6px; border-radius: 10px;">
                                ${categoryBadge}
                            </div>
                            <div style="font-size: 36px; margin-bottom: var(--spacing-sm);">${product.icon}</div>
                            <h4 style="font-size: 16px; margin-bottom: 8px;">${product.name}</h4>
                            <p style="color: var(--apple-orange); font-weight: 600; font-size: 18px;">Â¥${product.price}</p>
                            <div style="display: flex; justify-content: space-between; align-items: center; margin: 8px 0;">
                                <span style="color: var(--apple-gray-medium); font-size: 11px;">ğŸ”¥ ç‚¹å‡» ${clickCount} æ¬¡</span>
                                ${appData.isAdmin ? `
                                    <button class="btn btn-secondary btn-small" onclick="editProductStats(${product.id})" style="font-size: 10px; padding: 2px 6px;">ğŸ“Š</button>
                                ` : ''}
                            </div>
                            ${product.description ? `<p style="color: var(--apple-gray-medium); font-size: 12px; margin: 8px 0;">${product.description}</p>` : ''}
                            <button class="btn btn-primary" onclick="openProductUrl('${product.url}', '${product.platform}', ${product.id})" style="font-size: 12px; padding: 8px 16px;">ğŸ›’ ${platformText}</button>
                            ${appData.isAdmin ? `
                                <div style="margin-top: 8px;">
                                    <button class="btn btn-secondary btn-small" onclick="deleteProduct(${product.id})" style="font-size: 11px; padding: 4px 8px;">åˆ é™¤</button>
                                </div>
                            ` : ''}
                        </div>
                    </div>
                `;
            }).join('');
        }

        // è·å–åˆ†ç±»åç§°
        function getCategoryName(category) {
            const names = {
                'food': 'çŒ«ç²®ä¸»é£Ÿ',
                'toys': 'ç©å…·ç”¨å“',
                'supplies': 'æ—¥å¸¸ç”¨å“',
                'grooming': 'æ´—æŠ¤ç¾å®¹',
                'health': 'å¥åº·ä¿å¥'
            };
            return names[category] || 'å•†å“';
        }

        // æ‰“å¼€å•†å“é“¾æ¥
        function openProductUrl(url, platform, productId) {
            // ç»Ÿè®¡å•†å“ç‚¹å‡»
            if (productId) {
                const product = appData.products.find(p => p.id === productId);
                if (product) {
                    product.clickCount = (product.clickCount || 0) + 1;
                    product.lastClicked = new Date().toLocaleString();
                    console.log(`å•†å“ ${product.name} ç‚¹å‡»æ¬¡æ•°: ${product.clickCount}`);
                    
                    // å¦‚æœæ˜¯ç®¡ç†å‘˜ï¼Œæ˜¾ç¤ºç‚¹å‡»ç»Ÿè®¡
                    if (appData.isAdmin) {
                        showToast(`å•†å“ç‚¹å‡»: ${product.clickCount} æ¬¡`, 'info');
                    }
                }
            }
            
            const isMobile = isMobileDevice();
            
            if (isMobile) {
                // ç§»åŠ¨ç«¯ç›´æ¥è·³è½¬
                if (platform === 'taobao') {
                    // å°è¯•æ‰“å¼€æ·˜å®APP
                    const taobaoAppUrl = url.includes('taobao.com') ? url.replace(/^(https?:\/\/)?(m\.)?taobao\.com/, 'taobao://item.taobao.com') : url;
                    window.location.href = taobaoAppUrl;
                    
                    // å»¶è¿Ÿè·³è½¬ç½‘é¡µç‰ˆ
                    setTimeout(() => {
                        window.open(url, '_blank');
                    }, 1000);
                } else if (platform === 'pinduoduo') {
                    // å°è¯•æ‰“å¼€æ‹¼å¤šå¤šAPP
                    const pddAppUrl = url.includes('yangkeduo.com') || url.includes('pinduoduo.com') ? url.replace(/^(https?:\/\/)?(mobile\.)?(yangkeduo|pinduoduo)\.com/, 'pdd://') : url;
                    window.location.href = pddAppUrl;
                    
                    // å»¶è¿Ÿè·³è½¬ç½‘é¡µç‰ˆ
                    setTimeout(() => {
                        window.open(url, '_blank');
                    }, 1000);
                } else if (platform === 'jd') {
                    // å°è¯•æ‰“å¼€äº¬ä¸œAPP
                    const jdAppUrl = url.includes('jd.com') ? url.replace(/^(https?:\/\/)?(m\.)?jd\.com/, 'openapp.jdmobile://virtual?params=') : url;
                    window.location.href = jdAppUrl;
                    
                    // å»¶è¿Ÿè·³è½¬ç½‘é¡µç‰ˆ
                    setTimeout(() => {
                        window.open(url, '_blank');
                    }, 1000);
                } else {
                    window.open(url, '_blank');
                }
            } else {
                // PCç«¯ç›´æ¥åœ¨æ–°æ ‡ç­¾é¡µæ‰“å¼€
                window.open(url, '_blank');
            }
        }

        // åˆ é™¤å•†å“
        function deleteProduct(productId) {
            if (confirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªå•†å“å—ï¼Ÿ')) {
                const index = appData.products.findIndex(p => p.id === productId);
                if (index > -1) {
                    appData.products.splice(index, 1);
                    renderProducts();
                    showToast('å•†å“åˆ é™¤æˆåŠŸ', 'success');
                }
            }
        }

        // ç¼–è¾‘å•†å“ç»Ÿè®¡æ•°æ®
        function editProductStats(productId) {
            const product = appData.products.find(p => p.id === productId);
            if (!product) return;

            const newClickCount = prompt(`ä¿®æ”¹ "${product.name}" çš„ç‚¹å‡»æ¬¡æ•°:\nå½“å‰ç‚¹å‡»æ¬¡æ•°: ${product.clickCount || 0}`, product.clickCount || 0);
            
            if (newClickCount !== null) {
                const count = parseInt(newClickCount);
                if (!isNaN(count) && count >= 0) {
                    product.clickCount = count;
                    product.lastClicked = new Date().toLocaleString();
                    renderProducts();
                    showToast('ç»Ÿè®¡æ•°æ®æ›´æ–°æˆåŠŸ', 'success');
                } else {
                    showToast('è¯·è¾“å…¥æœ‰æ•ˆçš„æ•°å­—', 'error');
                }
            }
        }

        // åŒ»é™¢æ¨èåŠŸèƒ½
        function openHospitalRecommendation() {
            document.getElementById('hospitalRecommendationModal').classList.add('active');
            // æ¸…ç©ºè¡¨å•
            document.getElementById('recommendHospitalName').value = '';
            document.getElementById('recommendHospitalAddress').value = '';
            document.getElementById('recommendHospitalPhone').value = '';
            document.getElementById('recommendHospitalReason').value = '';
            document.getElementById('recommendHospitalUser').value = appData.userProfile?.name || '';
        }

        function closeHospitalRecommendationModal() {
            document.getElementById('hospitalRecommendationModal').classList.remove('active');
        }

        function submitHospitalRecommendation() {
            const name = document.getElementById('recommendHospitalName').value.trim();
            const address = document.getElementById('recommendHospitalAddress').value.trim();
            const phone = document.getElementById('recommendHospitalPhone').value.trim();
            const reason = document.getElementById('recommendHospitalReason').value.trim();
            const userName = document.getElementById('recommendHospitalUser').value.trim() || 'åŒ¿åç”¨æˆ·';

            if (!name || !address) {
                showToast('è¯·å¡«å†™åŒ»é™¢åç§°å’Œè¯¦ç»†åœ°å€', 'error');
                return;
            }

            const recommendation = {
                id: Date.now(),
                name: name,
                address: address,
                phone: phone || 'æš‚æ— ',
                reason: reason || 'ç”¨æˆ·æ¨è',
                userName: userName,
                userProfile: appData.userProfile,
                recommendedTime: new Date().toLocaleString(),
                status: 'pending', // pending, approved, rejected
                likeCount: 0,
                dislikeCount: 0
            };

            // åˆå§‹åŒ–ç”¨æˆ·æ¨èåŒ»é™¢æ•°ç»„
            if (!appData.userRecommendedHospitals) {
                appData.userRecommendedHospitals = [];
            }

            appData.userRecommendedHospitals.push(recommendation);
            renderUserRecommendedHospitals();
            closeHospitalRecommendationModal();
            showToast('åŒ»é™¢æ¨èæäº¤æˆåŠŸï¼æ„Ÿè°¢æ‚¨çš„åˆ†äº«ï¼', 'success');
        }

        // æ¸²æŸ“ç”¨æˆ·æ¨èåŒ»é™¢
        function renderUserRecommendedHospitals() {
            const container = document.getElementById('userRecommendedHospitals');
            if (!container) return;

            const recommendations = appData.userRecommendedHospitals || [];

            if (recommendations.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 40px; color: var(--apple-gray-medium);">
                        <div style="font-size: 48px; margin-bottom: var(--spacing-sm);">ğŸ¥</div>
                        <p>æš‚æ— ç”¨æˆ·æ¨èåŒ»é™¢</p>
                        <p style="font-size: 14px; margin-top: var(--spacing-sm);">æ¬¢è¿åˆ†äº«æ‚¨çŸ¥é“çš„å¥½åŒ»é™¢</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = recommendations.map(recommendation => {
                const statusBadge = {
                    'pending': 'â³ å¾…å®¡æ ¸',
                    'approved': 'âœ… å·²é€šè¿‡',
                    'rejected': 'âŒ å·²æ‹’ç»'
                }[recommendation.status] || 'â³ å¾…å®¡æ ¸';

                const statusColor = {
                    'pending': 'var(--apple-orange)',
                    'approved': 'var(--apple-green)',
                    'rejected': 'var(--apple-red)'
                }[recommendation.status] || 'var(--apple-orange)';

                return `
                    <div class="card">
                        <div style="padding: var(--spacing-md);">
                            <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: var(--spacing-sm);">
                                <div style="flex: 1;">
                                    <h4 style="margin-bottom: 4px;">ğŸ¥ ${recommendation.name}</h4>
                                    <p style="color: var(--apple-gray-medium); font-size: 14px; margin-bottom: 4px;">ğŸ“ ${recommendation.address}</p>
                                    <p style="color: var(--apple-gray-medium); font-size: 14px; margin-bottom: 4px;">ğŸ“ ${recommendation.phone}</p>
                                </div>
                                <span style="background: ${statusColor}; color: white; font-size: 10px; padding: 2px 6px; border-radius: 10px;">
                                    ${statusBadge}
                                </span>
                            </div>
                            
                            <p style="color: var(--apple-gray-dark); font-size: 14px; margin-bottom: var(--spacing-sm);">ğŸ’¬ ${recommendation.reason}</p>
                            
                            <div style="display: flex; justify-content: space-between; align-items: center; padding-top: var(--spacing-sm); border-top: 1px solid var(--apple-border);">
                                <div style="font-size: 12px; color: var(--apple-gray-medium);">
                                    ğŸ‘¤ ${recommendation.userName} Â· ${recommendation.recommendedTime}
                                </div>
                                <div style="display: flex; gap: var(--spacing-sm);">
                                    ${recommendation.status === 'approved' ? `
                                        <button class="btn btn-primary btn-small" onclick="navigateToHospital('${recommendation.address}', '${recommendation.name}')">ğŸ§­ å¯¼èˆª</button>
                                    ` : ''}
                                    ${appData.isAdmin ? `
                                        <button class="btn btn-secondary btn-small" onclick="approveRecommendation(${recommendation.id})">âœ…</button>
                                        <button class="btn btn-secondary btn-small" onclick="rejectRecommendation(${recommendation.id})">âŒ</button>
                                        <button class="btn btn-secondary btn-small" onclick="deleteRecommendation(${recommendation.id})">ğŸ—‘ï¸</button>
                                    ` : `
                                        <div style="display: flex; gap: 4px;">
                                            <button class="btn btn-small" onclick="likeRecommendation(${recommendation.id})">ğŸ‘ ${recommendation.likeCount}</button>
                                            <button class="btn btn-small" onclick="dislikeRecommendation(${recommendation.id})">ğŸ‘ ${recommendation.dislikeCount}</button>
                                        </div>
                                    `}
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // é«˜å¾·å¯¼èˆªåŠŸèƒ½
        function openGaodeNavigation() {
            const destination = document.getElementById('gaodeDestination').value.trim();
            
            if (!destination) {
                showToast('è¯·è¾“å…¥åŒ»é™¢åœ°å€', 'warning');
                return;
            }
            
            showToast('æ­£åœ¨æ‰“å¼€é«˜å¾·åœ°å›¾å¯¼èˆª...', 'info');
            
            // æ„å»ºé«˜å¾·åœ°å›¾å¯¼èˆªURL
            const gaodeUrl = `https://uri.amap.com/navigation?to=${encodeURIComponent(destination)},åŒ»é™¢&mode=car`;
            
            setTimeout(() => {
                window.open(gaodeUrl, '_blank');
            }, 500);
        }

        // å¯¼èˆªåˆ°åŒ»é™¢
        function navigateToHospital(address, hospitalName) {
            showToast(`æ­£åœ¨æ‰“å¼€é«˜å¾·åœ°å›¾å¯¼èˆªåˆ° ${hospitalName}...`, 'info');
            
            // æ„å»ºé«˜å¾·åœ°å›¾å¯¼èˆªURL
            const gaodeUrl = `https://uri.amap.com/navigation?to=${encodeURIComponent(address)},${encodeURIComponent(hospitalName)}&mode=car`;
            
            setTimeout(() => {
                window.open(gaodeUrl, '_blank');
            }, 500);
        }

        // ç®¡ç†å‘˜åŠŸèƒ½
        function approveRecommendation(recommendationId) {
            const recommendation = appData.userRecommendedHospitals.find(r => r.id === recommendationId);
            if (recommendation) {
                recommendation.status = 'approved';
                renderUserRecommendedHospitals();
                showToast('æ¨èå·²é€šè¿‡å®¡æ ¸', 'success');
            }
        }

        function rejectRecommendation(recommendationId) {
            const recommendation = appData.userRecommendedHospitals.find(r => r.id === recommendationId);
            if (recommendation) {
                recommendation.status = 'rejected';
                renderUserRecommendedHospitals();
                showToast('æ¨èå·²æ‹’ç»', 'info');
            }
        }

        function deleteRecommendation(recommendationId) {
            if (confirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªæ¨èå—ï¼Ÿ')) {
                appData.userRecommendedHospitals = appData.userRecommendedHospitals.filter(r => r.id !== recommendationId);
                renderUserRecommendedHospitals();
                showToast('æ¨èå·²åˆ é™¤', 'success');
            }
        }

        // ç”¨æˆ·ç‚¹èµåŠŸèƒ½
        function likeRecommendation(recommendationId) {
            const recommendation = appData.userRecommendedHospitals.find(r => r.id === recommendationId);
            if (recommendation) {
                recommendation.likeCount = (recommendation.likeCount || 0) + 1;
                renderUserRecommendedHospitals();
            }
        }

        function dislikeRecommendation(recommendationId) {
            const recommendation = appData.userRecommendedHospitals.find(r => r.id === recommendationId);
            if (recommendation) {
                recommendation.dislikeCount = (recommendation.dislikeCount || 0) + 1;
                renderUserRecommendedHospitals();
            }
        }

        // åŒ»é™¢ç®¡ç†åŠŸèƒ½
        // å¡«å……å½“å‰åŸå¸‚åœ°å€ç¤ºä¾‹
        function fillCurrentCityAddress() {
            if (!appData.currentLocation) {
                showToast('è¯·å…ˆå®šä½å½“å‰ä½ç½®', 'error');
                return;
            }
            
            const cityName = getCityByLocation(appData.currentLocation.lat, appData.currentLocation.lng);
            let districts, sampleAddress;
            
            if (cityName === 'åŒ—äº¬') {
                districts = ['æœé˜³åŒº', 'æµ·æ·€åŒº', 'ä¸œåŸåŒº', 'è¥¿åŸåŒº'];
                sampleAddress = `${cityName}${districts[Math.floor(Math.random() * districts.length)]}è¡—é“${Math.floor(Math.random() * 999) + 1}å·`;
            } else if (cityName === 'ä¸Šæµ·') {
                districts = ['æµ¦ä¸œæ–°åŒº', 'é»„æµ¦åŒº', 'å¾æ±‡åŒº', 'é™å®‰åŒº'];
                sampleAddress = `${cityName}${districts[Math.floor(Math.random() * districts.length)]}è·¯${Math.floor(Math.random() * 999) + 1}å·`;
            } else if (cityName === 'æ·±åœ³') {
                districts = ['ç¦ç”°åŒº', 'å—å±±åŒº', 'ç½—æ¹–åŒº', 'å®å®‰åŒº'];
                sampleAddress = `${cityName}${districts[Math.floor(Math.random() * districts.length)]}å¤§é“${Math.floor(Math.random() * 999) + 1}å·`;
            } else if (cityName === 'è‹å·') {
                districts = ['å§‘è‹åŒº', 'è™ä¸˜åŒº', 'å´ä¸­åŒº', 'ç›¸åŸåŒº'];
                sampleAddress = `${cityName}${districts[Math.floor(Math.random() * districts.length)]}è¡—${Math.floor(Math.random() * 999) + 1}å·`;
            } else if (cityName === 'æ­å·') {
                districts = ['è¥¿æ¹–åŒº', 'æ‹±å¢…åŒº', 'æ»¨æ±ŸåŒº', 'ä¸ŠåŸåŒº'];
                sampleAddress = `${cityName}${districts[Math.floor(Math.random() * districts.length)]}è·¯${Math.floor(Math.random() * 999) + 1}å·`;
            } else {
                sampleAddress = `${cityName}ä¸­å¿ƒåŒºè¡—é“${Math.floor(Math.random() * 999) + 1}å·`;
            }
            
            document.getElementById('hospitalAddress').value = sampleAddress;
            
            // è®¾ç½®å¯¹åº”çš„ç”µè¯åŒºå·
            let phonePrefix = '0571'; // é»˜è®¤æ­å·
            if (cityName === 'åŒ—äº¬') phonePrefix = '010';
            else if (cityName === 'ä¸Šæµ·') phonePrefix = '021';
            else if (cityName === 'æ·±åœ³') phonePrefix = '0755';
            else if (cityName === 'è‹å·') phonePrefix = '0512';
            else if (cityName === 'æ­å·') phonePrefix = '0571';
            
            document.getElementById('hospitalPhone').value = `${phonePrefix}-${Math.floor(Math.random() * 90000000) + 10000000}`;
            
            showToast(`å·²å¡«å……${cityName}åœ°å€ç¤ºä¾‹`, 'success');
        }

        // å›¾ç‰‡æŸ¥çœ‹å™¨åŠŸèƒ½
        let currentImageUrl = '';

        function openImageViewer(imageUrl, postId) {
            currentImageUrl = imageUrl;
            const modal = document.getElementById('imageViewerModal');
            const viewerImage = document.getElementById('viewerImage');
            
            viewerImage.src = imageUrl;
            modal.classList.add('active');
            
            // é˜»æ­¢èƒŒæ™¯æ»šåŠ¨
            document.body.style.overflow = 'hidden';
        }

        function closeImageViewer(event) {
            // å¦‚æœç‚¹å‡»çš„æ˜¯èƒŒæ™¯æˆ–å…³é—­æŒ‰é’®ï¼Œåˆ™å…³é—­
            if (!event || event.target.id === 'imageViewerModal' || event.target.tagName === 'BUTTON') {
                const modal = document.getElementById('imageViewerModal');
                modal.classList.remove('active');
                
                // æ¢å¤èƒŒæ™¯æ»šåŠ¨
                document.body.style.overflow = '';
                
                // æ¸…ç©ºå›¾ç‰‡src
                document.getElementById('viewerImage').src = '';
                currentImageUrl = '';
            }
        }

        function downloadImage() {
            if (!currentImageUrl) return;
            
            const link = document.createElement('a');
            link.href = currentImageUrl;
            link.download = 'çŒ«å’ªå›¾ç‰‡_' + Date.now() + '.jpg';
            link.target = '_blank';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            showToast('å›¾ç‰‡ä¸‹è½½å·²å¼€å§‹', 'success');
        }

        function shareImage() {
            if (!currentImageUrl) return;
            
            // å¤åˆ¶å›¾ç‰‡é“¾æ¥åˆ°å‰ªè´´æ¿
            navigator.clipboard.writeText(currentImageUrl).then(() => {
                showToast('å›¾ç‰‡é“¾æ¥å·²å¤åˆ¶åˆ°å‰ªè´´æ¿', 'success');
            }).catch(() => {
                // é™çº§æ–¹æ¡ˆ
                const textArea = document.createElement('textarea');
                textArea.value = currentImageUrl;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                showToast('å›¾ç‰‡é“¾æ¥å·²å¤åˆ¶åˆ°å‰ªè´´æ¿', 'success');
            });
        }

        // å¢å¼ºçš„å¤åˆ¶ç²˜è´´åŠŸèƒ½
        async function copyToClipboardAdvanced(text) {
            try {
                if (navigator.clipboard && window.isSecureContext) {
                    await navigator.clipboard.writeText(text);
                    showToast('å·²å¤åˆ¶åˆ°å‰ªè´´æ¿', 'success');
                } else {
                    const textArea = document.createElement('textarea');
                    textArea.value = text;
                    document.body.appendChild(textArea);
                    textArea.select();
                    document.execCommand('copy');
                    document.body.removeChild(textArea);
                    showToast('å·²å¤åˆ¶åˆ°å‰ªè´´æ¿', 'success');
                }
            } catch (err) {
                console.error('å¤åˆ¶å¤±è´¥:', err);
                showToast('å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶', 'error');
            }
        }

        // ä»å‰ªè´´æ¿ç²˜è´´
        async function pasteFromClipboard(inputElement) {
            try {
                if (navigator.clipboard && window.isSecureContext) {
                    const text = await navigator.clipboard.readText();
                    if (text) {
                        inputElement.value = text;
                        showToast('å·²ç²˜è´´å†…å®¹', 'success');
                    }
                } else {
                    showToast('æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒè‡ªåŠ¨ç²˜è´´ï¼Œè¯·ä½¿ç”¨Ctrl+V', 'info');
                }
            } catch (err) {
                showToast('ç²˜è´´å¤±è´¥ï¼Œè¯·ä½¿ç”¨Ctrl+V', 'info');
            }
        }

        // ä¸ºè¾“å…¥æ¡†æ·»åŠ å¤åˆ¶ç²˜è´´æŒ‰é’®
        function addCopyPasteButtons(inputElement) {
            const wrapper = document.createElement('div');
            wrapper.className = 'input-wrapper';
            
            inputElement.parentNode.insertBefore(wrapper, inputElement);
            wrapper.appendChild(inputElement);
            
            // å¤åˆ¶æŒ‰é’®
            const copyBtn = document.createElement('button');
            copyBtn.className = 'input-copy-btn';
            copyBtn.innerHTML = 'ğŸ“‹';
            copyBtn.title = 'å¤åˆ¶å†…å®¹';
            copyBtn.onclick = (e) => {
                e.stopPropagation();
                if (inputElement.value) {
                    copyToClipboardAdvanced(inputElement.value);
                } else {
                    showToast('æ²¡æœ‰å†…å®¹å¯å¤åˆ¶', 'info');
                }
            };
            
            // ç²˜è´´æŒ‰é’®
            const pasteBtn = document.createElement('button');
            pasteBtn.className = 'input-paste-btn';
            pasteBtn.innerHTML = 'ğŸ“„';
            pasteBtn.title = 'ç²˜è´´å†…å®¹';
            pasteBtn.onclick = (e) => {
                e.stopPropagation();
                pasteFromClipboard(inputElement);
            };
            
            wrapper.appendChild(copyBtn);
            wrapper.appendChild(pasteBtn);
            
            // æ·»åŠ é”®ç›˜å¿«æ·é”®æ”¯æŒ
            inputElement.addEventListener('keydown', (e) => {
                if (e.ctrlKey || e.metaKey) {
                    if (e.key === 'v') {
                        e.preventDefault();
                        pasteFromClipboard(inputElement);
                    } else if (e.key === 'c' && inputElement.value) {
                        e.preventDefault();
                        copyToClipboardAdvanced(inputElement.value);
                    }
                }
            });
        }

        // åˆå§‹åŒ–æ‰€æœ‰è¾“å…¥æ¡†çš„å¤åˆ¶ç²˜è´´åŠŸèƒ½
        function initializeCopyPaste() {
            const inputs = document.querySelectorAll('.input[type="text"], .input[type="number"], textarea, .input:not([type])');
            inputs.forEach(input => {
                // è·³è¿‡å·²æœ‰åŒ…è£…å™¨çš„è¾“å…¥æ¡†
                if (input.closest('.input-wrapper')) return;
                
                // è·³è¿‡ç‰¹æ®Šç”¨é€”çš„è¾“å…¥æ¡†
                if (input.id && (
                    input.id.includes('tracking') || 
                    input.id.includes('search') ||
                    input.closest('.modal') && !input.id.includes('Name') && !input.id.includes('Address') && !input.id.includes('Description')
                )) return;
                
                addCopyPasteButtons(input);
            });
        }

        // å¢å¼ºç‰ˆå¤åˆ¶åˆ°å‰ªè´´æ¿
        function copyToClipboardAdvanced(text) {
            if (navigator.clipboard && window.isSecureContext) {
                navigator.clipboard.writeText(text).then(() => {
                    showToast('å·²å¤åˆ¶åˆ°å‰ªè´´æ¿', 'success');
                }).catch(() => {
                    fallbackCopy(text);
                });
            } else {
                fallbackCopy(text);
            }
        }

        // å¤‡ç”¨å¤åˆ¶æ–¹æ³•
        function fallbackCopy(text) {
            const textarea = document.createElement('textarea');
            textarea.value = text;
            textarea.style.position = 'fixed';
            textarea.style.left = '-999999px';
            textarea.style.top = '-999999px';
            document.body.appendChild(textarea);
            textarea.focus();
            textarea.select();
            
            try {
                document.execCommand('copy');
                showToast('å·²å¤åˆ¶åˆ°å‰ªè´´æ¿', 'success');
            } catch (err) {
                showToast('å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨é€‰æ‹©å¤åˆ¶', 'error');
            }
            
            document.body.removeChild(textarea);
        }

        // é”®ç›˜äº‹ä»¶ï¼šESCå…³é—­å›¾ç‰‡æŸ¥çœ‹å™¨
        document.addEventListener('keydown', function(event) {
            if (event.key === 'Escape' && document.getElementById('imageViewerModal').classList.contains('active')) {
                closeImageViewer();
            }
        });

        // ç”¨æˆ·èµ„æ–™ç®¡ç†åŠŸèƒ½
        let selectedAvatar = 'ğŸ˜º';

        function openUserProfile() {
            const modal = document.getElementById('userProfileModal');
            modal.classList.add('active');
            
            // åŠ è½½å½“å‰ç”¨æˆ·èµ„æ–™
            if (appData.userProfile) {
                document.getElementById('profileUserName').value = appData.userProfile.userName || '';
                document.getElementById('profileBio').value = appData.userProfile.bio || '';
                selectAvatar(appData.userProfile.avatar || 'ğŸ˜º');
            } else {
                document.getElementById('profileUserName').value = '';
                document.getElementById('profileBio').value = '';
                selectAvatar('ğŸ˜º');
            }
            
            // é˜»æ­¢èƒŒæ™¯æ»šåŠ¨
            document.body.style.overflow = 'hidden';
        }

        function closeUserProfile() {
            const modal = document.getElementById('userProfileModal');
            modal.classList.remove('active');
            
            // æ¢å¤èƒŒæ™¯æ»šåŠ¨
            document.body.style.overflow = '';
        }

        function selectAvatar(avatar) {
            selectedAvatar = avatar;
            document.getElementById('currentAvatar').textContent = avatar;
            
            // æ›´æ–°é€‰ä¸­çŠ¶æ€
            document.querySelectorAll('.avatar-option').forEach(option => {
                option.classList.remove('selected');
                if (option.dataset.avatar === avatar) {
                    option.classList.add('selected');
                }
            });
        }

        function saveUserProfile() {
            const userName = document.getElementById('profileUserName').value.trim();
            const bio = document.getElementById('profileBio').value.trim();
            
            if (!userName) {
                showToast('è¯·è¾“å…¥ç”¨æˆ·å', 'error');
                return;
            }
            
            // ä¿å­˜ç”¨æˆ·èµ„æ–™
            appData.userProfile = {
                userName: userName,
                avatar: selectedAvatar,
                bio: bio,
                createdAt: appData.userProfile?.createdAt || new Date().toISOString(),
                updatedAt: new Date().toISOString()
            };
            
            // ä¿å­˜åˆ°localStorage
            localStorage.setItem('userProfile', JSON.stringify(appData.userProfile));
            
            // æ›´æ–°ç•Œé¢æ˜¾ç¤º
            updateUserDisplay();
            
            // å…³é—­æ¨¡æ€æ¡†
            closeUserProfile();
            
            showToast('ä¸ªäººèµ„æ–™ä¿å­˜æˆåŠŸï¼', 'success');
        }

        function updateUserDisplay() {
            if (appData.userProfile) {
                // æ›´æ–°ç”¨æˆ·å
                document.getElementById('userName').textContent = appData.userProfile.userName;
                
                // æ›´æ–°å¤´åƒ
                const avatarElement = document.getElementById('userAvatar');
                avatarElement.textContent = appData.userProfile.avatar;
                avatarElement.style.background = 'linear-gradient(135deg, var(--apple-blue), var(--apple-purple))';
                
                // æ›´æ–°çŠ¶æ€æ–‡æœ¬
                const statusText = appData.userProfile.bio || 'æ¬¢è¿æ¥åˆ°é‡‘çŒ«ä¹‹å®¶';
                document.getElementById('userStatus').textContent = statusText;
                
                // æ›´æ–°å½“å‰ç”¨æˆ·ä¿¡æ¯
                appData.currentUser = appData.userProfile.userName;
                appData.isLoggedIn = true;
            }
        }

        // åˆå§‹åŒ–ç”¨æˆ·èµ„æ–™
        function initUserProfile() {
            const savedProfile = localStorage.getItem('userProfile');
            if (savedProfile) {
                try {
                    appData.userProfile = JSON.parse(savedProfile);
                    updateUserDisplay();
                } catch (error) {
                    console.error('åŠ è½½ç”¨æˆ·èµ„æ–™å¤±è´¥:', error);
                }
            }
        }

        // å•†åŸåˆ†ç±»æŠ˜å åŠŸèƒ½
        function toggleCategory(categoryId) {
            const categorySection = document.querySelector(`[data-category="${categoryId}"]`);
            const allSections = document.querySelectorAll('.category-section');
            
            // å…³é—­å…¶ä»–åˆ†ç±»
            allSections.forEach(section => {
                if (section !== categorySection) {
                    section.classList.remove('expanded');
                }
            });
            
            // åˆ‡æ¢å½“å‰åˆ†ç±»
            categorySection.classList.toggle('expanded');
            
            // ä¸ºç§»åŠ¨ç«¯ä¼˜åŒ–ï¼šæŠ˜å åˆ†ç±»åæ»šåŠ¨åˆ°é¡¶éƒ¨
            if (window.innerWidth <= 768) {
                if (categorySection.classList.contains('expanded')) {
                    setTimeout(() => {
                        categorySection.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
                    }, 100);
                }
            }
        }

        function openHospitalManager() {
            document.getElementById('hospitalManagerModal').classList.add('active');
            // æ¸…ç©ºè¡¨å•
            document.getElementById('hospitalName').value = '';
            document.getElementById('hospitalAddress').value = '';
            document.getElementById('hospitalPhone').value = '';
            document.getElementById('hospitalDescription').value = '';
            
            // å¦‚æœæœ‰å½“å‰å®šä½ï¼Œè‡ªåŠ¨å¡«å……åæ ‡
            if (appData.currentLocation) {
                document.getElementById('hospitalLng').value = appData.currentLocation.lng.toFixed(6);
                document.getElementById('hospitalLat').value = appData.currentLocation.lat.toFixed(6);
            } else {
                document.getElementById('hospitalLng').value = '';
                document.getElementById('hospitalLat').value = '';
            }
        }

        function closeHospitalManager() {
            document.getElementById('hospitalManagerModal').classList.remove('active');
        }

        function saveHospital() {
            const name = document.getElementById('hospitalName').value.trim();
            const address = document.getElementById('hospitalAddress').value.trim();
            const phone = document.getElementById('hospitalPhone').value.trim();
            const description = document.getElementById('hospitalDescription').value.trim();

            if (!name || !address || !phone) {
                showToast('è¯·å¡«å†™å¿…è¦ä¿¡æ¯', 'error');
                return;
            }

            // ä½¿ç”¨å½“å‰å®šä½ä½ç½®ä½œä¸ºé»˜è®¤åæ ‡ï¼Œå¦‚æœæ²¡æœ‰å®šä½åˆ™ä½¿ç”¨è¾“å…¥çš„åæ ‡
            let lng, lat;
            const inputLng = parseFloat(document.getElementById('hospitalLng').value);
            const inputLat = parseFloat(document.getElementById('hospitalLat').value);
            
            if (appData.currentLocation && (!inputLng || !inputLat)) {
                lng = appData.currentLocation.lng;
                lat = appData.currentLocation.lat;
            } else {
                lng = inputLng || 120.1551;
                lat = inputLat || 30.2741;
            }

            const hospital = {
                id: Date.now(),
                name: name,
                address: address,
                phone: phone,
                lat: lat,
                lng: lng,
                rating: 4.5 + Math.random() * 0.5,
                reviews: generateMockReviews(),
                distance: 0,
                distanceText: '0m',
                isCustom: true,
                addedBy: appData.currentUser,
                addedTime: new Date().toLocaleString()
            };

            // æ·»åŠ åˆ°ç°æœ‰åŒ»é™¢åˆ—è¡¨
            appData.hospitals.unshift(hospital);
            renderRecommendedHospitals();
            closeHospitalManager();
            const cityName = getCityByLocation(lat, lng);
            showToast(`åŒ»é™¢æ·»åŠ æˆåŠŸï¼å°†åœ¨${cityName}é™„è¿‘æ˜¾ç¤ºç»™ç”¨æˆ·`, 'success');
        }
    </script>
</body>
</html>